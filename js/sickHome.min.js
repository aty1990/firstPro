var SickObj=function(){this.content=$(".content");this.footer=$("#sickfooter");this.doctorList=$("#doctorList");this.childBox=$("div.mui-slider-item");this.subPageDiv=$("#subPageDiv");this.indicator=$("#mui-slider-indicator");this.init()};SickObj.prototype.init=function(){this.initPage();this.bindEvent();this.initData()};SickObj.prototype.initPage=function(){utils.initDivPage("main");mui.init();var a=document.body.clientWidth;$(".content").height($(window).height()-50)};SickObj.prototype.initData=function(){var a=this;if(!utils.sliceUrl(location.href).hasOwnProperty("code")){utils.ajax([],"homeAction","sick",{},function(b,c,d){if(b){a.displayData(d);a.initUserData();a.initIM();$.getScript("http://res.wx.qq.com/open/js/jweixin-1.0.0.js",function(f,e,g){a.shareSick()})}})}else{$.getScript("http://res.wx.qq.com/open/js/jweixin-1.0.0.js",function(c,b,d){wxUtils.getWxUserInfo(function(e){console.log(JSON.stringify(e));a.displayData(e);a.initUserData();a.initIM();a.shareSick()})})}};SickObj.prototype.displayData=function(c){var b=c.userInfo,d=this,a="";if(c.homeBizData.result.length==0){a=layer.open({content:"你还没有提供孩子信息，现在去填写吧!",btn:["确认","取消"],shadeClose:false,yes:function(){location.href="mine/myChildList.html"},no:function(){WeixinJSBridge.call("closeWindow")}})}if(c.homeBizData.result.length<2){d.childBox.eq(1).remove();d.indicator.children().remove();mui(".mui-slider")}$.each(c.homeBizData.result,function(g,j){var h="../image/img.jpg?v="+Date.now();if(j.childInfo.img){h=j.childInfo.img+"?v="+Date.now()}d.childBox.eq(g).attr("childId",j.childInfo.childId);d.childBox.eq(g).find("div.tips-por").children().eq(0).attr("src",h);d.childBox.eq(g).find("div.tips-babyname").html(j.childInfo.childNme);d.childBox.eq(g).find("span.age").html(j.childInfo.age);d.childBox.eq(g).find("span.childDesc").html(j.tips);d.childBox.eq(g).find("li.height").html("标准身高："+j.height+"cm");d.childBox.eq(g).find("li.weight").html("标准体重："+j.weight+"kg");d.childBox.eq(g).find("p.birthday").eq(0).html(j.birthday);d.childBox.eq(g).find("p.birthday").eq(0).html(j.childInfo.birthString);d.childBox.eq(g).attr("monthAge",j.childInfo.monthAge);d.childBox.eq(g).attr("dayAge",j.childInfo.dayAge);var f=d.childBox.eq(g).find("div.tips-cal");f.children().eq(0).html(j.now.month+"月");f.children().eq(1).html(j.now.day);var k=d.childBox.find("ul.infoTipsList").eq(g);$.each(j.infoList,function(m,l){var i=$("<li class='mui-table-view-cell mui-media' id='"+l.id+"'>	<a href='javascript:;'>		<div class='mui-media-body'>			<h4>"+l.title+"</h4>			<p class='mui-ellipsis-2'>"+l.overview+"</p>		</div>	</a></li>");i.click(function(){d.viewInfoDetail(this)});k.append(i)});var e=d.childBox.find("div.vaccine").eq(g);$.each(j.vaccine,function(i,m){var l=m.nme;if(m.type=="1"){l=l+"(免费)"}else{l=l+"(自费)"}var n=$("<div class='tips-name' vid='"+m.id+"'>"+l+"</div>");n.on("click",function(){d.gotoVaccineDetail(this)});e.append(n)});if(j.vaccine.length==0){d.childBox.find("p.vaccineTitle").eq(g).html("<div class='nodata' style='padding-top:15px'><span class='newiconfont icon-nodata'></span><p>本月无疫苗接种计划</p></div>")}});mui(".mui-slider");$.each(c.homeBizData.doctorList,function(f,g){var e=$("<li class='mui-table-view-cell mui-media mui-col-xs-3' id='"+g.id+"'>	<img class='mui-media-object' src='"+g.img+"'>	<div class='mui-media-body'>"+g.nme+"</div>	<div class='mui-media-body tips-doctor-tit'>"+g.title+"</div></li>");e.on("tap",function(){d.toDoctorCard(this)});d.doctorList.append(e)});$("#HomeMask").hide();$("#main").show()};SickObj.prototype.bindEvent=function(){var a=this;this.footer.children("li").on("tap",function(c){var d=$(this);var b=d.attr("opend");if(d.attr("class")=="current"){return}if(b!="true"){d.attr("opend","true");if(this.id.indexOf("adviceDoctor")!=-1){$.ajax({url:"findDoctor/findDoctorNew.html?type=sickHome&v="+Date.now(),dataType:"html",async:false,success:function(h){var i=$.parseHTML(h,true);if(i==null||i==""){mui.toast("指定地址的html内容为空");return false}var e=false;for(var f=0;f<i.length;f++){if(i[f].id=="findDoctor_Main"){var g=i[f].innerHTML;$("#adviceDoctor").html(g);e=true}}if(!e){mui.toast("findDoctorNew.html不存在节点id为findDoctor_Main的元素，请检查代码")}},error:function(g,e,f){history.replaceState("","",location.href);mui.toast(g+"--"+e+"--"+f)}})}}$(this.id).show();d.addClass("current");d.siblings("li").each(function(e,f){$(f).removeClass("current");$(this.id).hide()})})};SickObj.prototype.initIM=function(){imChat.login(userUtils.getUser().userId,{succFn:function(a){utils.IMFlag=true;var b=JSON.parse(localStorage.getItem("typeObj"));if(b){if(b.O){$("#unReadMsg").show(function(){$("#twMsg").show()})}if(b.F){$("#unReadMsg").show(function(){$("#hasNewMsg").show()})}}},fail:function(a){mui.toast(JSON.stringify(a))},error:function(a){mui.toast(JSON.stringify(a))}})};SickObj.prototype.gotoPage=function(c,a,b){if(c=="*"){mui.toast("功能开发中");return}if(c.indexOf("?")!=-1){c=c+"&v="+Date.now()}else{c=c+"?v="+Date.now()}utils.openDivPage(c,a,b)};SickObj.prototype.initUserData=function(){var a=userUtils.getUser();document.title="欢迎您  "+a.userNme;$("#userNme").html(a.userNme);$("#userIcon").attr("src",(a.userIconUrl==""?"../image/default.PNG":a.userIconUrl)+"?v="+Date.now())};SickObj.prototype.goGrowthCriteria=function(b){var a=$(b).parents(".mui-slider-item").attr("childId");location.href="healthExam/health/evaluationEdit.html?childId="+a+"&v="+Date.now()};SickObj.prototype.goCapabilityEvaluation=function(b){var a=$(b).parents(".mui-slider-item").attr("childId");location.href="healthExam/exlb/baseTest.html?childId="+a};SickObj.prototype.gotoMoreTest=function(b){var a=$(b).parents(".mui-slider-item").attr("childId");location.href="healthExam/children/healthEdu.html?childId="+a+"&v="+Date.now()};SickObj.prototype.viewInfoDetail=function(c){var b=$(c).attr("id");var a="wx/page/infomation/infoDetail.html?infoId="+b;utils.openDivPage(a,"infoDetail_main","subPageDiv")};SickObj.prototype.gotoMoreInfo=function(b){var d=$(b).parents(".mui-slider-item");var a=d.attr("monthAge");var c=d.attr("dayAge");location.href="infomation/infoList.html?monthAge="+a+"&dayAge="+c+"&v="+Date.now()};SickObj.prototype.toDoctorCard=function(a){var b=$(a).attr("id");utils.openDivPage("wx/page/mine/doctorCardNew.html?doctorId="+b,"doctorCard_main","doctorCard_main")};SickObj.prototype.gotoVaccineDetail=function(d){var a=$(d).attr("vid");var c=$(d).parents(".mui-slider-item").attr("monthAge");var b="wx/page/growthtips/vaccineDetails.html?vid="+a+"&monthAge="+c;utils.openDivPage(b,"vaccineDetails_main","subPageDiv")};SickObj.prototype.gotoVaccineSched=function(c){var b=$(c).parents("div.mui-slider-item").attr("monthAge");var a="wx/page/growthtips/vaccineList.html?monthAge="+b;utils.openDivPage(a,"vaccineList_main","subPageDiv")};SickObj.prototype.shareSick=function(){var a=["onMenuShareQQ","onMenuShareAppMessage","onMenuShareQZone","onMenuShareTimeline","chooseWXPay"];wxUtils.wxConfig(a,function(){var f="掌尚儿保";var e="掌尚儿保,儿童家长的健康顾问，欢迎关注!";var c="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx7108786cb171967b&redirect_uri="+utils.APP_URL_+"/wx/page/sickHome_.html&response_type=code&scope=snsapi_userinfo&state={type:SICK}#wechat_redirect";var g="http://7xq2xm.com2.z0.glb.qiniucdn.com/zseb.jpg";var b="";var d="";wxUtils.wxShare(f,e,c,g,b,d)})};var sickObj=null;if(!sickObj){sickObj=new SickObj()};