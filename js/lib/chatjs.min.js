/* base64.js 2016-05-09 */
function base64encode(a){var b,c,d,e,f,g;for(d=a.length,c=0,b="";d>c;){if(e=255&a.charCodeAt(c++),c==d){b+=base64EncodeChars.charAt(e>>2),b+=base64EncodeChars.charAt((3&e)<<4),b+="==";break}if(f=a.charCodeAt(c++),c==d){b+=base64EncodeChars.charAt(e>>2),b+=base64EncodeChars.charAt((3&e)<<4|(240&f)>>4),b+=base64EncodeChars.charAt((15&f)<<2),b+="=";break}g=a.charCodeAt(c++),b+=base64EncodeChars.charAt(e>>2),b+=base64EncodeChars.charAt((3&e)<<4|(240&f)>>4),b+=base64EncodeChars.charAt((15&f)<<2|(192&g)>>6),b+=base64EncodeChars.charAt(63&g)}return b}function base64decode(a){var b,c,d,e,f,g,h;for(g=a.length,f=0,h="";g>f;){do b=base64DecodeChars[255&a.charCodeAt(f++)];while(g>f&&-1==b);if(-1==b)break;do c=base64DecodeChars[255&a.charCodeAt(f++)];while(g>f&&-1==c);if(-1==c)break;h+=String.fromCharCode(b<<2|(48&c)>>4);do{if(d=255&a.charCodeAt(f++),61==d)return h;d=base64DecodeChars[d]}while(g>f&&-1==d);if(-1==d)break;h+=String.fromCharCode((15&c)<<4|(60&d)>>2);do{if(e=255&a.charCodeAt(f++),61==e)return h;e=base64DecodeChars[e]}while(g>f&&-1==e);if(-1==e)break;h+=String.fromCharCode((3&d)<<6|e)}return h}function utf16to8(a){var b,c,d,e;for(b="",d=a.length,c=0;d>c;c++)e=a.charCodeAt(c),e>=1&&127>=e?b+=a.charAt(c):e>2047?(b+=String.fromCharCode(224|e>>12&15),b+=String.fromCharCode(128|e>>6&63),b+=String.fromCharCode(128|e>>0&63)):(b+=String.fromCharCode(192|e>>6&31),b+=String.fromCharCode(128|e>>0&63));return b}function utf8to16(a){var b,c,d,e,f,g;for(b="",d=a.length,c=0;d>c;)switch(e=a.charCodeAt(c++),e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=a.charAt(c-1);break;case 12:case 13:f=a.charCodeAt(c++),b+=String.fromCharCode((31&e)<<6|63&f);break;case 14:f=a.charCodeAt(c++),g=a.charCodeAt(c++),b+=String.fromCharCode((15&e)<<12|(63&f)<<6|(63&g)<<0)}return b}var base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64DecodeChars=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);!function(a){"use strict";var b,c=a.Base64,d="2.1.7";"undefined"!=typeof module&&module.exports&&(b=require("buffer").Buffer);var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=function(a){for(var b={},c=0,d=a.length;d>c;c++)b[a.charAt(c)]=c;return b}(e),g=String.fromCharCode,h=function(a){if(a.length<2){var b=a.charCodeAt(0);return 128>b?a:2048>b?g(192|b>>>6)+g(128|63&b):g(224|b>>>12&15)+g(128|b>>>6&63)+g(128|63&b)}var b=65536+1024*(a.charCodeAt(0)-55296)+(a.charCodeAt(1)-56320);return g(240|b>>>18&7)+g(128|b>>>12&63)+g(128|b>>>6&63)+g(128|63&b)},i=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,j=function(a){return a.replace(i,h)},k=function(a){var b=[0,2,1][a.length%3],c=a.charCodeAt(0)<<16|(a.length>1?a.charCodeAt(1):0)<<8|(a.length>2?a.charCodeAt(2):0),d=[e.charAt(c>>>18),e.charAt(c>>>12&63),b>=2?"=":e.charAt(c>>>6&63),b>=1?"=":e.charAt(63&c)];return d.join("")},l=a.btoa?function(b){return a.btoa(b)}:function(a){return a.replace(/[\s\S]{1,3}/g,k)},m=b?function(a){return(a.constructor===b.constructor?a:new b(a)).toString("base64")}:function(a){return l(j(a))},n=function(a,b){return b?m(String(a)).replace(/[+\/]/g,function(a){return"+"==a?"-":"_"}).replace(/=/g,""):m(String(a))},o=function(a){return n(a,!0)},p=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),q=function(a){switch(a.length){case 4:var b=(7&a.charCodeAt(0))<<18|(63&a.charCodeAt(1))<<12|(63&a.charCodeAt(2))<<6|63&a.charCodeAt(3),c=b-65536;return g((c>>>10)+55296)+g((1023&c)+56320);case 3:return g((15&a.charCodeAt(0))<<12|(63&a.charCodeAt(1))<<6|63&a.charCodeAt(2));default:return g((31&a.charCodeAt(0))<<6|63&a.charCodeAt(1))}},r=function(a){return a.replace(p,q)},s=function(a){var b=a.length,c=b%4,d=(b>0?f[a.charAt(0)]<<18:0)|(b>1?f[a.charAt(1)]<<12:0)|(b>2?f[a.charAt(2)]<<6:0)|(b>3?f[a.charAt(3)]:0),e=[g(d>>>16),g(d>>>8&255),g(255&d)];return e.length-=[0,0,2,1][c],e.join("")},t=a.atob?function(b){return a.atob(b)}:function(a){return a.replace(/[\s\S]{1,4}/g,s)},u=b?function(a){return(a.constructor===b.constructor?a:new b(a,"base64")).toString()}:function(a){return r(t(a))},v=function(a){return u(String(a).replace(/[-_]/g,function(a){return"-"==a?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},w=function(){var b=a.Base64;return a.Base64=c,b};if(a.Base64={VERSION:d,atob:t,btoa:l,fromBase64:v,toBase64:n,utob:j,encode:n,encodeURI:o,btou:r,decode:v,noConflict:w},"function"==typeof Object.defineProperty){var x=function(a){return{value:a,enumerable:!1,writable:!0,configurable:!0}};a.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",x(function(){return v(this)})),Object.defineProperty(String.prototype,"toBase64",x(function(a){return n(this,a)})),Object.defineProperty(String.prototype,"toBase64URI",x(function(){return n(this,!0)}))}}}(this),this.Meteor&&(Base64=global.Base64);

/* chatUtils.js 2016-05-09 */
var chatUtils={maxChatNum:50,maxChatListNum:50,targetId:"",init:function(a){chatUtils.targetId=a.roomId;try{var b,c=localStorage.getItem("chartUserData");if(c){b=JSON.parse(c);var d=b[a.roomId];d||(b[a.roomId]={n:a.targetNme,h:a.targetHeadUrl,t:a.sendType,u:a.targetId})}else b={},b[a.roomId]={n:a.targetNme,h:a.targetHeadUrl,t:a.sendType,u:a.targetId};localStorage.setItem("chartUserData",JSON.stringify(b))}catch(e){alert(e)}},setChat:function(a,b,c,d,e,f,g){var h,i=localStorage.getItem("chartHistory");if(i){h=JSON.parse(i);var j=h[chatUtils.targetId];if(j)j.length==chatUtils.maxChatNum&&j.pop(),j.unshift({u:a,s:d,t:e,m:f,o:g});else{var k=new Array({u:a,s:d,t:e,m:f,o:g});h[chatUtils.targetId]=k}}else h={},h[chatUtils.targetId]=new Array({u:a,s:d,t:e,m:f,o:g});localStorage.setItem("chartHistory",JSON.stringify(h));var l,m=localStorage.getItem("chartListHistory");m?(l=m.split(","),-1!=l.indexOf(chatUtils.targetId)&&l.splice(l.indexOf(chatUtils.targetId),1),l.unshift(chatUtils.targetId)):l=new Array(chatUtils.targetId),localStorage.setItem("chartListHistory",l.toString());var n,o=localStorage.getItem("chartUserData");if(o){n=JSON.parse(o);var p=n[a];p||(n[a]={n:b,h:c})}else n={},n[a]={n:b,h:c};localStorage.setItem("chartUserData",JSON.stringify(n))},getChatList:function(){var a=localStorage.getItem("chartListHistory"),b=localStorage.getItem("chartHistory"),c=localStorage.getItem("chartUserData"),d=JSON.parse(b),e=JSON.parse(c);if(a){var f=a.split(","),g=new Array;for(var h in f){var i=f[h],j=e[i].n,k=e[i].h,l=e[i].t,m=e[i].u,n=d[i][0],o=e[n.u],p={roomId:i,targetNme:j,targetHead:k,sendType:l,targetId:m,sendUserId:n.u,sendUserNme:o.n,sendUserHead:o.h,type:n.t,msg:n.m,sendTm:n.s,orderId:n.o};g.push(p)}return g}return null},getChat:function(a){var b=localStorage.getItem("chartHistory"),c=localStorage.getItem("chartUserData"),d=JSON.parse(c);if(b){var e=JSON.parse(b);if(e[a]){for(var f=e[a],g=new Array,h=f.length-1;h>=0;h--){var i=f[h],j=i.u,k=i.t,l=i.s,m=i.m,n=i.o,o=d[j].n,p=d[j].h;g.push({userId:j,userNme:o,userHead:p,type:k,msg:m,sendTm:l,orderId:n})}return g}return null}return null},removeChatHistory:function(a,b){var c=localStorage.getItem("chartHistory"),d=localStorage.getItem("chartUserData"),e=JSON.parse(d);if(e[a]="",delete e[a],!c)return null;var f=JSON.parse(c);return f[a]?(f[a]="",delete f[a],localStorage.setItem("chartUserData",JSON.stringify(e)),localStorage.setItem("chartHistory",JSON.stringify(f)),b&&b(),void 0):null},setUnReadMsgNum:function(a){var b=localStorage.getItem("unReadMsgNum");if(b){var c=JSON.parse(b);c[a]?c[a]=c[a]+1:c[a]=1,localStorage.setItem("unReadMsgNum",JSON.stringify(c))}else{var c={};c[a]=1,localStorage.setItem("unReadMsgNum",JSON.stringify(c))}},getUnReadMsgNum:function(a){var b=localStorage.getItem("unReadMsgNum");if(b){var c=JSON.parse(b);return c[a]?c[a]:0}return 0},removeUnReadMsgNum:function(a){var b=localStorage.getItem("unReadMsgNum");if(b){var c=JSON.parse(b);c[a]&&(delete c[a],localStorage.setItem("unReadMsgNum",JSON.stringify(c)))}},setMsgType:function(a){var b=localStorage.getItem("typeObj");if(b){var c=JSON.parse(b);"O"==a?c.O=!0:"F"==a&&(c.F=!0),localStorage.setItem("typeObj",JSON.stringify(c))}else{var c={O:"O"==a,F:"F"==a};localStorage.setItem("typeObj",JSON.stringify(c))}}};

/* imChat.js 2016-05-09 */
window.imChat=window.imChat||{userId:"",_onMsgReceiveListener:null,_noticeReceiveListener:null,_onConnectStateChangeLisenter:null,login:function(d,b){var e=this;e.userId=d;var c=utils.APP_URL_+"/servlet/YuntongxunServlet";var a=imChat.getTimeStamp();$.ajax({type:"post",url:c,data:{userId:d,timestamp:a},success:function(g){token=g;var h=RL_YTX.init(utils.YTX_APPID_);if(102==h.code){mui.toast("缺少参数")}else{if(101==h.code){mui.toast("不支持html5")}else{if(200==h.code){var f=new RL_YTX.LoginBuilder();f.setType(1);f.setUserName(d);f.setPwd();f.setSig(token);f.setTimestamp(a);RL_YTX.login(f,function(i){if(b.succFn){b.succFn(i)}imChat._onMsgReceiveListener=RL_YTX.onMsgReceiveListener(function(j){onMsgReceiveListener(j)});imChat._noticeReceiveListener=RL_YTX.onNoticeReceiveListener(function(j){noticeReceiveListener(j)});imChat._onConnectStateChangeLisenter=RL_YTX.onConnectStateChangeLisenter(function(j){if(1==j.code){console.log("onConnectStateChangeLisenter obj.code:"+j.msg);imChat.login(imChat.userId,b)}else{if(2==j.code){imChat.login(imChat.userId,b)}else{if(3==j.code){}else{if(4==j.code){imChat.logout()}else{if(5==j.code){imChat.login(imChat.userId,b)}else{console.log("onConnectStateChangeLisenter obj.code:"+j.msg)}}}}}})},function(i){if(b.fail){b.fail(i)}})}}}},error:function(){if(b.error){b.error()}return}})},sendText:function(b){var f="O";if(b.sendType){f=b.sendType}var d=new RL_YTX.MsgBuilder();d.setId(Date.now());d.setText(b.text);d.setType(1);d.setReceiver(b.reciever);var a=userUtils.getUser();var c={sendUserId:(b.orderId==""?a.userId:b.orderId),iconUrl:a.userIconUrl,userName:a.userNme,role:a.role,sendType:f,orderId:b.orderId||""};var e=JSON.stringify(c);d.setDomain(e);RL_YTX.sendMsg(d,function(){var g=JSON.parse(d._domain);if(b.contentBox){var h=$("<div class='msg-item msg-item-self'>	<img class='msg-user' src='"+g.iconUrl+"' />	<div class='msg-content'>		<div class='msg-content-inner'>"+d._text+"</div>		<div class='msg-content-arrow'></div>	</div>	<div class='mui-item-clear'></div></div>");b.contentBox.append(h);b.contentBox.scrollTop(b.contentBox[0].scrollHeight)}chatUtils.setChat(c.sendUserId,c.userName,c.iconUrl,imChat.getDateFormat(Date.now()),d._type,d._text,b.orderId);if(b.sucFun){b.sucFun(d)}},function(g){if(b.errFun){b.errFun(g)}},function(h,g){})},sendImg:function(a){imChat.sendText(a)},createGroup:function(a){var b=new RL_YTX.CreateGroupBuilder();b.setGroupName(a.nme);b.setDeclared(a.notice);b.setScope(1);b.setPermission(1);b.setTarget(2);RL_YTX.createGroup(b,function(d){var c=d.data;if(a.sucFun){a.sucFun(d)}},function(c){if(a.errFun){a.errFun(c)}})},getGoupList:function(a){var b=new RL_YTX.GetGroupListBuilder();b.setPageSize(1000);RL_YTX.getGroupList(b,function(c){if(a.sucFun){a.sucFun(c)}},function(c){alert("error code: "+c.code);if(a.errFun){a.errFun(c)}})},deleteGroupMember:function(d,a,c,e){console.log("delete group member groupId:["+d+"],memberId:["+a+"]");var b=new RL_YTX.DeleteGroupMemberBuilder(d,a);RL_YTX.deleteGroupMember(b,function(){if(options.sucFun){options.sucFun(obj)}},function(f){if(options.errFun){options.errFun(f)}})},dismissGroup:function(b,c,a){var d=new RL_YTX.DismissGroupBuilder();d.setGroupId(b);RL_YTX.dismissGroup(d,function(){if(c){c()}},function(e){if(a){a()}})},quitGroup:function(a){console.log("quit Group...");var b=new RL_YTX.QuitGroupBuilder();b.setGroupId(a.groupId);RL_YTX.quitGroup(b,function(){console.log("quit Group SUCC...");if(a.sucFn){a.sucFn()}},function(c){if(a.errFn){a.errFn()}})},getGroupDetail:function(b,c,a){var d=new RL_YTX.GetGroupDetailBuilder();d.setGroupId(b);RL_YTX.getGroupDetail(d,function(e){if(options.sucFn){options.sucFn(e)}},function(e){if(options.errFn){options.errFn(e)}})},getGroupMemberList:function(a){console.log("get Group Member List...");var b=new RL_YTX.GetGroupMemberListBuilder();b.setGroupId(a.groupId);b.setPageSize(2000);RL_YTX.getGroupMemberList(b,function(c){console.log("get Group Member List SUCC...");if(a.sucFn){a.sucFn(c)}},function(c){if(a.errFn){a.errFn(c)}})},getMyInfo:function(a){RL_YTX.getMyInfo(function(b){if(a.sucFn){a.sucFn(b)}},function(b){if(a.errFn){a.errFn(b)}})},uploadPersonInfo:function(b){var a=new RL_YTX.UploadPersonInfoBuilder();a.setNickName(b.nickName);RL_YTX.uploadPerfonInfo(a,function(c){if(b.sucFn){b.sucFn(c)}},function(c){if(b.errFn){b.errFn(obj)}})},inviteGroupMember:function(a){if(a.memberArr.length>50){alert("邀请用户过多！");return}var b=new RL_YTX.InviteJoinGroupBuilder();b.setGroupId(a.groupId);b.setMembers(a.memberArr);b.setConfirm(a.confirm);RL_YTX.inviteJoinGroup(b,function(){if(a.confirm==1){if(a.sucFun){a.sucFun()}}},function(c){if(a.errFun){a.errFun()}})},updateGroupInfo:function(b){var a=new RL_YTX.ModifyGroupBuilder(b.groupId,b.groupName,null,null,null,null,b.declared);RL_YTX.modifyGroup(a,function(){console.log("update group info suc");if(b.sucFn){b.sucFn()}},function(c){if(b.errFn){b.errFn()}})},logout:function(){imChat._onMsgReceiveListener=null;imChat._noticeReceiveListener=null;imChat._onConnectStateChangeLisenter=null;RL_YTX.logout(function(){},function(a){})},getTimeStamp:function(){var c=new Date(),b=c.getFullYear(),d="",e="",g="",a="",f="";if((c.getMonth()+1)>=10){d=c.getMonth()+1}else{d="0"+(c.getMonth()+1)}if(c.getDate()>=10){e=c.getDate()}else{e="0"+c.getDate()}if(c.getHours()>=10){g=c.getHours()}else{g="0"+c.getHours()}if(c.getMinutes()>=10){a=c.getMinutes()}else{a="0"+c.getMinutes()}if(c.getSeconds()>=10){f=c.getSeconds()}else{f="0"+c.getSeconds()}return b+d+e+g+a+f},initSendImgBtn:function(a){var c=this;var b=$("<input type='file'>");b.attr("accept","image/*");b.change(function(){var f=this.files[0];window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;var e=window.URL.createObjectURL(f);if(!/image\/\w+/.test(f.type)){alert("图片格式不正确，请选择正确格式的图片文件！");return false}else{var g=new Image();g.src=window.URL.createObjectURL(f);var h=$("<div class='msg-item msg-item-self' style='position: relative;'>		<img class='msg-user' src='"+a.userIcon+"'/>		<div class='msg-content' style='opacity:0.2;'>			<div class='msg-content-inner'>				<div style='position:relative;width:100px;'>					<img class='msg-content-image' src='"+e+"' data-preview-src='' data-preview-group='1' style='width: 100px;border:none;'/>				</div>			</div>			<div class='msg-content-arrow'></div>		</div>		<div class='mui-item-clear'></div>	<span class='mui-icon mui-icon-spinner-cycle mui-spin' style='position: absolute;top:50%;right:100px;margin-top:-20px'></span></div>");g.onload=function(){a.contentBox.append(h);a.contentBox.scrollTop(a.contentBox[0].scrollHeight)};var d=new FileReader();d.onprogress=function(i){console.log((i.loaded/i.total*100).toFixed()+"%")};d.onload=function(i){lrz(f).then(function(l){if(!l.base64){return}var k=a.maxWidth||150,j=new Image();j.onload=function(){var m=c.compress(j);c.uploadQiNiu(m.substring(m.indexOf(",")+1),function(n){if(a.sucFun){a.sucFun(n)}})};j.src=l.base64;b.remove()})};d.onerror=function(i){alert("图片加载失败")};d.readAsDataURL(f)}});b.trigger("click")},compress:function(g){var b=document.createElement("canvas");var p=b.getContext("2d");var d=document.createElement("canvas");var n=d.getContext("2d");var a=g.width;var o=g.height;var l;if((l=a*o/4000000)>1){l=Math.sqrt(l);a/=l;o/=l}else{l=1}b.width=a;b.height=o;p.fillStyle="#fff";p.fillRect(0,0,b.width,b.height);var k;if((k=a*o/1000000)>1){k=~~(Math.sqrt(k)+1);var h=~~(a/k);var c=~~(o/k);d.width=h;d.height=c;for(var f=0;f<k;f++){for(var e=0;e<k;e++){n.drawImage(g,f*h*l,e*c*l,h*l,c*l,0,0,h,c);p.drawImage(d,f*h,e*c,h,c)}}}else{p.drawImage(g,0,0,a,o)}var m=b.toDataURL("image/jpeg",0.4);d.width=d.height=b.width=b.height=0;return m},uploadQiNiu:function(a,b){utils.ajax([],"qiniuAction","getUpToken",{scene:"chatdata"},function(d,e,g){var c="http://up.qiniu.com/putb64/-1/key/"+base64encode(utf16to8("usericon_"+utils.generateUUID()+".jpg"));var f=new XMLHttpRequest();f.open("POST",c,true);f.setRequestHeader("Content-Type","MIME");f.setRequestHeader("Authorization","UpToken "+g.upToken);f.setRequestHeader("Cache-Control","no-store");f.onreadystatechange=function(){if(f.readyState==4){var h=utils.QINIU_URL_CHAT+utils.stringToJson(f.responseText).key;if(b){b(h)}}};f.send(a)},function(){})},getLocationCache:function(b){var d=this,a=chatUtils.getChatList();if(a){if(a.length>0){for(var c in a){if(!b.msgTyle){d.getMsgList(b,a[c])}else{if(a[c].sendType==b.msgTyle){d.getMsgList(b,a[c])}}}}}},getMsgList:function(b,c){if(imChat.checkImgExists(c.msg)){c.msg="[图片]"}b.selector.sessionList.html("");var d=chatUtils.getUnReadMsgNum(c.roomId);var a=$("<li class='mui-table-view-cell mui-media'>																					<div class='mui-slider-right mui-disabled'>																			   	<a class='mui-btn mui-btn-red'>删除</a>																			   </div>																													<div class='mui-slider-handle'>																								<img class='mui-media-object mui-media-large mui-pull-left' src='"+c.targetHead+"' />									<div class='mui-media-body'>																								<div>																														<span>"+c.targetNme+"11</span>																		   			<span style='float: right;font-size:14px'>"+c.sendTm+"</span>														</div>																													<p class='mui-ellipsis' style='padding-top: 8px;width: 80%;'>"+c.msg+"</p>										</div>																													<span class='mui-badge mui-badge-danger' style='position: absolute;right: 5%;top:70%;'>"+d+"</span>		</div></li>");a.attr({roomId:c.roomId,targetId:c.targetId,targetNme:c.targetNme,targetHead:c.targetHead,orderId:c.orderId,sendType:c.sendType});a.on("click",function(){if(b.sucFn){b.sucFn(this)}});a.children().eq(0).on("click",function(f){imChat.delHistory(this);return false});if(d==0){a.children("div").eq(1).children("span").eq(0).hide()}if(d>99){a.children("div").eq(1).children("span").eq(0).html("99+")}b.selector.sessionList.append(a)},delHistory:function(b){var a=$(b).parent();chatUtils.removeChatHistory(a.attr("roomId"),function(){a.remove();mui.toast("删除成功")})},getChatHistory:function(a){if(a.orderId){utils.ajax([],"txtImgChatAction","getChatMsg",{COrderId:a.orderId},function(b,c,d){imChat.displayChatHistory(d.result,a)})}else{imChat.displayChatHistory(chatUtils.getChat(a.roomId),a)}},displayChatHistory:function(a,b){var g=b.selector,e="";if(!a||a.length<=0){return}g.msgBody.html("");for(var c=0;c<a.length;c++){var d=(a[c].userId==userUtils.getUser().userId?"msg-item  msg-item-self":"msg-item");var f=$("<div class='"+d+"'>	<img class='msg-user' src='"+a[c].userHead+"'/>	<div class='msg-content'>		<div class='msg-content-inner'></div>		<div class='msg-content-arrow'></div>	</div>	<div class='mui-item-clear'></div></div>");if(a[c].type==4){e=$('<img class="msg-content-image" src="'+a[c].msg+'" data-preview-src="" data-preview-group="1" style="max-width: 100px;"/>');f.find("div.msg-content-inner").html(e)}else{if(a[c].type==1){if(imChat.checkImgExists(a[c].msg)){e=$('<img class="msg-content-image" src="'+a[c].msg+'" data-preview-src="" data-preview-group="1"  style="max-width: 100px;"/>');f.find("div.msg-content-inner").html(e)}else{f.find("div.msg-content-inner").html(a[c].msg)}}}g.msgBody.append(f);g.msgBody.scrollTop(g.msgBody[0].scrollHeight)}},getDateFormat:function(c){var a=new Date(Math.floor(c));var b=a.getMonth()+1;if(b<10){b="0"+b}return a.getFullYear()+"-"+b+"-"+a.getDate()},checkImgExists:function(a){if(a.indexOf(utils.QINIU_URL_CHAT)!=-1){return true}else{return false}},listenChatMsg:function(a){$.unsubscribe("/listenChatMsg");$.subscribe("/listenChatMsg",function(j,f){var n=JSON.parse(f.msgDomain),o="";if(n.sendUserId==a.roomId){var b=$("<div class='msg-item'>	<img class='msg-user' src='"+n.iconUrl+"' />	<div class='msg-content'>		<div class='msg-content-inner'></div>		<div class='msg-content-arrow'></div>	</div>	<div class='mui-item-clear'></div></div>");if(f.msgType=="4"){o=$("<img class='msg-content-image' src='"+f.msgContent+"' data-preview-src='' data-preview-group='1' style='max-width: 100px;'/>");b.find("div.msg-content-inner").html(o)}else{if(f.msgType=="1"){if(imChat.checkImgExists(f.msgContent)){o=$("<img class='msg-content-image' src='"+f.msgContent+"'  data-preview-src='' data-preview-group='1' style='max-width: 100px;'/>");b.find("div.msg-content-inner").html(o);var d=new Image();d.src=f.msgContent;d.onload=function(){a.msgbox.append(b);a.msgbox.scrollTop(a.msgbox[0].scrollHeight)}}else{b.find("div.msg-content-inner").html(f.msgContent);a.msgbox.append(b);a.msgbox.scrollTop(a.msgbox[0].scrollHeight)}}}}else{var m=$("#sessionList").children();for(var g=0;g<m.length;g++){var l=$(m[g]);var k=l.children();if(l.attr("roomId")==n.sendUserId){var h=k.eq(2).html();var c=Math.ceil(h)+1;if(c>99){c="99"}k.eq(2).show().html(c)}}}})},listenSessionMsg:function(b){var a=false;$.unsubscribe("/listenSessionMsg");$.subscribe("/listenSessionMsg",function(j,f){var d=JSON.parse(f.msgDomain),c=0,h="";var q=imChat.checkImgExists(f.msgContent)==true?"[图片]":f.msgContent;var n=b.sessionList.children();for(var g=0;g<n.length;g++){var l=$(n[g]);var k=l.children();if(l.attr("roomId")==d.sendUserId){if($("#talkPageDiv").length<1){h=k.eq(2).html();c=parseInt(h)+1;if(c>99){c="99"}k.eq(2).show().html(c)}k.eq(1).children().eq(1).html(q);a=true;break}else{if(!l.attr("orderId")&&l.attr("roomId")==d.sendUserId){if($("#talkPageDiv").length<1){h=k.eq(2).html();c=parseInt(h)+1;if(c>99){c="99+"}k.eq(2).show().html(c)}k.eq(1).children().eq(1).html(q);a=true;break}}}if(!a){var p=JSON.parse(f.msgDomain);if(p.orderId){return}var m="与 "+p.userName+" 对话";if(p.orderId&&p.role=="1"){m="与 "+p.userName+" 医生 对话"}var o=$("<li class='mui-table-view-cell mui-media'>	<img class='mui-media-object mui-media-large mui-pull-left' src='"+p.iconUrl+"' />							<div class='mui-media-body'>																							<div>																													<span>"+m+"</span>																		   			<span style='float: right;'>																		   				<pre style='color:#000;font-size:14px;font-weight:normal'>"+imChat.getDateFormat(f.msgDateCreated)+"</pre>   			</span>																										</div>																												<p class='mui-ellipsis' style='padding-top: 8px;width: 80%;'>"+q+"</p>										</div>																												<span class='mui-badge mui-badge-danger' style='position: absolute;right: 5%;top:70%;'>1</span>					</li>");o.attr({targetId:f.msgSender,targetNme:p.userName,roomId:(p.orderId==""?f.msgSender:p.orderId),targetHead:p.iconUrl,orderId:p.orderId,sendType:p.sendType});o.on("click",function(){b.callback(this)});b.sessionList.append(o)}})},addContactToList:function(b){var a=$("<li class='mui-table-view-cell' id='im_contact_"+b.groupId+"' contact_type=''>				<div class='mui-slider-cell'>																			<div class='oa-contact-cell mui-table'>																	<div class='oa-contact-avatar mui-table-cell'>															<img src='../../image/IMG_1725.PNG' />															</div>																								<div class='oa-contact-content mui-table-cell'>"+b.groupName+"</div>						</div>																							</div>																							</li>");a.attr({targetId:b.groupId,targetNme:b.groupName,owner:b.owner,targetHead:"../../image/IMG_1725.PNG",sendType:"G"});a.on("tap",function(c){friendListObj.toChatHome(this)});b.noDataMsg.hide();b.contentBox.append(a).show();if(b.isCreate){history.back()}},toChatHome:function(g,d){var c=$(d).attr("roomId");var f=$(d).attr("sendType");var b=$(d).children("span");b.html("0").hide();chatUtils.removeUnReadMsgNum(c);var a={roomId:c,targetId:$(d).attr("targetId"),targetName:$(d).attr("targetNme"),userIcon:$(d).attr("targetHead"),sendType:f,orderId:$(d).attr("orderId"),creater:$(d).attr("owner")||"",role:g.curRole,chatType:(f=="G"?"more":"single")};var e="wx/page/sessionmsg/chatWindow.html?v="+Date.now();utils.openDivPage(e,"talkPageDiv_Main","talkPageDiv_Main");$.publish("/params",[a])},saveMsgToLocal:function(e,d){var a=JSON.parse(e.msgDomain);var c=imChat.getDateFormat(e.msgDateCreated);var b={roomId:(a.orderId==""?e.msgSender:a.orderId),targetId:e.msgSender,targetNme:a.userName,targetHeadUrl:a.iconUrl,sendType:a.sendType};chatUtils.init(b);chatUtils.setChat(e.roomId,a.userName,a.iconUrl,c,e.msgType,e.msgContent,a.orderId);if(d.length==0){chatUtils.setUnReadMsgNum(b.roomId)}chatUtils.setMsgType(a.sendType)}};

/* md5.js 2016-05-09 */
function hex_md5(a){return binl2hex(core_md5(str2binl(a),a.length*chrsz))}function b64_md5(a){return binl2b64(core_md5(str2binl(a),a.length*chrsz))}function hex_hmac_md5(a,b){return binl2hex(core_hmac_md5(a,b))}function b64_hmac_md5(a,b){return binl2b64(core_hmac_md5(a,b))}function calcMD5(a){return binl2hex(core_md5(str2binl(a),a.length*chrsz))}function md5_vm_test(){return"900150983cd24fb0d6963f7d28e17f72"==hex_md5("abc")}function core_md5(a,b){a[b>>5]|=128<<b%32,a[(b+64>>>9<<4)+14]=b;for(var c=1732584193,d=-271733879,e=-1732584194,f=271733878,g=0;g<a.length;g+=16){var h=c,i=d,j=e,k=f;c=md5_ff(c,d,e,f,a[g+0],7,-680876936),f=md5_ff(f,c,d,e,a[g+1],12,-389564586),e=md5_ff(e,f,c,d,a[g+2],17,606105819),d=md5_ff(d,e,f,c,a[g+3],22,-1044525330),c=md5_ff(c,d,e,f,a[g+4],7,-176418897),f=md5_ff(f,c,d,e,a[g+5],12,1200080426),e=md5_ff(e,f,c,d,a[g+6],17,-1473231341),d=md5_ff(d,e,f,c,a[g+7],22,-45705983),c=md5_ff(c,d,e,f,a[g+8],7,1770035416),f=md5_ff(f,c,d,e,a[g+9],12,-1958414417),e=md5_ff(e,f,c,d,a[g+10],17,-42063),d=md5_ff(d,e,f,c,a[g+11],22,-1990404162),c=md5_ff(c,d,e,f,a[g+12],7,1804603682),f=md5_ff(f,c,d,e,a[g+13],12,-40341101),e=md5_ff(e,f,c,d,a[g+14],17,-1502002290),d=md5_ff(d,e,f,c,a[g+15],22,1236535329),c=md5_gg(c,d,e,f,a[g+1],5,-165796510),f=md5_gg(f,c,d,e,a[g+6],9,-1069501632),e=md5_gg(e,f,c,d,a[g+11],14,643717713),d=md5_gg(d,e,f,c,a[g+0],20,-373897302),c=md5_gg(c,d,e,f,a[g+5],5,-701558691),f=md5_gg(f,c,d,e,a[g+10],9,38016083),e=md5_gg(e,f,c,d,a[g+15],14,-660478335),d=md5_gg(d,e,f,c,a[g+4],20,-405537848),c=md5_gg(c,d,e,f,a[g+9],5,568446438),f=md5_gg(f,c,d,e,a[g+14],9,-1019803690),e=md5_gg(e,f,c,d,a[g+3],14,-187363961),d=md5_gg(d,e,f,c,a[g+8],20,1163531501),c=md5_gg(c,d,e,f,a[g+13],5,-1444681467),f=md5_gg(f,c,d,e,a[g+2],9,-51403784),e=md5_gg(e,f,c,d,a[g+7],14,1735328473),d=md5_gg(d,e,f,c,a[g+12],20,-1926607734),c=md5_hh(c,d,e,f,a[g+5],4,-378558),f=md5_hh(f,c,d,e,a[g+8],11,-2022574463),e=md5_hh(e,f,c,d,a[g+11],16,1839030562),d=md5_hh(d,e,f,c,a[g+14],23,-35309556),c=md5_hh(c,d,e,f,a[g+1],4,-1530992060),f=md5_hh(f,c,d,e,a[g+4],11,1272893353),e=md5_hh(e,f,c,d,a[g+7],16,-155497632),d=md5_hh(d,e,f,c,a[g+10],23,-1094730640),c=md5_hh(c,d,e,f,a[g+13],4,681279174),f=md5_hh(f,c,d,e,a[g+0],11,-358537222),e=md5_hh(e,f,c,d,a[g+3],16,-722521979),d=md5_hh(d,e,f,c,a[g+6],23,76029189),c=md5_hh(c,d,e,f,a[g+9],4,-640364487),f=md5_hh(f,c,d,e,a[g+12],11,-421815835),e=md5_hh(e,f,c,d,a[g+15],16,530742520),d=md5_hh(d,e,f,c,a[g+2],23,-995338651),c=md5_ii(c,d,e,f,a[g+0],6,-198630844),f=md5_ii(f,c,d,e,a[g+7],10,1126891415),e=md5_ii(e,f,c,d,a[g+14],15,-1416354905),d=md5_ii(d,e,f,c,a[g+5],21,-57434055),c=md5_ii(c,d,e,f,a[g+12],6,1700485571),f=md5_ii(f,c,d,e,a[g+3],10,-1894986606),e=md5_ii(e,f,c,d,a[g+10],15,-1051523),d=md5_ii(d,e,f,c,a[g+1],21,-2054922799),c=md5_ii(c,d,e,f,a[g+8],6,1873313359),f=md5_ii(f,c,d,e,a[g+15],10,-30611744),e=md5_ii(e,f,c,d,a[g+6],15,-1560198380),d=md5_ii(d,e,f,c,a[g+13],21,1309151649),c=md5_ii(c,d,e,f,a[g+4],6,-145523070),f=md5_ii(f,c,d,e,a[g+11],10,-1120210379),e=md5_ii(e,f,c,d,a[g+2],15,718787259),d=md5_ii(d,e,f,c,a[g+9],21,-343485551),c=safe_add(c,h),d=safe_add(d,i),e=safe_add(e,j),f=safe_add(f,k)}return Array(c,d,e,f)}function md5_cmn(a,b,c,d,e,f){return safe_add(bit_rol(safe_add(safe_add(b,a),safe_add(d,f)),e),c)}function md5_ff(a,b,c,d,e,f,g){return md5_cmn(b&c|~b&d,a,b,e,f,g)}function md5_gg(a,b,c,d,e,f,g){return md5_cmn(b&d|c&~d,a,b,e,f,g)}function md5_hh(a,b,c,d,e,f,g){return md5_cmn(b^c^d,a,b,e,f,g)}function md5_ii(a,b,c,d,e,f,g){return md5_cmn(c^(b|~d),a,b,e,f,g)}function core_hmac_md5(a,b){var c=str2binl(a);c.length>16&&(c=core_md5(c,a.length*chrsz));for(var d=Array(16),e=Array(16),f=0;16>f;f++)d[f]=909522486^c[f],e[f]=1549556828^c[f];var g=core_md5(d.concat(str2binl(b)),512+b.length*chrsz);return core_md5(e.concat(g),640)}function safe_add(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function bit_rol(a,b){return a<<b|a>>>32-b}function str2binl(a){for(var b=Array(),c=(1<<chrsz)-1,d=0;d<a.length*chrsz;d+=chrsz)b[d>>5]|=(a.charCodeAt(d/chrsz)&c)<<d%32;return b}function binl2hex(a){for(var b=hexcase?"0123456789ABCDEF":"0123456789abcdef",c="",d=0;d<4*a.length;d++)c+=b.charAt(a[d>>2]>>d%4*8+4&15)+b.charAt(a[d>>2]>>d%4*8&15);return c}function binl2b64(a){for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="",d=0;d<4*a.length;d+=3)for(var e=(a[d>>2]>>8*(d%4)&255)<<16|(a[d+1>>2]>>8*((d+1)%4)&255)<<8|a[d+2>>2]>>8*((d+2)%4)&255,f=0;4>f;f++)c+=8*d+6*f>32*a.length?b64pad:b.charAt(e>>6*(3-f)&63);return c}var hexcase=0,b64pad="",chrsz=8;
/* mui.previewimage 2016-05-09 */
!function(a,b){var c='<div id="{{id}}" class="mui-slider mui-preview-image mui-fullscreen"><div class="mui-preview-header">{{header}}</div><div class="mui-slider-group"></div><div class="mui-preview-footer mui-hidden">{{footer}}</div><div class="mui-preview-loading"><span class="mui-spinner mui-spinner-white"></span></div></div>',d='<div class="mui-slider-item mui-zoom-wrapper {{className}}"><div class="mui-zoom-scroller"><img src="{{src}}" data-preview-lazyload="{{lazyload}}" style="{{style}}" class="mui-zoom"></div></div>',e="__DEFAULT",f=document.createElement("div"),g=function(b){this.options=a.extend(!0,{id:"__MUI_PREVIEWIMAGE",zoom:!0,header:'<span class="mui-preview-indicator"></span>',footer:""},b||{}),this.init(),this.initEvent()},h=g.prototype;h.init=function(){var b=this.options,d=document.getElementById(this.options.id);d||(f.innerHTML=c.replace(/\{\{id\}\}/g,this.options.id).replace("{{header}}",b.header).replace("{{footer}}",b.footer),document.body.appendChild(f.firstElementChild),d=document.getElementById(this.options.id)),this.element=d,this.scroller=this.element.querySelector(a.classSelector(".slider-group")),this.indicator=this.element.querySelector(a.classSelector(".preview-indicator")),this.loader=this.element.querySelector(a.classSelector(".preview-loading")),b.footer&&this.element.querySelector(a.classSelector(".preview-footer")).classList.remove(a.className("hidden")),this.addImages()},h.initEvent=function(){var b=this;a(document.body).on("tap","img[data-preview-src]",function(){return b.isAnimationing()?!1:(b.open(this),!1)});var c=null,d=function(){!c&&(c=a.later(function(){b.isInAnimation=!0,b.loader.removeEventListener("tap",d),b.scroller.removeEventListener("tap",d),b.close()},300))};this.scroller.addEventListener("doubletap",function(){c&&(c.cancel(),c=null)}),this.element.addEventListener("webkitAnimationEnd",function(){b.element.classList.contains(a.className("preview-out"))?(b.element.style.display="none",b.element.classList.remove(a.className("preview-out")),c=null):(b.loader.addEventListener("tap",d),b.scroller.addEventListener("tap",d)),b.isInAnimation=!1}),this.element.addEventListener("slide",function(c){if(b.options.zoom){var d=b.element.querySelector(".mui-zoom-wrapper:nth-child("+(b.lastIndex+1)+")");d&&a(d).zoom().setZoom(1)}var e=c.detail.slideNumber;b.lastIndex=e,b.indicator&&(b.indicator.innerText=e+1+"/"+b.currentGroup.length),b._loadItem(e)})},h.isAnimationing=function(){return this.isInAnimation?!0:(this.isInAnimation=!0,!1)},h.addImages=function(a,b){this.groups={};var c=[];if(c=a?a===e?document.querySelectorAll("img[data-preview-src]:not([data-preview-group])"):document.querySelectorAll("img[data-preview-src][data-preview-group='"+a+"']"):document.querySelectorAll("img[data-preview-src]"),c.length)for(var d=0,f=c.length;f>d;d++)this.addImage(c[d])},h.addImage=function(a){var b=a.getAttribute("data-preview-group");b=b||e,this.groups[b]||(this.groups[b]=[]);var c=a.getAttribute("src");if(a.__mui_img_data&&a.__mui_img_data.src===c)this.groups[b].push(a.__mui_img_data);else{var d=a.getAttribute("data-preview-src");d||(d=c);var f={src:c,lazyload:c===d?"":d,loaded:c===d,sWidth:0,sHeight:0,sTop:0,sLeft:0,sScale:1,el:a};this.groups[b].push(f),a.__mui_img_data=f}},h.empty=function(){this.scroller.innerHTML=""},h._initImgData=function(c,d){if(!c.sWidth){var e=c.el;c.sWidth=e.offsetWidth,c.sHeight=e.offsetHeight;var f=a.offset(e);c.sTop=f.top,c.sLeft=f.left,c.sScale=Math.max(c.sWidth/b.innerWidth,c.sHeight/b.innerHeight)}d.style.webkitTransform="translate3d(0,0,0) scale("+c.sScale+")"},h._getScale=function(a,b){var c=a.width/b.width,d=a.height/b.height,e=1;return e=d>=c?a.height/(b.height*c):a.width/(b.width*d)},h._imgTransitionEnd=function(b){var c=b.target;c.classList.remove(a.className("transitioning")),c.removeEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this))},h._loadItem=function(b,c){var d=this.scroller.querySelector(a.classSelector(".slider-item:nth-child("+(b+1)+")")),e=this.currentGroup[b],f=d.querySelector("img");if(this._initImgData(e,f),c){var g=this._getPosition(e);f.style.webkitTransitionDuration="0ms",f.style.webkitTransform="translate3d("+g.x+"px,"+g.y+"px,0) scale("+e.sScale+")",f.offsetHeight}if(!e.loaded&&f.getAttribute("data-preview-lazyload")){var h=this;h.loader.classList.add(a.className("active")),f.style.webkitTransitionDuration="0.5s",f.addEventListener("webkitTransitionEnd",h._imgTransitionEnd.bind(h)),f.style.webkitTransform="translate3d(0,0,0) scale("+e.sScale+")",this.loadImage(f,function(){e.loaded=!0,f.src=e.lazyload,h._initZoom(d,this.width,this.height),f.classList.add(a.className("transitioning")),f.addEventListener("webkitTransitionEnd",h._imgTransitionEnd.bind(h)),f.setAttribute("style",""),f.offsetHeight,h.loader.classList.remove(a.className("active"))})}else e.lazyload&&(f.src=e.lazyload),this._initZoom(d,f.width,f.height),f.classList.add(a.className("transitioning")),f.addEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this)),f.setAttribute("style",""),f.offsetHeight;this._preloadItem(b+1),this._preloadItem(b-1)},h._preloadItem=function(b){var c=this.scroller.querySelector(a.classSelector(".slider-item:nth-child("+(b+1)+")"));if(c){var d=this.currentGroup[b];if(!d.sWidth){var e=c.querySelector("img");this._initImgData(d,e)}}},h._initZoom=function(b,c,d){if(this.options.zoom&&!b.getAttribute("data-zoomer")){var e=b.querySelector(a.classSelector(".zoom"));if("IMG"===e.tagName){var f=this,g=f._getScale({width:b.offsetWidth,height:b.offsetHeight},{width:c,height:d});a(b).zoom({maxZoom:Math.max(g,1)})}else a(b).zoom()}},h.loadImage=function(a,b){var c=function(){b&&b.call(this)},d=new Image;d.onload=c,d.onerror=c,d.src=a.getAttribute("data-preview-lazyload")},h.getRangeByIndex=function(a,b){return{from:0,to:b-1}},h._getPosition=function(a){var c=a.sLeft-b.pageXOffset,d=a.sTop-b.pageYOffset,e=(b.innerWidth-a.sWidth)/2,f=(b.innerHeight-a.sHeight)/2;return{left:c,top:d,x:c-e,y:d-f}},h.refresh=function(c,e){this.currentGroup=e;for(var f=e.length,g=[],h=this.getRangeByIndex(c,f),i=h.from,j=h.to+1,k=c,l="",m="",n=(b.innerWidth,b.innerHeight,0);j>i;i++,n++){var o=e[i],p="";o.sWidth&&(p="-webkit-transform:translate3d(0,0,0) scale("+o.sScale+");transform:translate3d(0,0,0) scale("+o.sScale+")"),m=d.replace("{{src}}",o.src).replace("{{lazyload}}",o.lazyload).replace("{{style}}",p),i===c?(k=n,l=a.className("active")):l="",g.push(m.replace("{{className}}",l))}this.scroller.innerHTML=g.join(""),this.element.style.display="block",this.element.classList.add(a.className("preview-in")),this.lastIndex=k,this.element.offsetHeight,a(this.element).slider().gotoItem(k,0),this.indicator&&(this.indicator.innerText=k+1+"/"+this.currentGroup.length),this._loadItem(k,!0)},h.openByGroup=function(a,b){a=Math.min(Math.max(0,a),this.groups[b].length-1),this.refresh(a,this.groups[b])},h.open=function(b,c){this.element.classList.contains(a.className("preview-in"))||("number"==typeof b?(c=c||e,this.addImages(c,b),this.openByGroup(b,c)):(c=b.getAttribute("data-preview-group"),c=c||e,this.addImages(c,b),this.openByGroup(this.groups[c].indexOf(b.__mui_img_data),c)))},h.close=function(c,d){this.element.classList.remove(a.className("preview-in")),this.element.classList.add(a.className("preview-out"));var e=this.scroller.querySelector(a.classSelector(".slider-item:nth-child("+(this.lastIndex+1)+")")),f=e.querySelector("img");if(f){f.classList.add(a.className("transitioning"));var g=this.currentGroup[this.lastIndex],h=this._getPosition(g),i=h.left,j=h.top;j>b.innerHeight||i>b.innerWidth||0>j||0>i?(f.style.opacity=0,f.style.webkitTransitionDuration="0.5s",f.style.webkitTransform="scale("+g.sScale+")"):(this.options.zoom&&a(f.parentNode.parentNode).zoom().toggleZoom(0),f.style.webkitTransitionDuration="0.5s",f.style.webkitTransform="translate3d("+h.x+"px,"+h.y+"px,0) scale("+g.sScale+")")}for(var k=this.element.querySelectorAll(a.classSelector(".zoom-wrapper")),l=0,m=k.length;m>l;l++)a(k[l]).zoom().destory()},h.isShown=function(){return this.element.classList.contains(a.className("preview-in"))},h.dispose=function(){var a=document.getElementById("__MUI_PREVIEWIMAGE");a&&a.parentNode.removeChild(a),i=null};var i=null;a.previewImage=function(a){return i||(i=new g(a)),i},a.getPreviewImage=function(){return i}}(mui,window);

/* qiniu.js库 2016-05-09 */
function QiniuJsSDK(){var a;a="https:"===window.location.protocol?"https://up.qbox.me":"http://upload.qiniu.com",this.detectIEVersion=function(){for(var a=4,b=document.createElement("div"),c=b.getElementsByTagName("i");b.innerHTML="<!--[if gt IE "+a+"]><i></i><![endif]-->",c[0];)a++;return a>4?a:!1},this.isImage=function(a){var b,c="",d=["png","jpg","jpeg","gif","bmp"],e=/\.([a-zA-Z0-9]+)(\?|\@|$)/;if(!a||!e.test(a))return!1;b=e.exec(a),c=b[1].toLowerCase();for(var f=0,g=d.length;g>f;f++)if(c===d[f])return!0;return!1},this.getFileExtension=function(a){var b,c=a.split(".");return b=1===c.length||""===c[0]&&2===c.length?"":c.pop().toLowerCase()},this.utf8_encode=function(a){if(null===a||"undefined"==typeof a)return"";var b,c,d=a+"",e="",f=0;b=c=0,f=d.length;for(var g=0;f>g;g++){var h=d.charCodeAt(g),i=null;if(128>h)c++;else if(h>127&&2048>h)i=String.fromCharCode(h>>6|192,63&h|128);else if(63488&h^!0)i=String.fromCharCode(h>>12|224,h>>6&63|128,63&h|128);else{if(64512&h^!0)throw new RangeError("Unmatched trail surrogate at "+g);var j=d.charCodeAt(++g);if(64512&j^!0)throw new RangeError("Unmatched lead surrogate at "+(g-1));h=((1023&h)<<10)+(1023&j)+65536,i=String.fromCharCode(h>>18|240,h>>12&63|128,h>>6&63|128,63&h|128)}null!==i&&(c>b&&(e+=d.slice(b,c)),e+=i,b=c=g+1)}return c>b&&(e+=d.slice(b,f)),e},this.base64_encode=function(a){var b,c,d,e,f,g,h,i,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0,l=0,m="",n=[];if(!a)return a;a=this.utf8_encode(a+"");do b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),i=b<<16|c<<8|d,e=i>>18&63,f=i>>12&63,g=i>>6&63,h=63&i,n[l++]=j.charAt(e)+j.charAt(f)+j.charAt(g)+j.charAt(h);while(k<a.length);switch(m=n.join(""),a.length%3){case 1:m=m.slice(0,-2)+"==";break;case 2:m=m.slice(0,-1)+"="}return m},this.URLSafeBase64Encode=function(a){return a=this.base64_encode(a),a.replace(/\//g,"_").replace(/\+/g,"-")},this.createAjax=function(a){var b={};return b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},this.parseJSON=function(a){return window.JSON&&window.JSON.parse?window.JSON.parse(a):null===a?a:"string"==typeof a&&(a=this.trim(a),a&&/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,"@").replace(/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))?function(){return a}():void 0},this.trim=function(a){return null===a?"":a.replace(/^\s+|\s+$/g,"")};var b=this;this.uploader=function(c){if(!c.domain)throw"uptoken_url or domain is required!";if(!c.browse_button)throw"browse_button is required!";var d={},e=c.init&&c.init.Error,f=c.init&&c.init.FileUploaded;c.init.Error=function(){},c.init.FileUploaded=function(){},b.uptoken_url=c.uptoken_url,b.token="",b.key_handler="function"==typeof c.init.Key?c.init.Key:"",this.domain=c.domain;var g="",h={isResumeUpload:!1,resumeFilesize:0,startTime:"",currentTime:""},i=function(){var a,d,e,f=b.detectIEVersion(),g="Safari"===mOxie.Env.browser&&mOxie.Env.version<=5&&"Windows"===mOxie.Env.os&&"7"===mOxie.Env.osVersion||"Safari"===mOxie.Env.browser&&"iOS"===mOxie.Env.os&&"7"===mOxie.Env.osVersion;f&&9>=f&&c.chunk_size&&c.runtimes.indexOf("flash")>=0?c.chunk_size=0:g?c.chunk_size=0:(a=20,d=4<<a,e=plupload.parseSize(c.chunk_size),e>d&&(c.chunk_size=d))};i();var j=function(){if(c.uptoken)b.token=c.uptoken;else{var a=b.createAjax();a.open("GET",b.uptoken_url,!0),a.setRequestHeader("If-Modified-Since","0"),a.onreadystatechange=function(){if(4===a.readyState&&200===a.status){var c=b.parseJSON(a.responseText);b.token=c.uptoken}},a.send()}},k=function(a,d,e){var f="",g=!1;if(!c.save_key)if(g=a.getOption&&a.getOption("unique_names"),g=g||a.settings&&a.settings.unique_names){var h=b.getFileExtension(d.name);f=h?d.id+"."+h:d.id}else f="function"==typeof e?e(a,d):d.name;return f};plupload.extend(d,c,{url:a,multipart_params:{token:""}});var l=new plupload.Uploader(d);return l.bind("Init",function(a,b){j()}),l.init(),l.bind("FilesAdded",function(a,b){var c=a.getOption&&a.getOption("auto_start");c=c||a.settings&&a.settings.auto_start,c&&plupload.each(b,function(b,c){a.start()}),a.refresh()}),l.bind("BeforeUpload",function(d,e){e.speed=e.speed||0,g="",c.get_new_uptoken&&j();var f=function(d,e,f){h.startTime=(new Date).getTime();var g;g=c.save_key?{token:b.token}:{key:k(d,e,f),token:b.token};var i=c.x_vars;if(void 0!==i&&"object"==typeof i)for(var j in i)i.hasOwnProperty(j)&&("function"==typeof i[j]?g["x:"+j]=i[j](d,e):"object"!=typeof i[j]&&(g["x:"+j]=i[j]));d.setOption({url:a,multipart:!0,chunk_size:void 0,multipart_params:g})},i=d.getOption&&d.getOption("chunk_size");if(i=i||d.settings&&d.settings.chunk_size,"html5"===l.runtime&&i)if(e.size<i)f(d,e,b.key_handler);else{var m=localStorage.getItem(e.name),n=i;if(m){m=JSON.parse(m);var o=(new Date).getTime(),p=m.time||0,q=864e5;q>o-p&&100!==m.percent&&e.size===m.total?(e.percent=m.percent,e.loaded=m.offset,g=m.ctx,h.isResumeUpload=!0,h.resumeFilesize=m.offset,m.offset+n>e.size&&(n=e.size-m.offset)):localStorage.removeItem(e.name)}h.startTime=(new Date).getTime(),d.setOption({url:a+"/mkblk/"+n,multipart:!1,chunk_size:i,required_features:"chunks",headers:{Authorization:"UpToken "+b.token},multipart_params:{}})}else f(d,e,b.key_handler)}),l.bind("UploadProgress",function(a,b){h.currentTime=(new Date).getTime();var c=h.currentTime-h.startTime,d=b.loaded||0;h.isResumeUpload&&(d=b.loaded-h.resumeFilesize),b.speed=(d/c*1e3).toFixed(0)||0}),l.bind("ChunkUploaded",function(c,d,e){var f=b.parseJSON(e.response);g=g?g+","+f.ctx:f.ctx;var h=e.total-e.offset,i=c.getOption&&c.getOption("chunk_size");i=i||c.settings&&c.settings.chunk_size,i>h&&c.setOption({url:a+"/mkblk/"+h}),localStorage.setItem(d.name,JSON.stringify({ctx:g,percent:d.percent,total:e.total,offset:e.offset,time:(new Date).getTime()}))}),l.bind("Error",function(a){return function(c,d){var e="",f=d.file;if(f){switch(d.code){case plupload.FAILED:e="上传失败。请稍后再试。";break;case plupload.FILE_SIZE_ERROR:var g=c.getOption&&c.getOption("max_file_size");g=g||c.settings&&c.settings.max_file_size,e="浏览器最大可上传"+g+"。更大文件请使用命令行工具。";break;case plupload.FILE_EXTENSION_ERROR:e="文件验证失败。请稍后重试。";break;case plupload.HTTP_ERROR:if(""===d.response){e=d.message||"未知网络错误。";break}var h=b.parseJSON(d.response),i=h.error;switch(d.status){case 400:e="请求报文格式错误。";break;case 401:e="客户端认证授权失败。请重试或提交反馈。";break;case 405:e="客户端请求错误。请重试或提交反馈。";break;case 579:e="资源上传成功，但回调失败。";break;case 599:e="网络连接异常。请重试或提交反馈。";break;case 614:e="文件已存在。";try{h=b.parseJSON(h.error),i=h.error||"file exists"}catch(j){i=h.error||"file exists"}break;case 631:e="指定空间不存在。";break;case 701:e="上传数据块校验出错。请重试或提交反馈。";break;default:e="未知错误。"}e=e+"("+d.status+"："+i+")";break;case plupload.SECURITY_ERROR:e="安全配置错误。请联系网站管理员。";break;case plupload.GENERIC_ERROR:e="上传失败。请稍后再试。";break;case plupload.IO_ERROR:e="上传失败。请稍后再试。";break;case plupload.INIT_ERROR:e="网站配置错误。请联系网站管理员。",l.destroy();break;default:e=d.message+d.details}a&&a(c,d,e)}c.refresh()}}(e)),l.bind("FileUploaded",function(d){return function(e,f,h){var i=function(a,e,f){if(c.downtoken_url){var g=b.createAjax();g.open("POST",c.downtoken_url,!0),g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),g.onreadystatechange=function(){if(4===g.readyState)if(200===g.status){var c;try{c=b.parseJSON(g.responseText)}catch(h){throw"invalid json format"}var i={};plupload.extend(i,b.parseJSON(f),c),d&&d(a,e,JSON.stringify(i))}else l.trigger("Error",{status:g.status,response:g.responseText,file:e,code:plupload.HTTP_ERROR})},g.send("key="+b.parseJSON(f).key+"&domain="+c.domain)}else d&&d(a,e,f)},j=b.parseJSON(h.response);if(g=g?g:j.ctx){var m="";c.save_key||(m=k(e,f,b.key_handler),m=m?"/key/"+b.URLSafeBase64Encode(m):"");var n="/fname/"+b.URLSafeBase64Encode(f.name),o=c.x_vars,p="",q="";if(void 0!==o&&"object"==typeof o)for(var r in o)o.hasOwnProperty(r)&&("function"==typeof o[r]?p=b.URLSafeBase64Encode(o[r](e,f)):"object"!=typeof o[r]&&(p=b.URLSafeBase64Encode(o[r])),q+="/x:"+r+"/"+p);var s=a+"/mkfile/"+f.size+m+n+q,t=b.createAjax();t.open("POST",s,!0),t.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),t.setRequestHeader("Authorization","UpToken "+b.token),t.onreadystatechange=function(){if(4===t.readyState)if(localStorage.removeItem(f.name),200===t.status){var a=t.responseText;i(e,f,a)}else l.trigger("Error",{status:t.status,response:t.responseText,file:f,code:-200})},t.send(g)}else i(e,f,h.response)}}(f)),l},this.getUrl=function(a){if(!a)return!1;a=encodeURI(a);var b=this.domain;return"/"!==b.slice(b.length-1)&&(b+="/"),b+a},this.imageView2=function(a,b){var c=a.mode||"",d=a.w||"",e=a.h||"",f=a.q||"",g=a.format||"";if(!c)return!1;if(!d&&!e)return!1;var h="imageView2/"+c;return h+=d?"/w/"+d:"",h+=e?"/h/"+e:"",h+=f?"/q/"+f:"",h+=g?"/format/"+g:"",b&&(h=this.getUrl(b)+"?"+h),h},this.imageMogr2=function(a,b){var c=a["auto-orient"]||"",d=a.thumbnail||"",e=a.strip||"",f=a.gravity||"",g=a.crop||"",h=a.quality||"",i=a.rotate||"",j=a.format||"",k=a.blur||"",l="imageMogr2";return l+=c?"/auto-orient":"",l+=d?"/thumbnail/"+d:"",l+=e?"/strip":"",l+=f?"/gravity/"+f:"",l+=h?"/quality/"+h:"",l+=g?"/crop/"+g:"",l+=i?"/rotate/"+i:"",l+=j?"/format/"+j:"",l+=k?"/blur/"+k:"",b&&(l=this.getUrl(b)+"?"+l),l},this.watermark=function(a,b){var c=a.mode;if(!c)return!1;var d="watermark/"+c;if(1===c){var e=a.image||"";if(!e)return!1;d+=e?"/image/"+this.URLSafeBase64Encode(e):""}else{if(2!==c)return!1;var f=a.text?a.text:"",g=a.font?a.font:"",h=a.fontsize?a.fontsize:"",i=a.fill?a.fill:"";if(!f)return!1;d+=f?"/text/"+this.URLSafeBase64Encode(f):"",d+=g?"/font/"+this.URLSafeBase64Encode(g):"",d+=h?"/fontsize/"+h:"",d+=i?"/fill/"+this.URLSafeBase64Encode(i):""}var j=a.dissolve||"",k=a.gravity||"",l=a.dx||"",m=a.dy||"";return d+=j?"/dissolve/"+j:"",d+=k?"/gravity/"+k:"",d+=l?"/dx/"+l:"",d+=m?"/dy/"+m:"",b&&(d=this.getUrl(b)+"?"+d),d},this.imageInfo=function(a){if(!a)return!1;var b,c=this.getUrl(a)+"?imageInfo",d=this.createAjax(),e=this;return d.open("GET",c,!1),d.onreadystatechange=function(){4===d.readyState&&200===d.status&&(b=e.parseJSON(d.responseText))},d.send(),b},this.exif=function(a){if(!a)return!1;var b,c=this.getUrl(a)+"?exif",d=this.createAjax(),e=this;return d.open("GET",c,!1),d.onreadystatechange=function(){4===d.readyState&&200===d.status&&(b=e.parseJSON(d.responseText))},d.send(),b},this.get=function(a,b){return b&&a?"exif"===a?this.exif(b):"imageInfo"===a?this.imageInfo(b):!1:!1},this.pipeline=function(a,b){var c,d,e="[object Array]"===Object.prototype.toString.call(a),f="";if(e){for(var g=0,h=a.length;h>g;g++){if(c=a[g],!c.fop)return!1;switch(c.fop){case"watermark":f+=this.watermark(c)+"|";break;case"imageView2":f+=this.imageView2(c)+"|";break;case"imageMogr2":f+=this.imageMogr2(c)+"|";break;default:d=!0}if(d)return!1}if(b){f=this.getUrl(b)+"?"+f;var i=f.length;"|"===f.slice(i-1)&&(f=f.slice(0,i-1))}return f}return!1}}var Qiniu=new QiniuJsSDK;

/* mui-zoom 2016-05-09 */
!function(a,b){var c=a.className("zoom"),d=a.className("zoom-scroller"),e="."+c,f="."+d,g="pinchstart",h="pinch",i="pinchend";"ongesturestart"in b&&(g="gesturestart",h="gesturechange",i="gestureend"),a.Zoom=function(b,c){var d=this;d.options=a.extend(a.Zoom.defaults,c),d.wrapper=d.element=b,d.scroller=b.querySelector(f),d.scrollerStyle=d.scroller&&d.scroller.style,d.zoomer=b.querySelector(e),d.zoomerStyle=d.zoomer&&d.zoomer.style,d.init=function(){a.options.gestureConfig.pinch=!0,a.options.gestureConfig.doubletap=!0,d.initEvents()},d.initEvents=function(a){var b=a?"removeEventListener":"addEventListener",c=d.scroller;c[b](g,d.onPinchstart),c[b](h,d.onPinch),c[b](i,d.onPinchend),c[b]("touchstart",d.onTouchstart),c[b]("touchmove",d.onTouchMove),c[b]("touchcancel",d.onTouchEnd),c[b]("touchend",d.onTouchEnd),c[b]("drag",function(a){(q||m)&&a.stopPropagation()}),c[b]("doubletap",function(a){d.toggleZoom(a.detail.center)})},d.transition=function(a,b){return b=b||0,a.webkitTransitionDuration=b+"ms",d},d.translate=function(a,b,c){return b=b||0,c=c||0,a.webkitTransform="translate3d("+b+"px,"+c+"px,0px)",d},d.scale=function(a,b){return b=b||1,a.webkitTransform="translate3d(0,0,0) scale("+b+")",d},d.scrollerTransition=function(a){return d.transition(d.scrollerStyle,a)},d.scrollerTransform=function(a,b){return d.translate(d.scrollerStyle,a,b)},d.zoomerTransition=function(a){return d.transition(d.zoomerStyle,a)},d.zoomerTransform=function(a){return d.scale(d.zoomerStyle,a)};var j=1,k=1,l=!1,m=!1;d.onPinchstart=function(a){m=!0},d.onPinch=function(a){l||(d.zoomerTransition(0),l=!0),j=(a.detail?a.detail.scale:a.scale)*k,j>d.options.maxZoom&&(j=d.options.maxZoom-1+Math.pow(j-d.options.maxZoom+1,.5)),j<d.options.minZoom&&(j=d.options.minZoom+1-Math.pow(d.options.minZoom-j+1,.5)),d.zoomerTransform(j)},d.onPinchend=function(a){j=Math.max(Math.min(j,d.options.maxZoom),d.options.minZoom),d.zoomerTransition(d.options.speed).zoomerTransform(j),k=j,l=!1},d.setZoom=function(a){j=k=a,d.scrollerTransition(d.options.speed).scrollerTransform(0,0),d.zoomerTransition(d.options.speed).zoomerTransform(j)},d.toggleZoom=function(b,c){if("number"==typeof b&&(c=b,b=void 0),c="undefined"==typeof c?d.options.speed:c,j&&1!==j)j=k=1,d.scrollerTransition(c).scrollerTransform(0,0);else if(j=k=d.options.maxZoom,b){var e=a.offset(d.zoomer),f=e.top,g=e.left,h=(b.x-g)*j,i=(b.y-f)*j;this._cal(),h>=v&&v+n>=h?h=v-h+n/2:v>h?h=v-h+n/2:h>v+n&&(h=v+n-h-n/2),i>=w&&w+o>=i?i=w-i+o/2:w>i?i=w-i+o/2:i>w+o&&(i=w+o-i-o/2),h=Math.min(Math.max(h,t),v),i=Math.min(Math.max(i,u),w),d.scrollerTransition(c).scrollerTransform(h,i)}else d.scrollerTransition(c).scrollerTransform(0,0);d.zoomerTransition(c).zoomerTransform(j)},d._cal=function(){n=d.wrapper.offsetWidth,o=d.wrapper.offsetHeight,x=d.zoomer.offsetWidth,y=d.zoomer.offsetHeight;var a=x*j,b=y*j;t=Math.min(n/2-a/2,0),v=-t,u=Math.min(o/2-b/2,0),w=-u};var n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G={},H={};return d.onTouchstart=function(a){a.preventDefault(),p=!0,G.x="touchstart"===a.type?a.targetTouches[0].pageX:a.pageX,G.y="touchstart"===a.type?a.targetTouches[0].pageY:a.pageY},d.onTouchMove=function(b){if(b.preventDefault(),p){if(!q){n=d.wrapper.offsetWidth,o=d.wrapper.offsetHeight,x=d.zoomer.offsetWidth,y=d.zoomer.offsetHeight;var c=a.parseTranslateMatrix(a.getStyles(d.scroller,"webkitTransform"));z=c.x||0,A=c.y||0,d.scrollerTransition(0)}var e=x*j,f=y*j;if(!(n>e&&o>f)){if(t=Math.min(n/2-e/2,0),v=-t,u=Math.min(o/2-f/2,0),w=-u,H.x="touchmove"===b.type?b.targetTouches[0].pageX:b.pageX,H.y="touchmove"===b.type?b.targetTouches[0].pageY:b.pageY,!q&&!l&&(Math.floor(t)===Math.floor(z)&&H.x<G.x||Math.floor(v)===Math.floor(z)&&H.x>G.x))return void(p=!1);q=!0,r=H.x-G.x+z,s=H.y-G.y+A,t>r&&(r=t+1-Math.pow(t-r+1,.8)),r>v&&(r=v-1+Math.pow(r-v+1,.8)),u>s&&(s=u+1-Math.pow(u-s+1,.8)),s>w&&(s=w-1+Math.pow(s-w+1,.8)),B||(B=H.x),E||(E=H.y),C||(C=a.now()),D=(H.x-B)/(a.now()-C)/2,F=(H.y-E)/(a.now()-C)/2,Math.abs(H.x-B)<2&&(D=0),Math.abs(H.y-E)<2&&(F=0),B=H.x,E=H.y,C=a.now(),d.scrollerTransform(r,s)}}},d.onTouchEnd=function(a){if(a.touches.length||(m=!1),!p||!q)return p=!1,void(q=!1);p=!1,q=!1;var b=300,c=300,e=D*b,f=r+e,g=F*c,h=s+g;0!==D&&(b=Math.abs((f-r)/D)),0!==F&&(c=Math.abs((h-s)/F));var i=Math.max(b,c);r=f,s=h;var k=x*j,l=y*j;t=Math.min(n/2-k/2,0),v=-t,u=Math.min(o/2-l/2,0),w=-u,r=Math.max(Math.min(r,v),t),s=Math.max(Math.min(s,w),u),d.scrollerTransition(i).scrollerTransform(r,s)},d.destory=function(){d.initEvents(!0),delete a.data[d.wrapper.getAttribute("data-zoomer")],d.wrapper.setAttribute("data-zoomer","")},d.init(),d},a.Zoom.defaults={speed:300,maxZoom:3,minZoom:1},a.fn.zoom=function(b){var c=[];return this.each(function(){var d=null,e=this,f=e.getAttribute("data-zoomer");f?d=a.data[f]:(f=++a.uuid,a.data[f]=d=new a.Zoom(e,b),e.setAttribute("data-zoomer",f)),c.push(d)}),1===c.length?c[0]:c}}(mui,window);

/*im.js*/
(function(){var YTX_CONFIG={_server_ip:["MTIzLjU2LjEzNS44MTo3Njgy"],_file_server_url:"MTIzLjU2LjEzNS44MTo3Njgy",_lvs_servers:["MTIzLjU2LjEzNS44MTo4ODg4"],_socket:null,_appid:"",_version:"5.0.0.5",_ClientNo:0,_msgVersion:0,_syncMsgVersion:0,_maxMsgVersion:0,_syncMsgPorcessing:false,_receiveMsgBuf:[],_loginMode:1,_network:1,_sdkName:"YTX-HTML5-SDK",_token:null,_userName:null,_userPwd:null,_imei:null,_clientMap:{},_loginStatus:1,_isConnect:false,_ccpCustomData:null,_deviceType:21,_timeOutSecond:50,_fileTimeOutSecond:60,_heartBeatInterval:{_2G:45,_3G:90,_4G:180,_WIFI:300,_RECONNECT:15},_failHeartBeatInterval:10,_heartBeatTimeOut:5,_intervalId:null,_failIntervalId:null,_isConnecting:false,_reLoginNum:0,_isReconnect:false,_currentSession:0,_maxMsgLen:2048,_maxFileLen:1024*1024*10,_loginType:1,_sessionId:null,_pushListener:null,_noticeListener:null,_mcmListener:null,_connectStatListener:null,_voipListener:null,_msgNotifyListener:null,_heartBeatErrNum:0,_logLev:{_DEBUG:1,_INFO:2,_WARN:3,_ERROR:4},_logLevStat:1,_log:function(lev,content){if(lev<YTX_CONFIG._logLevStat){return}if(!window.console||!window.console.log||!window.console.info||!window.console.warn||!window.console.error){return}var timeStamp=YTX_CONFIG._getTimeStamp();content=timeStamp+" :: SDK :: "+content;if(lev==YTX_CONFIG._logLev._DEBUG){console.log(content)}else{if(lev==YTX_CONFIG._logLev._INFO){console.info(content)}else{if(lev==YTX_CONFIG._logLev._WARN){console.warn(content)}else{if(lev==YTX_CONFIG._logLev._ERROR){console.error(content)}}}}},_WS_TYPE:4,_ipSpeedTestConfig:{_count:10,_interval:1000,_timeout:{_3G:10*1000,_WIFI:5*1000,_LAN:1*1000,_4G:3*1000,_GPRS:20*1000,_OTHER:10*1000}},_msgType:{_TEXT:1,_VOICE:2,_VEDIO:3,_PICTURE:4,_POSITION:5,_FILE:6},_prototype:{_ipSpeedTest:5,_kickOff:6,_msg_CMD:9,_msg_DEL:21,_confirmMsg:15,_pushMsgNotify:18,_pushMsg:19,_login:20,_logout:21,_setMyInfo:23,_getMyInfo:24,_syncMsg:27,_sendMsg:29,_createGroup:30,_dismissGroup:31,_quitGroup:32,_joinGroup:33,_confirmJoinGroup:34,_inviteJoinGroup:35,_getGroupDetail:36,_getOwnGroups:37,_forbidMemberSpeak:38,_modifyGroup:39,_confirmInviteJoin:40,_searchGroups:41,_queryGroupMembers:42,_deleteGroupMember:43,_queryGroupMemberCard:44,_modifyMemberCard:45,_setGroupMessageRule:46,_mcmEventData:{_prototype:126,_mcmEventDef:{_userEvt_StartAsk:1,_userEvt_EndAsk:2,_userEvt_SendMSG:3,_agentEvt_sendMCM:53},_mcmChannel:{_mcmType_im:0}},_getHistoryMsg:59,_getUserState:71,_callRoute:127,_deleteReadMsg:72},_voipCallData:{_iceServers:[{url:"stun:stun.cloopen.com:3478"}],_peerConnection:null,_callEventCallId:null,_inviteSdp:null,_voipOtherView:null,_voipLocalView:null,_localMediaStream:null,_connected:false,_isVideo:false},_errcode:{_SUCC:200,_NO_LOGIN:170003,_NOT_SUPPORT_H5:174001,_NO_REQUIRED_PARAM:170002,_PARAM_TYPE_ERR:170012,_NETWORK_ERR:174002,_NETWORK_TIME_OUT:174003,_FILE_PARAM_ERROR:170012,_RESP_TIME_OUT:171137,_LOGIN_NO_USERNAME:170002,_LOGIN_NO_PWD:170002,_GROUP_NO_GROUPID:170002,_TEXT_TOO_LONG:170001,_FILE_TOO_LARGE:170001,_PARAM_OUT_OF_LENGTH:170001,_VOIP_NO_MEDIA:174004,_VOIP_MEDIA_ERROR:174005,_VOIP_NO_VIDEO:170002,_REQUEST_TOO_FREQUENT:174006,_CHARSET_ILLEGAl:170012,_NOT_SUPPORT_FILE:174007},_requestTime:null,_requestCounter:0,_requestLimit:300,_sendMsg:function(content){var curTime=new Date().getTime();if(!YTX_CONFIG._requestTime){YTX_CONFIG._requestTime=curTime;YTX_CONFIG._requestCounter=0}else{if((curTime-YTX_CONFIG._requestTime)>60*1000){YTX_CONFIG._requestTime=curTime;YTX_CONFIG._requestCounter=0}}if(YTX_CONFIG._requestCounter++<YTX_CONFIG._requestLimit){YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,"send msg : "+content);YTX_CONFIG._socket.send(content)}else{var json=eval("("+content+")");var msgLite=json.MsgLite;var clientNo=msgLite["3"];var request=YTX_CONFIG._clientMap[clientNo];if(!!request.timeout){clearTimeout(request.timeout)}var onError=request.onError;var resp={};resp.code=YTX_CONFIG._errcode._REQUEST_TOO_FREQUENT;onError(resp)}},_generateClientNo:function(callback,onError,msgId,endVersion,type,repeat,orignMsgId){var clientNo=++YTX_CONFIG._ClientNo;var data={};data.callback=callback;data.onError=onError;if(!!msgId){data.msgId=msgId}if(!!endVersion){data.endVersion=endVersion}if(!!type){data.type=type}if(!!repeat){data.repeat=repeat}if(!!orignMsgId){data.orignMsgId=orignMsgId}var i=setTimeout(function(){var resp={};if(YTX_CONFIG._loginStatus==2){YTX_CONFIG._loginStatus=1}resp.code=YTX_CONFIG._errcode._RESP_TIME_OUT;if(!!orignMsgId){resp.msgId=orignMsgId}if(!!msgId){resp.msgClientNo=msgId}onError(resp);delete YTX_CONFIG._clientMap[clientNo]},YTX_CONFIG._timeOutSecond*1000);data.timeout=i;YTX_CONFIG._clientMap[clientNo]=data;return clientNo},_noticeApp:function(obj){var msgId=obj.msgDateCreated+"|"+obj.version;obj.msgId=msgId;if(obj.msgType==YTX_CONFIG._prototype._msg_CMD){var resp=YTX_CONFIG._protobuf._parseNoticeMsg(obj);resp.msgId=obj.msgId;YTX_CONFIG._noticeListener(resp)}else{if(obj.msgType==YTX_CONFIG._prototype._msg_DEL){var resp=YTX_CONFIG._protobuf._parseMsgNotify(obj);YTX_CONFIG._msgNotifyListener(resp)}else{if(obj.mcmEvent!=0){YTX_CONFIG._mcmListener(obj)}else{YTX_CONFIG._pushListener(obj)}}}},_processSyncMsg:function(type,endVersion,requestType){if(1==type&&YTX_CONFIG._syncMsgPorcessing){return}if(!!endVersion&&endVersion<YTX_CONFIG._maxMsgVersion){var type=(!!requestType)?requestType:0;var sendStr=YTX_CONFIG._protobuf._buildSyncMessage(YTX_CONFIG._msgVersion+1,endVersion,type,function(){});if(!!sendStr){YTX_CONFIG._syncMsgPorcessing=true;YTX_CONFIG._sendMsg(sendStr)}else{YTX_CONFIG._syncMsgPorcessing=false}}else{if(YTX_CONFIG._msgVersion<YTX_CONFIG._maxMsgVersion){var end=YTX_CONFIG._maxMsgVersion;for(var i in YTX_CONFIG._receiveMsgBuf){if(i==(YTX_CONFIG._msgVersion+1)){var msg=YTX_CONFIG._receiveMsgBuf[(YTX_CONFIG._msgVersion+1)];delete YTX_CONFIG._receiveMsgBuf[(YTX_CONFIG._msgVersion+1)];YTX_CONFIG._msgVersion=YTX_CONFIG._msgVersion+1;if(!!msg){YTX_CONFIG._noticeApp(msg)}}else{end=i-1;break}}if(YTX_CONFIG._msgVersion!=YTX_CONFIG._maxMsgVersion){var sendStr=YTX_CONFIG._protobuf._buildSyncMessage(YTX_CONFIG._msgVersion+1,end,0,function(){});if(!!sendStr){YTX_CONFIG._syncMsgPorcessing=true;YTX_CONFIG._sendMsg(sendStr)}else{YTX_CONFIG._syncMsgPorcessing=false}}else{YTX_CONFIG._syncMsgPorcessing=false}}else{YTX_CONFIG._syncMsgPorcessing=false}}},_onResponse:function(obj){YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,"receive msg : "+obj);obj=eval("("+obj+")");if(!!obj.hb){YTX_CONFIG._heartBeatCallBack(obj.hb);return}obj=obj.MsgLite;if(!obj){return}if(!!obj["6"]&&obj["6"]!=YTX_CONFIG._errcode._SUCC){YTX_CONFIG._onResponseErr(obj);return}var type=obj["1"];if(type==YTX_CONFIG._prototype._callRoute){if(obj["6"]==YTX_CONFIG._errcode._SUCC){var data=YTX_CONFIG._clientMap[obj["3"]];if(data){clearTimeout(data.timeout)}}if(!!obj["2"]){var callEventData=YTX_CONFIG._protobuf._parseCallEventData(obj);YTX_CONFIG._processVoip(callEventData)}return}else{if(type==YTX_CONFIG._prototype._pushMsg){var pushMsg=YTX_CONFIG._protobuf._parsePushMsgResp(obj);if(!pushMsg.version){return}if(YTX_CONFIG._msgVersion+1==pushMsg.version){YTX_CONFIG._msgVersion+=1;YTX_CONFIG._noticeApp(pushMsg)}else{if(pushMsg.version>YTX_CONFIG._msgVersion){YTX_CONFIG._maxMsgVersion=(YTX_CONFIG._maxMsgVersion<pushMsg.version)?pushMsg.version:YTX_CONFIG._maxMsgVersion;YTX_CONFIG._receiveMsgBuf[pushMsg.version]=pushMsg;YTX_CONFIG._processSyncMsg(1)}}if(YTX_CONFIG._msgVersion%10==0){YTX_CONFIG._confirmMsg()}return}else{if(type==YTX_CONFIG._prototype._pushMsgNotify){var notifyResp=YTX_CONFIG._protobuf._parsePushMsgNotifyResp(obj);var msgVersion=notifyResp.version;var str=YTX_CONFIG._protobuf._buildSyncMessage(YTX_CONFIG._msgVersion+1,msgVersion,null,YTX_CONFIG._onSyncMsgRespErr);YTX_CONFIG._sendMsg(str);return}else{if(type==YTX_CONFIG._prototype._syncMsg){var request=YTX_CONFIG._clientMap[obj["3"]];if(!request){YTX_CONFIG._log(YTX_CONFIG._logLev._WARN,"receive a unrequest response, clientNo:"+obj["3"]);return}var resps=YTX_CONFIG._protobuf._parseSyncMsgResp(obj,request);var continuous=true;var end=request.endVersion;for(var i in resps){var resp=resps[i];if(!resp.version){continue}if(YTX_CONFIG._msgVersion>=resp.version){YTX_CONFIG._noticeApp(resp)}else{if(YTX_CONFIG._msgVersion+1==resp.version){YTX_CONFIG._msgVersion=(resp.version>YTX_CONFIG._msgVersion)?resp.version:YTX_CONFIG._msgVersion;if(YTX_CONFIG._msgVersion%10==0){YTX_CONFIG._confirmMsg()}YTX_CONFIG._noticeApp(resp)}else{if(continuous){continuous=false;end=resp.version-1}YTX_CONFIG._receiveMsgBuf[resp.version]=resp}}}if(!continuous){YTX_CONFIG._syncMsgPorcessing=false;YTX_CONFIG._processSyncMsg(2,end,request.type)}else{YTX_CONFIG._syncMsgPorcessing=false;YTX_CONFIG._processSyncMsg(2)}}else{if(type==YTX_CONFIG._prototype._mcmEventData._prototype){var mcmMsg=YTX_CONFIG._protobuf._parseMcmMsg(obj);if(!!mcmMsg){for(var i in mcmMsg){YTX_CONFIG._mcmListener(mcmMsg[i])}}var request=YTX_CONFIG._clientMap[obj["3"]];if(!request){return}if(!!request.timeout){clearTimeout(request.timeout)}if(!!request.callback){if(!!request.msgId){var resp={};resp.msgId=request.msgId;request.callback(resp)}else{request.callback()}}return}else{if(type==YTX_CONFIG._prototype._kickOff){var loginRsp=YTX_CONFIG._protobuf._parseKickOffResp(obj);YTX_CONFIG._logout();if(!!YTX_CONFIG._connectStatListener){YTX_CONFIG._connectStatListener(loginRsp)}return}}}}}}var request=YTX_CONFIG._clientMap[obj["3"]];if(!request){YTX_CONFIG._log(YTX_CONFIG._logLev._WARN,"receive a unrequest response, clientNo:"+obj["3"]);return}var callback=request.callback;clearTimeout(request.timeout);if(!callback){return}if(type==YTX_CONFIG._prototype._login){var loginRsp=YTX_CONFIG._protobuf._parseLoginResp(obj);if(loginRsp.authState==1){var loginRsp=YTX_CONFIG._protobuf._parseKickOffResp(obj);YTX_CONFIG._logout();if(!!YTX_CONFIG._connectStatListener){YTX_CONFIG._connectStatListener(loginRsp)}return}YTX_CONFIG._loginStatus=3;YTX_CONFIG._reLoginNum=0;YTX_CONFIG._heartBeatErrNum=0;if(!loginRsp.authToken){loginRsp.authToken=obj["8"]}if(!loginRsp.authToken&&!!YTX_CONFIG._token){loginRsp.authToken=YTX_CONFIG._token}if(YTX_CONFIG._msgVersion==0){YTX_CONFIG._msgVersion=loginRsp.historyver}YTX_CONFIG._maxMsgVersion=loginRsp.version;if(YTX_CONFIG._msgVersion<YTX_CONFIG._maxMsgVersion){YTX_CONFIG._processSyncMsg(2)}loginRsp.historyver=loginRsp.version;if(YTX_CONFIG._loginType==2){YTX_CONFIG._sessionId=loginRsp.authToken}else{YTX_CONFIG._token=loginRsp.authToken;YTX_CONFIG._sessionId=loginRsp.authToken}var transferPolicy=loginRsp.transferPolicy;var ipSpeedTestPolicy=loginRsp.ipSpeedTestPolicy;delete loginRsp.transferPolicy;delete loginRsp.ipSpeedTestPolicy;if(YTX_CONFIG._isReconnect){YTX_CONFIG._isReconnect=false;YTX_CONFIG._connectStateChange(3,"reconnect to server suc!")}if(!!YTX_CONFIG._intervalId){window.clearInterval(YTX_CONFIG._intervalId)}YTX_CONFIG._intervalId=window.setInterval(YTX_CONFIG._heartBeat,YTX_CONFIG._heartBeatInterval._WIFI*1000);if(!!YTX_CONFIG._failIntervalId){clearInterval(YTX_CONFIG._failIntervalId);YTX_CONFIG._failIntervalId=null}if(!!callback){callback(loginRsp)}if(!!transferPolicy){YTX_CONFIG._doTransferPolicy(transferPolicy)}if(!!ipSpeedTestPolicy){YTX_CONFIG._doIpSpeedTest(ipSpeedTestPolicy)}}else{if(type==YTX_CONFIG._prototype._logout){YTX_CONFIG._logout();callback(YTX_CONFIG._protobuf._parseCodeResp(obj))}else{if(type==YTX_CONFIG._prototype._sendMsg){callback(YTX_CONFIG._protobuf._parseSendMsgResp(obj,request))}else{if(type==YTX_CONFIG._prototype._getHistoryMsg){callback(YTX_CONFIG._protobuf._parseGetHistoryMsg(obj))}else{if(type==YTX_CONFIG._prototype._getMyInfo||type==YTX_CONFIG._prototype._setMyInfo){callback(YTX_CONFIG._protobuf._parseGetMyInfo(obj))}else{if(type==YTX_CONFIG._prototype._createGroup){callback(YTX_CONFIG._protobuf._parseCreateGroupResp(obj))}else{if(type==YTX_CONFIG._prototype._getOwnGroups){callback(YTX_CONFIG._protobuf._parseGetGroupListResp(obj))}else{if(type==YTX_CONFIG._prototype._queryGroupMembers){callback(YTX_CONFIG._protobuf._parseGetGroupMemberListResp(obj))}else{if(type==YTX_CONFIG._prototype._getGroupDetail){callback(YTX_CONFIG._protobuf._parseGetGroupDetailResp(obj))}else{if(type==YTX_CONFIG._prototype._searchGroups){callback(YTX_CONFIG._protobuf._parseSearchGroupsResp(obj))}else{if(type==YTX_CONFIG._prototype._queryGroupMemberCard){callback(YTX_CONFIG._protobuf._parseQueryGroupMemberCard(obj))}else{if(type==YTX_CONFIG._prototype._getUserState){callback(YTX_CONFIG._protobuf._parseGetUserState(obj))}else{callback(YTX_CONFIG._protobuf._parseCodeResp(obj))}}}}}}}}}}}}if(type!=YTX_CONFIG._prototype._sendMsg){delete YTX_CONFIG._clientMap[obj["3"]]}},_onSyncMsgRespErr:function(obj){YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,"syncMsgResp error : "+obj.code)},_processVoip:function(callEventData){if(!!YTX_CONFIG._voipCallData._callEventCallId&&YTX_CONFIG._voipCallData._callEventCallId!=callEventData.getCallId()&&callEventData.getCallEvent()!=1){return}if(callEventData.getCallEvent()==1){if(!YTX_CONFIG._voipCallData._callEventCallId){YTX_CONFIG._voipCallData._callEventCallId=callEventData.getCallId();var resp={};resp.callId=callEventData.getCallId();resp.caller=callEventData.getCaller();resp.called=callEventData.getCalled();resp.userdata=callEventData.getUserData();var sdpStr=callEventData.getStrSDP();YTX_CONFIG._voipCallData._inviteSdp=sdpStr;var type=0;if(sdpStr.indexOf("m=audio")>-1){if(sdpStr.indexOf("m=video")>-1){type=1;YTX_CONFIG._voipCallData._isVideo=true}}resp.callType=type;resp.state=6;YTX_CONFIG._voipListener(resp);callEventData.setCallEvent(2);callEventData.setStrSDP();var str=YTX_CONFIG._protobuf._buildCallEvent(callEventData,function(){},function(){});YTX_CONFIG._sendMsg(str)}else{if(callEventData.getCallId()==YTX_CONFIG._voipCallData._callEventCallId){return}else{if(callEventData.getCallId()!=YTX_CONFIG._voipCallData._callEventCallId){callEventData.setCallEvent(10);callEventData.setReason("486");callEventData.setStrSDP();var str=YTX_CONFIG._protobuf._buildCallEvent(callEventData,function(){},function(){});YTX_CONFIG._sendMsg(str)}}}}else{if(callEventData.getCallEvent()==2||callEventData.getCallEvent()==3){var resp={};resp.callId=callEventData.getCallId();resp.caller=callEventData.getCaller();resp.called=callEventData.getCalled();resp.userdata=callEventData.getUserData();resp.state=1;var type=0;if(YTX_CONFIG._voipCallData._isVideo){type=1}resp.callType=type;YTX_CONFIG._voipListener(resp)}else{if(callEventData.getCallEvent()==4){if(!callEventData.getStrSDP()){return}YTX_CONFIG._sendAck(callEventData);YTX_CONFIG._voipCallData._connected=true;var resp={};resp.callId=callEventData.getCallId();resp.caller=callEventData.getCaller();resp.called=callEventData.getCalled();resp.state=3;var type=0;if(YTX_CONFIG._voipCallData._isVideo){type=1}resp.callType=type;YTX_CONFIG._voipListener(resp)}else{if(callEventData.getCallEvent()==6){}else{if(callEventData.getCallEvent()==7||callEventData.getCallEvent()==8){var resp={};resp.callId=callEventData.getCallId();resp.caller=callEventData.getCaller();resp.called=callEventData.getCalled();resp.userdata=callEventData.getUserData();resp.state=5;var type=0;if(YTX_CONFIG._voipCallData._isVideo){type=1}resp.callType=type;YTX_CONFIG._voipListener(resp);YTX_CONFIG._releaseVoip()}else{if(callEventData.getCallEvent()==10){var resp={};resp.callId=callEventData.getCallId();resp.caller=callEventData.getCaller();resp.called=callEventData.getCalled();resp.reason=1;resp.userdata=callEventData.getUserData();if(callEventData.getReason()==486){resp.reason=2}var type=0;if(YTX_CONFIG._voipCallData._isVideo){type=1}resp.callType=type;resp.state=4;YTX_CONFIG._voipListener(resp);YTX_CONFIG._releaseVoip()}else{if(callEventData.getCallEvent()==11){callEventData.setCallEvent(4);callEventData.setStrSDP();var str=YTX_CONFIG._protobuf._buildCallEvent(callEventData,function(){},function(){});YTX_CONFIG._sendMsg(str)}else{if(callEventData.getCallEvent()==15){callEventData.setCallEvent(16);callEventData.setStrSDP();if(YTX_CONFIG._voipCallData._connected){callEventData.setReason(0)}var str=YTX_CONFIG._protobuf._buildCallEvent(callEventData,function(){},function(){});YTX_CONFIG._sendMsg(str)}}}}}}}}},_doTransferPolicy:function(transferPolicy){},_doIpSpeedTest:function(ipSpeedTestPolicy){var type=ipSpeedTestPolicy["1"];if(type==2){var ipAdds=ipSpeedTestPolicy["2"];for(var i in ipAdds){var ipAdd=ipAdds[i];if(ipAdd["3"]!=YTX_CONFIG._WS_TYPE){continue}var count=(!!ipSpeedTestPolicy["3"])?ipSpeedTestPolicy["3"]:YTX_CONFIG._ipSpeedTestConfig._count;var interval=(!!ipSpeedTestPolicy["4"])?ipSpeedTestPolicy["4"]:YTX_CONFIG._ipSpeedTestConfig._interval;var timeout=(!!ipSpeedTestPolicy["5"])?ipSpeedTestPolicy["5"]:YTX_CONFIG._ipSpeedTestConfig._timeout._WIFI;var num=0,receiveNum=0;var webSocket=new WebSocket("ws://"+ipAdd["1"]+":"+ipAdd["2"]);var startTime,endTime,maxDelay=0,minDelay=0,totalDelay=0;var tId=setTimeout(function(){YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,"ipSpeedTest timeout...");webSocket.close()},(interval*count+timeout));webSocket.tid=tId;webSocket._ip=ipAdd["1"];webSocket._port=ipAdd["2"];webSocket.num=0;webSocket.receiveNum=0;webSocket.onopen=function(event){var wb=this;YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,"start ipSpeedTest...");var intervalId=setInterval(function(){var tstamp=new Date().getTime();if(wb.num==0){wb.startTime=tstamp}var str='{"hb":'+(tstamp)+"}";wb.send(str);wb.num++;if(wb.num>=count){clearInterval(intervalId)}},interval)};webSocket.onmessage=function(event){var data=event.data;data=eval("("+data+")");this.endTime=new Date().getTime();var stime=data.hb;var delay=this.endTime-stime;if(!this.totalDelay){this.totalDelay=0}this.totalDelay+=delay;if(!this.maxDelay){this.maxDelay=delay}else{if(this.maxDelay<delay){this.maxDelay=delay}}if(!this.minDelay){this.minDelay=delay}else{if(this.minDelay>delay){this.minDelay=delay}}this.receiveNum++;if(this.receiveNum==count){clearTimeout(this.tid);this.close()}};webSocket.onclose=function(event){YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,"ipSpeedTest complete...");var netWork=YTX_CONFIG._getNetWork();var lost,averageDelay,costtime;if(this.receiveNum>0){lost=(count-this.receiveNum)/count*100;averageDelay=this.totalDelay/this.receiveNum}else{lost=100}var jsonStr='{"IpSpeedResult":{"1":'+netWork+',"3":"'+this._ip+'","4":'+this._port+',"5":'+lost;if(averageDelay>0){jsonStr+=',"6":'+averageDelay}if(this.minDelay>0){jsonStr+=',"7":'+this.minDelay}if(this.maxDelay>0){jsonStr+=',"8":'+this.maxDelay}if(!!ipSpeedTestPolicy["7"]){jsonStr+=',"11":"'+ipSpeedTestPolicy["7"]+'"'}jsonStr+="}}";var str='{"MsgLite":{"1":'+YTX_CONFIG._prototype._ipSpeedTest+',"2":'+jsonStr+"}}";if(YTX_CONFIG._loginStatus==3){YTX_CONFIG._sendMsg(str)}}}}else{if(type==1){}}},_getNetWork:function(){return 1},_onResponseErr:function(obj){var request=YTX_CONFIG._clientMap[obj["3"]];if(YTX_CONFIG._loginStatus==2){YTX_CONFIG._loginStatus=1}if(!!request.timeout){clearTimeout(request.timeout)}if(obj["1"]==YTX_CONFIG._prototype._getMyInfo&&obj["6"]==520015){var callback=request.callback;var resp={};resp.version=1;resp.nickName=YTX_CONFIG._userName;resp.sex=0;resp.birth="1970-01-01";callback(resp)}else{if((obj["6"]>=520001&&obj["6"]<=520010)||(obj["6"]>=520018&&obj["6"]<=520019)||(obj["6"]>=520021&&obj["6"]<=520021)||(obj["6"]>=520023&&obj["6"]<=520023)){var onError=request.onError;onError(YTX_CONFIG._protobuf._parseCodeResp(obj));return}else{if((obj["6"]>=520000&&obj["6"]<=529999)||(obj["6"]>=550000&&obj["6"]<=559999)||obj["6"]==219000){YTX_CONFIG._isReconnect=true;YTX_CONFIG._reLoginNum++;var onError=function(){};var callback=function(){};if(!!request){onError=request.onError;callback=request.callback}onError(YTX_CONFIG._protobuf._parseCodeResp(obj));YTX_CONFIG._connectStateChange(5,"connect fail,please relogin");return}}}var onError=request.onError;if(obj["1"]==YTX_CONFIG._prototype._login){YTX_CONFIG._loginStatus=1}if(obj["1"]==YTX_CONFIG._prototype._sendMsg||obj["1"]==YTX_CONFIG._prototype._mcmEventData._prototype){onError(YTX_CONFIG._protobuf._parseSendMsgRespErr(obj,request));return}delete YTX_CONFIG._clientMap[obj["3"]];var callback=request.callback;if(obj["6"]==580005){if(!request.repeat||request.repeat<3){if(!!request.repeat){request.repeat+=1}else{request.repeat=2}var sendStr=YTX_CONFIG._protobuf._buildSyncMessage(YTX_CONFIG._msgVersion+1,request.endVersion,request.type,function(){},request.repeat);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}}else{if((request.endVersion-YTX_CONFIG._msgVersion)>10){YTX_CONFIG._msgVersion=YTX_CONFIG._msgVersion+10}else{YTX_CONFIG._msgVersion=request.endVersion}YTX_CONFIG._processSyncMsg()}}else{onError(YTX_CONFIG._protobuf._parseCodeResp(obj))}},_initScoket:function(type,callback,onError,sig,timestamp,reset){$(window).unload(function(){YTX_CONFIG._confirmMsg();YTX_CONFIG._releaseVoip()});if(reset){if(!!YTX_CONFIG._socket){YTX_CONFIG._socket.onclose=function(){};YTX_CONFIG._socket.close();YTX_CONFIG._socket=null}YTX_CONFIG._isConnect=false;YTX_CONFIG._isConnecting=false}if(!YTX_CONFIG._isConnect&&!YTX_CONFIG._isConnecting){var serverip=Base64.decode(YTX_CONFIG._server_ip[0]);YTX_CONFIG._socket=new WebSocket("ws://"+serverip);YTX_CONFIG._isConnecting=true;var tId=setTimeout(function(){if(YTX_CONFIG._isConnecting){YTX_CONFIG._isConnecting=false;var resp={};resp.code=YTX_CONFIG._errcode._NETWORK_TIME_OUT;onError(resp);return}},YTX_CONFIG._timeOutSecond*1000);var sessionId=YTX_CONFIG._currentSession;YTX_CONFIG._socket.onopen=function(event){clearTimeout(tId);YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,"Client connect to Server ");YTX_CONFIG._isConnect=true;YTX_CONFIG._isConnecting=false;if(!YTX_CONFIG._imei){YTX_CONFIG._protobuf._generateImei()}YTX_CONFIG._loginType=type;var sendStr=YTX_CONFIG._protobuf._buildLogin(type,callback,onError,sig,timestamp);if(!!sendStr){YTX_CONFIG._loginStatus=2;YTX_CONFIG._sendMsg(sendStr)}};YTX_CONFIG._socket.onmessage=function(event){if(sessionId!=YTX_CONFIG._currentSession){return}var timeStamp=YTX_CONFIG._getTimeStamp();YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,timeStamp+" Client received a message",event);YTX_CONFIG._onResponse(event.data)};YTX_CONFIG._socket.onclose=function(event){clearTimeout(tId);if(sessionId!=YTX_CONFIG._currentSession){return}YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,"Client notified socket has closed",event);if(YTX_CONFIG._loginStatus==3){YTX_CONFIG._isConnect=false;YTX_CONFIG._isConnecting=false;YTX_CONFIG._loginStatus=1;YTX_CONFIG._connectStateChange(1,"connect closeed");YTX_CONFIG._reconnect(function(){});if(!!YTX_CONFIG._intervalId){window.clearInterval(YTX_CONFIG._intervalId)}YTX_CONFIG._intervalId=window.setInterval(YTX_CONFIG._heartBeat,YTX_CONFIG._heartBeatInterval._RECONNECT*1000)}else{if(YTX_CONFIG._isConnecting){YTX_CONFIG._isConnecting=false;var resp={};resp.code=YTX_CONFIG._errcode._NETWORK_ERR;onError(resp);return}}YTX_CONFIG._isConnecting=false};return}if(!!YTX_CONFIG._isConnect&&YTX_CONFIG._loginStatus==1){if(!YTX_CONFIG._imei){YTX_CONFIG._protobuf._generateImei()}var sendStr=YTX_CONFIG._protobuf._buildLogin(type,callback,onError,sig,timestamp);if(!!sendStr){YTX_CONFIG._loginStatus=2;YTX_CONFIG._sendMsg(sendStr)}}else{YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,"client is connection to server, do not login again")}},_checkOnline:function(onErr,msgId,msgClientNo){var resp={};if(!YTX_CONFIG._userName){resp.code=YTX_CONFIG._errcode._NO_LOGIN;if(!!msgId){resp.msgId=msgId}if(!!msgClientNo){resp.msgClientNo=msgClientNo}onErr(resp);return false}if(YTX_CONFIG._loginStatus!=3){YTX_CONFIG._log(YTX_CONFIG._logLev._WARN,"no user login");if(YTX_CONFIG._isConnect){resp.code=YTX_CONFIG._errcode._NO_LOGIN}else{resp.code=YTX_CONFIG._errcode._NETWORK_ERR}if(!!msgId){resp.msgId=msgId}if(!!msgClientNo){resp.msgClientNo=msgClientNo}onErr(resp);return false}return true},_generateFullMsgId:function(msgId){return YTX_CONFIG._token+"|"+msgId},_protobuf:{_buildLogout:function(callback,onError){if(!YTX_CONFIG._checkOnline(function(){},null)){YTX_CONFIG._logout();return null}if(!YTX_CONFIG._imei){YTX_CONFIG._protobuf._generateImei()}var logOutStr='{"Logout":{"1":"'+YTX_CONFIG._imei+'"}}';return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._logout+',"2":'+logOutStr+',"3":'+(YTX_CONFIG._generateClientNo(callback,function(){}))+"}}"},_buildLogin:function(type,callback,onError,sig,timestamp){var resp={};if(type!=1&&type!=2&&type!=3){return null}if(type!=2){if(!YTX_CONFIG._userName){resp.code=YTX_CONFIG._errcode._LOGIN_NO_USERNAME;onError(resp);return null}}if(type==3&&!YTX_CONFIG._userPwd){resp.code=YTX_CONFIG._errcode._LOGIN_NO_PWD;onError(resp);return null}if(!YTX_CONFIG._imei){YTX_CONFIG._protobuf._generateImei()}if(!YTX_CONFIG._userPwd){YTX_CONFIG._userPwd=""}if(!sig){sig=""}if(!timestamp){timestamp=""}var loginJsonStr;if(type!=2){loginJsonStr='{"UserAuth":{"1":'+type+',"2":"'+YTX_CONFIG._appid+'","3":"'+YTX_CONFIG._userName+'","4":"'+timestamp+'","5":'+YTX_CONFIG._deviceType+',"6":"'+sig+'","7":"'+YTX_CONFIG._version+'","8":"'+YTX_CONFIG._imei+'","9":'+YTX_CONFIG._loginMode+',"10":'+YTX_CONFIG._network+',"11":"'+YTX_CONFIG._userPwd+'"}}';return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._login+',"2":'+loginJsonStr+',"3":'+(YTX_CONFIG._generateClientNo(callback,onError))+"}}"}else{loginJsonStr='{"UserAuth":{"1":2,"8":"'+YTX_CONFIG._imei+'","10":'+YTX_CONFIG._network+"}}";return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._login+',"2":'+loginJsonStr+',"3":'+(YTX_CONFIG._generateClientNo(callback,onError))+',"8":"'+YTX_CONFIG._token+'"}}'}},_generateImei:function(){var cookie_name="ytx_cookie_"+YTX_CONFIG._userName+"_imei";var c_start=document.cookie.indexOf(cookie_name+"=");if(c_start!=-1){c_start=c_start+cookie_name.length+1;var c_end=document.cookie.indexOf(";",c_start);if(c_end==-1){c_end=document.cookie.length}YTX_CONFIG._imei=unescape(document.cookie.substring(c_start,c_end))}else{YTX_CONFIG._imei=hex_md5(YTX_CONFIG._appid+YTX_CONFIG._userName+YTX_CONFIG._sdkName);var exdate=new Date();exdate.setDate(exdate.getDate()+3600000*24*365);document.cookie=cookie_name+"="+escape(YTX_CONFIG._imei)+";expires="+exdate.toGMTString()}},_buildHeartBeat:function(){var id=setTimeout(YTX_CONFIG._heartBeatCallBackErr(++YTX_CONFIG._heartBeatErrNum),YTX_CONFIG._heartBeatTimeOut*1000);return'{"hb":'+id+"}"},_buildSendTextMsg:function(content,receiver,msgId,msgDomain,callback,onError,orignMsgId){var allMsgId=YTX_CONFIG._generateFullMsgId(msgId);if(!YTX_CONFIG._checkOnline(onError,orignMsgId,allMsgId)){YTX_CONFIG._ClientNo++;return null}if(!content||!receiver){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;resp.msgId=orignMsgId;resp.msgClientNo=allMsgId;onError(resp);return}if(content.length>YTX_CONFIG._maxMsgLen){var resp={};resp.code=YTX_CONFIG._errcode._TEXT_TOO_LONG;resp.msgId=orignMsgId;resp.msgClientNo=allMsgId;onError(resp);return}var compress=false;var len=0;if(content.length>200){}content=Base64.encode(content);var sendJsonStr='{"1":'+YTX_CONFIG._msgType._TEXT+',"2":"'+msgId+'","3":"'+content+'","4":"'+YTX_CONFIG._userName+'","5":"'+receiver+'"';if(!!msgDomain){msgDomain=msgDomain.replace(/\\/g,"\\\\");msgDomain=msgDomain.replace(/\"/g,'\\"');sendJsonStr+=',"6":"'+msgDomain+'"'}if(compress){sendJsonStr+=',"8":'+len+""}sendJsonStr+="}";var sendProto='{"SendMsg":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError,allMsgId,"","","",orignMsgId);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._sendMsg+',"2":'+sendProto+',"3":'+clientNo+"}}"},_buildSendFileMsgStart:function(file,content,receiver,msgType,msgId,msgDomain,type,onError,fileName,msgClientNo){if(!YTX_CONFIG._checkOnline(onError,msgId,msgClientNo)){return null}var name=null;if(file instanceof File){name=file.name}else{if(!!fileName){name=fileName}else{name=msgId}}if(!!msgDomain){msgDomain=msgDomain.replace(/\\/g,"\\\\");msgDomain=msgDomain.replace(/\"/g,'\\"')}var oringStr="yuntongxunytx123";var sig=hex_md5(oringStr);sig=sig.toUpperCase();var sendJsonStr='{"1":"'+YTX_CONFIG._appid+'","2":"'+msgType+'","3":"'+((!!content)?content:"")+'","4":"'+((!!msgDomain)?msgDomain:"")+'","5":"'+YTX_CONFIG._userName+'","6":"'+receiver+'","7":"'+name+'","8":"'+YTX_CONFIG._imei+'","9":"'+YTX_CONFIG._token+'","10":"'+sig+'","11":"'+type+'","12":'+file.size+',"13":"'+msgClientNo+'"';sendJsonStr+="}";return'{"start":'+sendJsonStr+"}"},_buildSendFileMsgEnd:function(callback,onError,msgId,orignMsgId){var jsonStr='{"1":'+YTX_CONFIG._generateClientNo(callback,onError,msgId,"","","",orignMsgId)+"}";return'{"end":'+jsonStr+"}"},_buildStartMcmMsg:function(osUnityAccount,userData,callback,onError){if(!YTX_CONFIG._checkOnline(onError)){return null}if(!YTX_CONFIG._imei){YTX_CONFIG._protobuf._generateImei()}var startMcmStr='{"MCMData":{"1":'+YTX_CONFIG._prototype._mcmEventData._mcmEventDef._userEvt_StartAsk+',"4":"'+YTX_CONFIG._userName+'","5":"'+osUnityAccount+'","8":"'+YTX_CONFIG._prototype._mcmEventData._mcmChannel._mcmType_im+'","15":"'+YTX_CONFIG._appid+'"';if(!!userData){startMcmStr+=',"16":"'+userData+'"'}if(!!YTX_CONFIG._ccpCustomData){startMcmStr+=',"17":"'+YTX_CONFIG._ccpCustomData+'"'}startMcmStr+="}}";return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._mcmEventData._prototype+',"2":'+startMcmStr+',"3":'+(YTX_CONFIG._generateClientNo(callback,onError))+"}}"},_buildSendMcmMsg:function(osUnitAccount,content,userData,type,msgId,callback,onError,orignMsgId){var allMsgId=YTX_CONFIG._token+"|"+msgId;if(!YTX_CONFIG._checkOnline(onError)){return null}if(!content){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;resp.msgId=orignMsgId;resp.msgClientNo=allMsgId;onError(resp);return}if(!YTX_CONFIG._imei){YTX_CONFIG._protobuf._generateImei()}var sendMcmStr='{"MCMData":{"1":'+YTX_CONFIG._prototype._mcmEventData._mcmEventDef._userEvt_SendMSG+',"4":"'+YTX_CONFIG._userName+'","5":"'+osUnitAccount+'",';var contentStr='{"1":'+type+',"2":"'+content+'"}';sendMcmStr+='"6":['+contentStr+'],"8":"'+YTX_CONFIG._prototype._mcmEventData._mcmChannel._mcmType_im+'","15":"'+YTX_CONFIG._appid+'"';if(!!userData){userData=userData.replace(/\\/g,"\\\\");userData=userData.replace(/\"/g,'\\"');sendMcmStr+=',"16":"'+userData+'"'}if(!!YTX_CONFIG._ccpCustomData){sendMcmStr+=',"17":"'+YTX_CONFIG._ccpCustomData+'"'}sendMcmStr+="}}";return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._mcmEventData._prototype+',"2":'+sendMcmStr+',"3":'+(YTX_CONFIG._generateClientNo(callback,onError,allMsgId,"","","",orignMsgId))+"}}"},_buildStopMcmMsg:function(osUnityAccount,userData,callback,onError){if(!YTX_CONFIG._checkOnline(onError)){return null}if(!YTX_CONFIG._imei){YTX_CONFIG._protobuf._generateImei()}var stopMcmStr='{"MCMData":{"1":'+YTX_CONFIG._prototype._mcmEventData._mcmEventDef._userEvt_EndAsk+',"4":"'+YTX_CONFIG._userName+'","5":"'+osUnityAccount+'","8":"'+YTX_CONFIG._prototype._mcmEventData._mcmChannel._mcmType_im+'","15":"'+YTX_CONFIG._appid+'"';if(!!userData){stopMcmStr+=',"16":"'+userData+'"'}if(!!YTX_CONFIG._ccpCustomData){stopMcmStr+=',"17":"'+YTX_CONFIG._ccpCustomData+'"'}stopMcmStr+="}}";return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._mcmEventData._prototype+',"2":'+stopMcmStr+',"3":'+(YTX_CONFIG._generateClientNo(callback,onError))+"}}"},_buildSyncMessage:function(startVersion,endVersion,type,onError,repeat){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(isNaN(startVersion)||isNaN(endVersion)||(!!type&&isNaN(type))){var resp={};resp.code=YTX_CONFIG._errcode._PARAM_TYPE_ERR;onError(resp);return}var syncMsgStr='{"SyncMsg":{"1":"';if(endVersion-startVersion<=10){syncMsgStr+=startVersion+","+endVersion+'"'}else{syncMsgStr+=startVersion+","+(parseInt(startVersion)+10)+'"'}if(!!type){syncMsgStr+=',"2":'+type}syncMsgStr+="}}";return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._syncMsg+',"2":'+syncMsgStr+',"3":'+(YTX_CONFIG._generateClientNo(null,onError,null,endVersion,type,repeat))+"}}"},_buildGetHistoryMessage:function(HistoryMsgBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!HistoryMsgBuilder.getTalker()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}var getHistoryMsgStr='{"HistoryMsg":{"1":"'+HistoryMsgBuilder.getTalker()+'"';if(!!HistoryMsgBuilder.getPageSize()){getHistoryMsgStr+=',"2":'+HistoryMsgBuilder.getPageSize()}if(HistoryMsgBuilder.getOperator()==1){var version=HistoryMsgBuilder.getVersion();if(version.indexOf("\\|")>0){var idx=version.indexOf("\\|");version=version.substr(idx+1)}getHistoryMsgStr+=',"3":"'+version+'"'}else{getHistoryMsgStr+=',"4":"'+HistoryMsgBuilder.getMsgId()+'"'}if(!!HistoryMsgBuilder.getOrder()){if(isNaN(HistoryMsgBuilder.getOrder())){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}getHistoryMsgStr+=',"5":'+HistoryMsgBuilder.getOrder()}getHistoryMsgStr+="}}";return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._getHistoryMsg+',"2":'+getHistoryMsgStr+',"3":'+(YTX_CONFIG._generateClientNo(callback,onError))+"}}"},_buildGetMyInfo:function(callback,onError){if(!YTX_CONFIG._checkOnline(onError)){return null}var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._getMyInfo+',"3":'+clientNo+"}}"},_buildSetMyInfo:function(uploadPersonInfoBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError)){return null}if(!uploadPersonInfoBuilder.getNickName()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;resp.msg="upload personInfo,nickName is null";onError(resp);return}if(!!uploadPersonInfoBuilder.getBirth()){var regx=/^(19|20)\d{2}-(1[0-2]|0[1-9])-(0[1-9]|[1-2][0-9]|3[0-1])$/;if(regx.exec(uploadPersonInfoBuilder.getBirth())==null){var resp={};resp.code=YTX_CONFIG._errcode._PARAM_TYPE_ERR;resp.msg="upload personInfo,birth is error, only accept format yyyy-MM-dd, eg:1990-01-01";onError(resp);return}}if(!!uploadPersonInfoBuilder.getSex()){var regx=/^(1|2)$/;if(regx.exec(uploadPersonInfoBuilder.getSex())==null){var resp={};resp.code=YTX_CONFIG._errcode._PARAM_TYPE_ERR;resp.msg="upload personInfo,sex is error, 1 is male and 2 is female";onError(resp);return}}if(!!uploadPersonInfoBuilder.getSign()&&uploadPersonInfoBuilder.getSign().length>100){var resp={};resp.code=YTX_CONFIG._errcode._PARAM_OUT_OF_LENGTH;resp.msg="upload personInfo,sign is error, sign length must less than 100";onError(resp);return}var uploadPersonInfoStr='{"PersonInfo":{"1":"'+uploadPersonInfoBuilder.getNickName()+'"';if(!!uploadPersonInfoBuilder.getSex()){uploadPersonInfoStr+=',"2":'+uploadPersonInfoBuilder.getSex()}if(!!uploadPersonInfoBuilder.getBirth()){uploadPersonInfoStr+=',"3":"'+uploadPersonInfoBuilder.getBirth()+'"'}if(!!uploadPersonInfoBuilder.getSign()){uploadPersonInfoStr+=',"4":"'+uploadPersonInfoBuilder.getSign()+'"'}uploadPersonInfoStr+="}}";return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._setMyInfo+',"2":'+uploadPersonInfoStr+',"3":'+(YTX_CONFIG._generateClientNo(callback,onError))+"}}"},_buildCreateGroup:function(createGroupBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!createGroupBuilder||!createGroupBuilder.getGroupName()||!createGroupBuilder.getScope()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}var sendJsonStr='{"1":"'+YTX_CONFIG._userName+'","2":"'+createGroupBuilder.getGroupName()+'","3":'+createGroupBuilder.getGroupType()+",";if(!!createGroupBuilder.getProvince()){sendJsonStr+='"4":"'+createGroupBuilder.getProvince()+'",'}if(!!createGroupBuilder.getCity()){sendJsonStr+='"5":"'+createGroupBuilder.getCity()+'",'}sendJsonStr+='"6":'+createGroupBuilder.getScope()+",";if(!!createGroupBuilder.getDeclared()){sendJsonStr+='"7":"'+createGroupBuilder.getDeclared()+'",'}sendJsonStr+='"8":'+createGroupBuilder.getPermission()+",";sendJsonStr+='"9":'+createGroupBuilder.getMode()+"";if(!!createGroupBuilder.getGroupDomain()){sendJsonStr+=',"10":"'+createGroupBuilder.getGroupDomain()+'"'}if(!!createGroupBuilder.getTarget()){if(isNaN(createGroupBuilder.getTarget())){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}sendJsonStr+=',"11":'+createGroupBuilder.getTarget()}sendJsonStr+="}";var sendProto='{"CreateGroup":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._createGroup+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_buildDismissGroup:function(dismissGroupBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!dismissGroupBuilder||!dismissGroupBuilder.getGroupId()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp)}var sendJsonStr="{";sendJsonStr+='"2":"'+dismissGroupBuilder.getGroupId()+'"}';var sendProto='{"DismissGroup":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._dismissGroup+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_buildInviteJoinGroupr:function(InviteGroupMemberBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!InviteGroupMemberBuilder||!InviteGroupMemberBuilder.getGroupId()||!InviteGroupMemberBuilder.getMembers()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp)}if(!(InviteGroupMemberBuilder.getMembers() instanceof Array)){var resp={};resp.code=YTX_CONFIG._errcode._PARAM_TYPE_ERR;onError(resp);return}var confirm=InviteGroupMemberBuilder.getConfirm();if(!confirm){confirm=2}else{if(isNaN(confirm)||(confirm!=1&&confirm!=2)){var resp={};resp.code=YTX_CONFIG._errcode._PARAM_TYPE_ERR;onError(resp);return}}var sendJsonStr="{";sendJsonStr+='"2":"'+InviteGroupMemberBuilder.getGroupId()+'",';if(!!InviteGroupMemberBuilder.getDeclared()){sendJsonStr+='"3":"'+InviteGroupMemberBuilder.getDeclared()+'",'}var members=InviteGroupMemberBuilder.getMembers();var memberStr="";for(var i in members){memberStr+='"'+members[i]+'",'}if(memberStr.length<=0){var resp={};resp.code=YTX_CONFIG._errcode._PARAM_TYPE_ERR;onError(resp);return}else{memberStr=memberStr.substr(0,memberStr.length-1)}sendJsonStr+='"4":['+memberStr+'],"5":'+InviteGroupMemberBuilder.getConfirm()+"}";var sendProto='{"InviteJoinGroup":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._inviteJoinGroup+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_buildConfirmInviteJoinGroupr:function(ConfirmInviteGroupMemberBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!ConfirmInviteGroupMemberBuilder||!ConfirmInviteGroupMemberBuilder.getGroupId()||!ConfirmInviteGroupMemberBuilder.getConfirm()||!ConfirmInviteGroupMemberBuilder.getInvitor()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp)}var confirm=ConfirmInviteGroupMemberBuilder.getConfirm();if(isNaN(confirm)){var resp={};resp.code=YTX_CONFIG._errcode._PARAM_TYPE_ERR;onError(resp);return}var sendJsonStr='{"1":"'+ConfirmInviteGroupMemberBuilder.getGroupId()+'","2":"'+ConfirmInviteGroupMemberBuilder.getInvitor()+'","3":'+ConfirmInviteGroupMemberBuilder.getConfirm()+"}";var sendProto='{"ConfirmInviteJoinGroup":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._confirmInviteJoin+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_buildQuitGroup:function(QuitGroupBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!QuitGroupBuilder||!QuitGroupBuilder.getGroupId()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}var sendJsonStr='{"2":"'+QuitGroupBuilder.getGroupId()+'"}';var sendProto='{"QuitGroup":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._quitGroup+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_buildGetGroupList:function(GetGroupListBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!GetGroupListBuilder||!GetGroupListBuilder.getPageSize()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}if(isNaN(GetGroupListBuilder.getPageSize())){var resp={};resp.code=YTX_CONFIG._errcode._PARAM_TYPE_ERR;onError(resp);return}var sendJsonStr="{";if(!!GetGroupListBuilder.getGroupId()){sendJsonStr+='"2":"'+GetGroupListBuilder.getGroupId()+'",'}sendJsonStr+='"3":'+GetGroupListBuilder.getPageSize();if(!!GetGroupListBuilder.getTarget()){sendJsonStr+=',"4":'+GetGroupListBuilder.getTarget()}sendJsonStr+="}";var sendProto='{"GetOwnerGroups":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._getOwnGroups+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_buildGetGroupMemberList:function(GetGroupMemberListBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!GetGroupMemberListBuilder||!GetGroupMemberListBuilder.getPageSize()||!GetGroupMemberListBuilder.getGroupId()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}if(isNaN(GetGroupMemberListBuilder.getPageSize())){var resp={};resp.code=YTX_CONFIG._errcode._PARAM_TYPE_ERR;onError(resp);return}var sendJsonStr='{"1":"'+GetGroupMemberListBuilder.getGroupId()+'",';if(!!GetGroupMemberListBuilder.getMemberId()){sendJsonStr+='"3":"'+GetGroupMemberListBuilder.getMemberId()+'",'}sendJsonStr+='"4":'+GetGroupMemberListBuilder.getPageSize()+"}";var sendProto='{"GetGroupMembers":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._queryGroupMembers+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_buildJoinGroup:function(JoinGroupBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!JoinGroupBuilder||!JoinGroupBuilder.getGroupId()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}var sendJsonStr='{"2":"'+JoinGroupBuilder.getGroupId()+'",';sendJsonStr+='"3":"'+JoinGroupBuilder.getDeclared()+'"}';var sendProto='{"JoinGroup":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._joinGroup+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_buildConfirmJoinGroup:function(ConfirmJoinGroupBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!ConfirmJoinGroupBuilder||!ConfirmJoinGroupBuilder.getGroupId()||!ConfirmJoinGroupBuilder.getMemberId()||!ConfirmJoinGroupBuilder.getConfirm()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}var sendJsonStr='{"2":"'+ConfirmJoinGroupBuilder.getGroupId()+'",';sendJsonStr+='"3":"'+ConfirmJoinGroupBuilder.getMemberId()+'","4":'+ConfirmJoinGroupBuilder.getConfirm()+"}";var sendProto='{"ConfirmJoinGroup":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._confirmJoinGroup+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_buildGetGroupDetail:function(GetGroupDetailBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!GetGroupDetailBuilder||!GetGroupDetailBuilder.getGroupId()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}var sendJsonStr='{"2":"'+GetGroupDetailBuilder.getGroupId()+'"}';var sendProto='{"GetGroupDetail":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._getGroupDetail+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_buildSearchGroups:function(SearchGroupsBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!SearchGroupsBuilder||!SearchGroupsBuilder.getSearchType()||!SearchGroupsBuilder.getKeywords){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}var sendJsonStr='{"2":'+SearchGroupsBuilder.getSearchType()+",";sendJsonStr+='"3":"'+SearchGroupsBuilder.getKeywords()+'"}';var sendProto='{"SearchGroups":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._searchGroups+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_buildDeleteGroupMember:function(DeleteGroupMemberBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!DeleteGroupMemberBuilder||!DeleteGroupMemberBuilder.getGroupId()||!DeleteGroupMemberBuilder.getMemberId()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}var sendJsonStr='{"2":"'+DeleteGroupMemberBuilder.getGroupId()+'",';sendJsonStr+='"3":["'+DeleteGroupMemberBuilder.getMemberId()+'"]}';var sendProto='{"DeleteGroupMember":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._deleteGroupMember+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_buildForbidMemberSpeak:function(ForbidMemberSpeakBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!ForbidMemberSpeakBuilder||!ForbidMemberSpeakBuilder.getGroupId()||!ForbidMemberSpeakBuilder.getMemberId()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}var sendJsonStr='{"2":"'+ForbidMemberSpeakBuilder.getGroupId()+'",';sendJsonStr+='"3":"'+ForbidMemberSpeakBuilder.getMemberId()+'","4":'+ForbidMemberSpeakBuilder.getForbidState()+"}";var sendProto='{"ForbidMemberSpeak":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._forbidMemberSpeak+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_buildSetGroupMessageRule:function(SetGroupMessageRuleBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!SetGroupMessageRuleBuilder||!SetGroupMessageRuleBuilder.getGroupId()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}var sendJsonStr='{"1":"'+SetGroupMessageRuleBuilder.getGroupId()+'"';if(!!SetGroupMessageRuleBuilder.getIsNotice()){sendJsonStr+=',"2":'+SetGroupMessageRuleBuilder.getIsNotice()}if(!!SetGroupMessageRuleBuilder.getIsApplePush()){sendJsonStr+=',"3":'+SetGroupMessageRuleBuilder.getIsApplePush()}sendJsonStr+="}";var sendProto='{"SetGroupMessagRule":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._setGroupMessageRule+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_buildQueryGroupMemberCard:function(QueryGroupMemberCard,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!QueryGroupMemberCard||!QueryGroupMemberCard.getMemberId()||!QueryGroupMemberCard.getBelong()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}var sendJsonStr='{"1":"'+QueryGroupMemberCard.getMemberId()+'","2":"'+QueryGroupMemberCard.getBelong()+'"}';var sendProto='{"QueryGroupMemberCard":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._queryGroupMemberCard+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_buildModifyMemberCard:function(ModifyMemberCardBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!ModifyMemberCardBuilder||!ModifyMemberCardBuilder.getMember()||!ModifyMemberCardBuilder.getBelong()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}var sendJsonStr='{"1":"'+ModifyMemberCardBuilder.getBelong()+'","2":"'+ModifyMemberCardBuilder.getMember()+'"';if(!!ModifyMemberCardBuilder.getDisplay()){sendJsonStr+=',"3":"'+ModifyMemberCardBuilder.getDisplay()+'"'}if(!!ModifyMemberCardBuilder.getPhone()){sendJsonStr+=',"4":"'+ModifyMemberCardBuilder.getPhone()+'"'}if(!!ModifyMemberCardBuilder.getMail()){sendJsonStr+=',"5":"'+ModifyMemberCardBuilder.getMail()+'"'}if(!!ModifyMemberCardBuilder.getRemark()){sendJsonStr+=',"6":"'+ModifyMemberCardBuilder.getRemark()+'"'}sendJsonStr+="}";var sendProto='{"ModifyMemberCard":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._modifyMemberCard+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_buildModifyGroup:function(ModifyGroupBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!ModifyGroupBuilder||!ModifyGroupBuilder.getGroupId()||!ModifyGroupBuilder.getGroupName()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}var sendJsonStr='{"2":"'+ModifyGroupBuilder.getGroupId()+'","3":"'+ModifyGroupBuilder.getGroupName()+'"';if(!!ModifyGroupBuilder.getType()){sendJsonStr+=',"4":'+ModifyGroupBuilder.getType()+""}if(!!ModifyGroupBuilder.getProvince()){sendJsonStr+=',"5":"'+ModifyGroupBuilder.getProvince()+'"'}if(!!ModifyGroupBuilder.getCity()){sendJsonStr+=',"6":"'+ModifyGroupBuilder.getCity()+'"'}if(!!ModifyGroupBuilder.getScope()){sendJsonStr+=',"7":'+ModifyGroupBuilder.getScope()+""}if(!!ModifyGroupBuilder.getDeclared()){sendJsonStr+=',"8":"'+ModifyGroupBuilder.getDeclared()+'"'}if(!!ModifyGroupBuilder.getPermission()){sendJsonStr+=',"9":'+ModifyGroupBuilder.getPermission()+""}if(!!ModifyGroupBuilder.getGroupDomain()){sendJsonStr+=',"9":'+ModifyGroupBuilder.getGroupDomain()+""}sendJsonStr+="}";var sendProto='{"ModifyGroup":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._modifyGroup+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_buildConfirmMsg:function(){if(!YTX_CONFIG._checkOnline(function(){},null)){return null}if(YTX_CONFIG._msgVersion==0||YTX_CONFIG._syncMsgVersion==YTX_CONFIG._msgVersion){return null}var sendJsonStr='{"1":'+YTX_CONFIG._msgVersion+"}";var sendProto='{"ConfirmMsg":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(function(){YTX_CONFIG._syncMsgVersion=YTX_CONFIG._msgVersion},function(){});return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._confirmMsg+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_getStateTime:null,_getStateCount:0,_buildGetUserState:function(GetUserStateBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}var curTime=new Date().getTime();if(!YTX_CONFIG._protobuf._getStateTime){YTX_CONFIG._protobuf._getStateTime=curTime;YTX_CONFIG._protobuf._getStateCount=0}else{if(((curTime-YTX_CONFIG._protobuf._getStateTime)>3000)){YTX_CONFIG._protobuf._getStateCount=0;YTX_CONFIG._protobuf._getStateTime=curTime}}if(YTX_CONFIG._protobuf._getStateCount++>0){var resp={};resp.code=YTX_CONFIG._errcode._REQUEST_TOO_FREQUENT;onError(resp);return}var sendJsonStr='{"1":"'+GetUserStateBuilder.getUseracc()+'"}';var sendProto='{"GetUserState":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._getUserState+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_CallEventData:function(callEvent,callId,isVoipCall,called,caller,userData,strSDP,reason){this._callEvent=callEvent;this._callId=callId;this._isVoipCall=isVoipCall;this._called=called;this._caller=caller;this._userData=userData;this._strSDP=strSDP;this._reason=reason;this.setCallEvent=function(callEvent){this._callEvent=callEvent};this.setCallId=function(callId){this._callId=callId};this.setIsVoipCall=function(isVoipCall){this._isVoipCall=isVoipCall};this.setCalled=function(called){this._called=called};this.setCaller=function(caller){this._caller=caller};this.setUserData=function(userData){this._userData=userData};this.setStrSDP=function(strSDP){this._strSDP=strSDP};this.setReason=function(reason){this._reason=reason};this.getCallEvent=function(){return this._callEvent};this.getCallId=function(){return this._callId};this.getIsVoipCall=function(){return this._isVoipCall};this.getCalled=function(){return this._called};this.getCaller=function(){return this._caller};this.getUserData=function(){return this._userData};this.getStrSDP=function(){return this._strSDP};this.getReason=function(){return this._reason}},_buildCallEvent:function(CallEventBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!CallEventBuilder||!CallEventBuilder.getCalled()||!CallEventBuilder.getCaller()||!CallEventBuilder.getCalled()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}var sendJsonStr='{"1":'+CallEventBuilder.getCallEvent()+',"2":"'+CallEventBuilder.getCallId()+'"';if(CallEventBuilder.getIsVoipCall()==0||CallEventBuilder.getIsVoipCall()==1||CallEventBuilder.getIsVoipCall()==2){sendJsonStr+=',"3":'+CallEventBuilder.getIsVoipCall()+""}sendJsonStr+=',"5":"'+CallEventBuilder.getCalled()+'"';sendJsonStr+=',"7":"'+CallEventBuilder.getCaller()+'"';if(!!CallEventBuilder.getReason()){sendJsonStr+=',"10":"'+CallEventBuilder.getReason()+'"'}if(!!CallEventBuilder.getUserData()){sendJsonStr+=',"13":"'+CallEventBuilder.getUserData()+'"'}if(!!CallEventBuilder.getStrSDP()){sendJsonStr+=',"17":"'+CallEventBuilder.getStrSDP()+'"'}sendJsonStr+="}";var sendProto='{"CallEventDataInner":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError,CallEventBuilder.getCallId());return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._callRoute+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_buildDeleteReadMsg:function(DeleteReadMsgBuilder,callback,onError){if(!YTX_CONFIG._checkOnline(onError,null)){return null}if(!DeleteReadMsgBuilder.getMsgid()){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;onError(resp);return}var version=DeleteReadMsgBuilder.getMsgid();var idx=version.indexOf("|");if(idx>0){version=version.substr(idx+1)}var sendJsonStr="{";sendJsonStr+='"1":"'+version+'"';sendJsonStr+="}";var sendProto='{"DeleteReadMsg":'+sendJsonStr+"}";var clientNo=YTX_CONFIG._generateClientNo(callback,onError);return'{"MsgLite":{"1":'+YTX_CONFIG._prototype._deleteReadMsg+',"2":'+sendProto+',"3":'+(clientNo)+"}}"},_parseLoginResp:function(obj){var data=obj["2"];data=data.UserAuthResp;var resp={};resp.authState=data["1"];resp.kickoffText=data["2"];resp.connectorId=data["3"];resp.version=(!!data["4"])?data["4"]:0;resp.transferPolicy=data["6"];resp.pversion=data["7"];resp.softVersion=data["8"];resp.historyver=(!!data["10"])?data["10"]:0;resp.authToken=data["11"];resp.ipSpeedTestPolicy=data["12"];return resp},_parseCodeResp:function(obj){var resp={};resp.code=obj["6"];return resp},_parseSendMsgResp:function(obj,request){var data=obj["2"];var resp={};if(!!data&&!!data.SendMsgResp){data=data.SendMsgResp;resp.token=data["1"];resp.url=data["2"]}var clientNo=obj["3"];var msgId=request.orignMsgId;var msgClientNo=request.msgId;resp.msgId=msgId;resp.msgClientNo=msgClientNo;return resp},_parseSendMsgRespErr:function(obj,request){var resp={};var clientNo=obj["3"];resp.msgClientNo=request.msgId;resp.msgId=request.orignMsgId;resp.code=obj["6"];return resp},_parsePushMsgResp:function(obj){var data=obj["2"];data=data.PushMsg;var resp={};resp.version=data["1"];resp.msgType=(!!data["2"])?data["2"]:1;if(!!data["4"]){resp.msgContent=Base64.decode(data["4"])}else{resp.msgContent=""}resp.msgSender=data["5"];resp.msgReceiver=data["6"];resp.msgDomain=data["7"];resp.msgFileName=data["8"];if(!!data["9"]){var fileUrl=data["9"];if(fileUrl.indexOf("_thum")>0){fileUrl=fileUrl.substring(0,fileUrl.indexOf("_thum"))}if(resp.msgType==2){fileUrl=fileUrl.substring(0,fileUrl.lastIndexOf("."))+".mp3"}var len=YTX_CONFIG._lvs_servers.length;var Range=len-1;var Rand=Math.random();var idx=Math.round(Rand*Range);var lvsServer=Base64.decode(YTX_CONFIG._lvs_servers[idx]);resp.msgFileUrl="http://"+lvsServer+fileUrl;if(resp.msgType==3){resp.msgFileUrlThum=resp.msgFileUrl+"_thum"}}resp.msgDateCreated=data["10"];resp.senderNickName=data["13"];resp.mcmEvent=0;if(!!data["14"]){resp.msgFileSize=data["14"]}return resp},_parseNoticeMsg:function(obj){var domain=obj.msgDomain;domain=Base64.decode(domain).replace(new RegExp(/(')/g),'"');var domainInfo=eval("("+domain+")");var resp={};resp.auditType=domainInfo.auditType;resp.groupId=domainInfo.groupId;resp.groupName=domainInfo.groupName;resp.declared=domainInfo.declared;resp.confirm=domainInfo.confirm;resp.ext=domainInfo.ext;resp.version=obj.version;resp.serviceNo=obj.msgSender;resp.target=domainInfo.target;if(domainInfo.auditType==2||domainInfo.auditType==4||domainInfo.auditType==10){resp.admin=domainInfo.member;resp.adminName=domainInfo.nickName}else{if(domainInfo.auditType==11){resp.admin=domainInfo.admin;resp.member=domainInfo.member;resp.memberName=domainInfo.nickName}else{resp.member=domainInfo.member;resp.memberName=domainInfo.nickName}}return resp},_parsePushMsgNotifyResp:function(obj){var data=obj["2"];data=data.PushMsgNotify;var resp={};resp.version=data["1"];return resp},_parseMsgNotify:function(obj){var domain=obj.msgDomain;var domainInfo=eval("("+domain+")");var msgId=domainInfo.msgid;var resp={};resp.msgType=obj.msgType;resp.sender=obj.msgSender;resp.msgId=msgId;resp.dateCreated=obj.dateCreated;return resp},_parseSyncMsgResp:function(obj,request){var data=obj["2"];data=data.SyncMsgResp;var resp=new Array();var recVersion=0;for(var i in data){var orign=data[i];var msg={};msg.version=orign["1"];if(recVersion<msg.version){recVersion=msg.version}msg.msgType=(!!orign["2"])?orign["2"]:1;msg.msgContent=orign["4"];if(!!orign["4"]){msg.msgContent=Base64.decode(orign["4"])}else{msg.msgContent=""}msg.msgSender=orign["5"];msg.msgReceiver=orign["6"];msg.msgDomain=orign["7"];msg.msgFileName=orign["8"];if(!!orign["9"]){var fileUrl=orign["9"];if(fileUrl.indexOf("_thum")>0){fileUrl=fileUrl.substring(0,fileUrl.indexOf("_thum"))}if(msg.msgType==2){fileUrl=fileUrl.substring(0,fileUrl.lastIndexOf("."))+".mp3"}var len=YTX_CONFIG._lvs_servers.length;var Range=len-1;var Rand=Math.random();var idx=Math.round(Rand*Range);var lvsServer=Base64.decode(YTX_CONFIG._lvs_servers[idx]);msg.msgFileUrl="http://"+lvsServer+fileUrl;if(msg.msgType==3){msg.msgFileUrlThum=msg.msgFileUrl+"_thum"}}msg.msgDateCreated=orign["10"];if(!!orign["13"]){msg.mcmEvent=orign["13"]}else{msg.mcmEvent=0}if(!!orign["14"]){msg.msgFileSize=orign["14"]}resp.push(msg)}return resp},_parseGetHistoryMsg:function(obj){var data=obj["2"];data=data.HistoryMsgResp;data=data["1"];var resp=new Array();for(var i in data){var orign=data[i];var msg={};msg.msgType=(!!orign["2"])?orign["2"]:1;if(orign["5"]==YTX_CONFIG._userName&&orign["6"]!=YTX_CONFIG._userName){msg.msgId=(!!orign["3"])?orign["3"]:""}else{msg.msgId=orign["10"]+"|"+orign["1"]}msg.msgContent=orign["4"];msg.msgSender=orign["5"];msg.msgReceiver=orign["6"];msg.msgDomain=orign["7"];msg.msgFileName=orign["8"];if(!!orign["9"]){var fileUrl=orign["9"];if(fileUrl.indexOf("_thum")>0){fileUrl=fileUrl.substring(0,fileUrl.indexOf("_thum"))}if(msg.msgType==2){fileUrl=fileUrl.substring(0,fileUrl.lastIndexOf("."))+".mp3"}var len=YTX_CONFIG._lvs_servers.length;var Range=len-1;var Rand=Math.random();var idx=Math.round(Rand*Range);var lvsServer=Base64.decode(YTX_CONFIG._lvs_servers[idx]);msg.msgFileUrl="http://"+lvsServer+fileUrl;if(msg.msgType==3){msg.msgFileUrlThum=msg.msgFileUrl+"_thum"}}msg.msgDateCreated=orign["10"];if(!!orign["13"]){msg.senderNickName=orign["13"]}if(!!orign["14"]){msg.msgFileSize=orign["14"]}msg.mcmEvent=0;resp.push(msg)}return resp},_parseGetMyInfo:function(obj){var data=obj["2"];data=data.PersonInfoResp;var resp={};resp.version=data["1"];resp.nickName=data["2"];resp.sex=data["3"];resp.birth=data["4"];resp.sign=data["5"];return resp},_parseMcmMsg:function(obj){var data=obj["2"];if(!data){return}data=data.MCMData;var msgs=new Array();if(!!data["6"]){var msgInfos=data["6"];for(var i in msgInfos){var msgInfo=msgInfos[i];var msg={};msg.mcmEvent=data["1"];msg.version=data["2"];msg.msgDateCreated=data["3"];msg.msgDomain=data["16"];if(msg.mcmEvent==YTX_CONFIG._prototype._mcmEventData._mcmEventDef._agentEvt_sendMCM){msg.msgSender=data["5"];msg.msgReceiver=data["4"]}else{msg.msgSender=data["4"];msg.msgReceiver=data["5"]}msg.msgContent=msgInfo["2"];msg.msgType=msgInfo["1"];msg.msgFileUrl=msgInfo["3"];msg.msgFileName=msgInfo["4"];msgs.push(msg)}}return msgs},_parseCreateGroupResp:function(obj){var data=obj["2"];if(!data){return}data=data.CreateGroupResp;var msg={};msg.data=data["1"];return msg},_parseGetGroupListResp:function(obj){var data=obj["2"];var resp=new Array();if(!data){return resp}data=data.GetOwnerGroupsResp;data=data["1"];for(var i in data){var simpleObj=data[i];var simpleGroup={};simpleGroup.groupId=simpleObj["1"];simpleGroup.name=simpleObj["2"];simpleGroup.owner=simpleObj["3"];simpleGroup.permission=simpleObj["4"];simpleGroup.isNotice=simpleObj["5"];simpleGroup.memberCount=simpleObj["6"];simpleGroup.scope=simpleObj["7"];simpleGroup.dateCreated=simpleObj["8"];simpleGroup.target=simpleObj["9"];resp.push(simpleGroup)}return resp},_parseGetGroupMemberListResp:function(obj){var data=obj["2"];var resp=new Array();if(!data){return resp}data=data.GetGroupMembersResp;var groupId=data["1"];data=data["2"];for(var i in data){var obj=data[i];var member={};member.member=obj["1"];member.nickName=obj["2"];member.speakState=obj["3"];member.role=obj["4"];member.sex=obj["5"];resp.push(member)}return resp},_parseGetGroupDetailResp:function(obj){var data=obj["2"];var resp={};data=data.GetGroupDetailResp;resp.creator=data["1"];resp.groupName=data["2"];resp.type=data["3"];resp.province=data["4"];resp.city=data["5"];resp.scope=data["6"];resp.declared=data["7"];resp.dateCreated=data["8"];resp.numbers=data["9"];resp.isNotice=data["10"];resp.permission=data["11"];resp.groupDomain=data["12"];resp.isApplePush=data["13"];resp.target=data["14"];return resp},_parseSearchGroupsResp:function(obj){var data=obj["2"];var resp=new Array();if(!data){return resp}data=data.SearchGroupsResp;data=data["1"];for(var i in data){var simpleObj=data[i];var simpleGroup={};simpleGroup.groupId=simpleObj["1"];simpleGroup.name=simpleObj["2"];simpleGroup.owner=simpleObj["3"];simpleGroup.permission=simpleObj["4"];simpleGroup.declared=simpleObj["5"];simpleGroup.memberCount=simpleObj["6"];simpleGroup.scope=simpleObj["7"];resp.push(simpleGroup)}return resp},_parseQueryGroupMemberCard:function(obj){var data=obj["2"];var resp={};if(!data){return resp}data=data.QueryGroupMemberCardResp;resp.member=data["1"];resp.groupid=data["2"];resp.display=data["3"];resp.phone=data["4"];resp.mail=data["5"];resp.remark=data["6"];resp.speakState=data["7"];resp.role=data["8"];resp.sex=data["9"];return resp},_parseKickOffResp:function(obj){var data=obj["2"];data=data.UserAuthResp;var resp={};resp.code=4;resp.msg=data["2"];return resp},_parseGetUserState:function(obj){var data=obj["2"];var resp={};if(!data){return resp}data=data.GetUserStateResp;resp.useracc=data["1"];resp.network=data["2"];resp.state=data["3"];resp.device=data["4"];return resp},_parseCallEventData:function(obj){var data=obj["2"];var resp={};if(!data){return resp}data=data.CallEventData;var resp=new YTX_CONFIG._protobuf._CallEventData(data["1"],data["2"],data["3"],data["5"],data["7"],data["13"],data["17"]);return resp}},_logout:function(){YTX_CONFIG._token=null;YTX_CONFIG._userName=null;YTX_CONFIG._userPwd=null;YTX_CONFIG._imei=null;for(var i in YTX_CONFIG._clientMap){var request=YTX_CONFIG._clientMap[i];if(!request){return}if(!!request.timeout){clearTimeout(request.timeout)}}YTX_CONFIG._clientMap={};YTX_CONFIG._currentSession=null;YTX_CONFIG._ClientNo=0;YTX_CONFIG._sendMsgId=0;YTX_CONFIG._msgVersion=0;YTX_CONFIG._syncMsgVersion=0;YTX_CONFIG._maxMsgVersion=0;YTX_CONFIG._syncMsgPorcessing=false;YTX_CONFIG._receiveMsgBuf=[];YTX_CONFIG._isReconnect=false;YTX_CONFIG._loginStatus=1;YTX_CONFIG._isConnect=false;YTX_CONFIG._socket.close();YTX_CONFIG._socket=null;window.clearInterval(YTX_CONFIG._intervalId);YTX_CONFIG._intervalId=null;YTX_CONFIG._releaseVoip()},_connectStateChange:function(code,msg){if(YTX_CONFIG._connectStatListener){var resp={};resp.code=code;resp.msg=msg;YTX_CONFIG._connectStatListener(resp)}},_onShortAuthFail:function(callback){YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,"shrot autl fail, complete auth");YTX_CONFIG._isReconnect=true;if(YTX_CONFIG._userPwd){YTX_CONFIG._initScoket(3,callback,function(){})}else{YTX_CONFIG._initScoket(1,callback,function(){})}},_reconnect:function(callback){YTX_CONFIG._connectStateChange(2,"reconnect to server");YTX_CONFIG._isReconnect=true;YTX_CONFIG._initScoket(2,callback,function(){},null,null,true)},_sendFile:function(fileInfo,content,receiver,msgType,msgId,msgDomain,type,callback,onError,progress,fileName,orignMsgId){if(!YTX_CONFIG._checkOnline(onError,orignMsgId,msgId)){YTX_CONFIG._ClientNo++;return}if(!fileInfo||!receiver||!msgType){var resp={};resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;resp.msgId=orignMsgId;resp.msgClientNo=msgId;onError(resp);return}if(isNaN(msgType)){var resp={};resp.code=YTX_CONFIG._errcode._PARAM_TYPE_ERR;resp.msgId=orignMsgId;resp.msgClientNo=msgId;onError(resp);return}var sendStatus=1;if(!(fileInfo instanceof File)&&!(fileInfo instanceof Blob)){var resp={};resp.code=YTX_CONFIG._errcode._FILE_PARAM_ERROR;resp.msgId=orignMsgId;resp.msgClientNo=msgId;onError(resp);return}if(fileInfo.size>=YTX_CONFIG._maxFileLen){var resp={};resp.code=YTX_CONFIG._errcode._FILE_TOO_LARGE;resp.msgId=orignMsgId;resp.msgClientNo=msgId;onError(resp);return}var tId=setTimeout(function(){if(sendStatus==2){return}sendStatus=3;var resp={};if(YTX_CONFIG._loginStatus==2){YTX_CONFIG._loginStatus=1}resp.code=YTX_CONFIG._errcode._RESP_TIME_OUT;resp.msgId=orignMsgId;resp.msgClientNo=msgId;onError(resp)},YTX_CONFIG._fileTimeOutSecond*1000);var fileurl=Base64.decode(YTX_CONFIG._file_server_url);var ws=new WebSocket("ws://"+fileurl);ws.onopen=function(event){if(sendStatus==3){ws.close();return}sendStatus=2;YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,"connect to file socket");var sendStr=YTX_CONFIG._protobuf._buildSendFileMsgStart(fileInfo,null,receiver,msgType,orignMsgId,msgDomain,type,onError,fileName,msgId);if(!sendStr){return}YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,sendStr);ws.send(sendStr);var reader=new FileReader();reader.readAsArrayBuffer(fileInfo);reader.onload=function loaded(evt){var binaryString=evt.target.result;var start=0;var total=binaryString.byteLength;var buf=10*1024;while(start<total){var part;var end=start+buf;if(end>total){end=total}if(binaryString.slice){part=binaryString.slice(start,end)}else{if(binaryString.mozSlice){part=blob.mozSlice(start,end)}else{if(blob.webkitSlice){part=blob.webkitSlice(start,end)}}}ws.send(part);progress(start,total,msgId);start=end}progress(total,total,msgId);sendStr=YTX_CONFIG._protobuf._buildSendFileMsgEnd(callback,onError,msgId,orignMsgId);if(!sendStr){return}ws.send(sendStr)}};ws.onmessage=function(event){clearTimeout(tId);YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,"file client received a message");YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,event.data);var data=eval("("+event.data+")");data=data.state;var request=YTX_CONFIG._clientMap[data["2"]];var resp={};resp.msgId=orignMsgId;resp.msgClientNo=msgId;clearTimeout(request.timeout);var callback=request.callback;var onError=request.onError;if(data["1"]=="000000"){callback(resp)}else{var resp={};resp.msgId=orignMsgId;resp.msgClientNo=msgId;resp.code=data["1"];onError(resp)}ws.close()};ws.onclose=function(event){YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,"file client socket has closed",event)}},_heartBeat:function(){if(!YTX_CONFIG._isReconnect){var heartBeatStr=YTX_CONFIG._protobuf._buildHeartBeat();YTX_CONFIG._sendMsg(heartBeatStr)}else{if(!YTX_CONFIG._isConnecting){YTX_CONFIG._reconnect(function(){})}}},_heartBeatCallBack:function(obj){YTX_CONFIG._heartBeatErrNum=0;clearTimeout(obj);YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,"heartBeat succ")},_heartBeatCallBackErr:function(times){YTX_CONFIG._log(YTX_CONFIG._logLevStat._INFO,"heart beak err");if((!YTX_CONFIG._isConnect)||(YTX_CONFIG._loginStatus==1)||times>3){if(YTX_CONFIG._loginStatus==3){YTX_CONFIG._connectStateChange(1,"connect closeed")}YTX_CONFIG._loginStatus=1;YTX_CONFIG._socket.close();YTX_CONFIG._socket=null;YTX_CONFIG._isConnect=false;YTX_CONFIG._isReconnect=true;YTX_CONFIG._reconnect(function(){});if(!YTX_CONFIG._failIntervalId){YTX_CONFIG._failIntervalId=window.setInterval(YTX_CONFIG._heartBeat,YTX_CONFIG._failHeartBeatInterval*1000)}if(!!YTX_CONFIG._intervalId){clearInterval(YTX_CONFIG._intervalId);YTX_CONFIG._intervalId=null}}},_confirmMsg:function(){var confirmStr=YTX_CONFIG._protobuf._buildConfirmMsg();if(!!confirmStr){YTX_CONFIG._sendMsg(confirmStr)}},_getTimeStamp:function(){var now=new Date();var timestamp=now.getFullYear()+""+((now.getMonth()+1)>=10?(now.getMonth()+1):"0"+(now.getMonth()+1))+(now.getDate()>=10?now.getDate():"0"+now.getDate())+(now.getHours()>=10?now.getHours():"0"+now.getHours())+(now.getMinutes()>=10?now.getMinutes():"0"+now.getMinutes())+(now.getSeconds()>=10?now.getSeconds():"0"+now.getSeconds());return timestamp},_releaseVoip:function(){if(!!YTX_CONFIG._voipCallData._localMediaStream){YTX_CONFIG._voipCallData._localMediaStream.stop()}if(YTX_CONFIG._voipCallData._peerConnection!=null){if(YTX_CONFIG._voipCallData._peerConnection.signalingState!="closed"){YTX_CONFIG._voipCallData._peerConnection.close();YTX_CONFIG._voipCallData._peerConnection=null}YTX_CONFIG._voipCallData._voipOtherView.src="";if(YTX_CONFIG._voipCallData._voipLocalView){YTX_CONFIG._voipCallData._voipLocalView.src=""}}YTX_CONFIG._voipCallData._connected=false;YTX_CONFIG._voipCallData._callEventCallId=null;YTX_CONFIG._voipCallData._peerConnection=null;YTX_CONFIG._voipCallData._inviteSdp=null;YTX_CONFIG._voipCallData._localMediaStream=null;YTX_CONFIG._voipCallData._isVideo=false},_sendAck:function(callEventData){var receiverSdp=callEventData.getStrSDP();var pc=YTX_CONFIG._voipCallData._peerConnection;if(!pc){return}pc.onaddstream=function(event){window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;YTX_CONFIG._voipCallData._voipOtherView.src=window.URL.createObjectURL(event.stream)};var remoteError=function(err){console.log("RemoteError"+err)};var sessionDescription=window.mozRTCSessionDescription||window.RTCSessionDescription;pc.setRemoteDescription(new sessionDescription({type:"answer",sdp:receiverSdp}),function(){callEventData.setCallEvent(6);callEventData.setStrSDP();var str=YTX_CONFIG._protobuf._buildCallEvent(callEventData,function(){},function(){console.log("send ack err")});YTX_CONFIG._sendMsg(str);YTX_CONFIG._voipCallData._connected=true},remoteError);var RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate;if(receiverSdp.indexOf("m=video")>-1){var audioReceiverSdp=receiverSdp.substring(0,receiverSdp.indexOf("m=video"));var videoReceiverSdp=receiverSdp.substring(receiverSdp.indexOf("m=video"));var audioReceiverSdpIndex=audioReceiverSdp.indexOf("a=candidate");var videoReceiverSdpIndex=videoReceiverSdp.indexOf("a=candidate");while(audioReceiverSdpIndex>-1){audioReceiverSdp=audioReceiverSdp.substring(audioReceiverSdpIndex+1);audioReceiverSdpIndex=audioReceiverSdp.indexOf("=");var recevierCandidate="";if(audioReceiverSdpIndex>-1){recevierCandidate=audioReceiverSdp.substring(0,audioReceiverSdpIndex-1)}else{recevierCandidate=audioReceiverSdp.substring(0,audioReceiverSdp.length-1)}if(recevierCandidate.indexOf("candidate")>-1){console.log('sdpMLineIndex:0,sdpMid: "audio"recevierCandidate = '+recevierCandidate);pc.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:0,sdpMid:"audio",candidate:recevierCandidate}))}}while(videoReceiverSdpIndex>-1){videoReceiverSdp=videoReceiverSdp.substring(videoReceiverSdpIndex+1);videoReceiverSdpIndex=videoReceiverSdp.indexOf("=");var recevierCandidate="";if(videoReceiverSdpIndex>-1){recevierCandidate=videoReceiverSdp.substring(0,videoReceiverSdpIndex-1)}else{recevierCandidate=videoReceiverSdp.substring(0,videoReceiverSdp.length-1)}if(recevierCandidate.indexOf("candidate")>-1){console.log('sdpMLineIndex:1,sdpMid: "video"recevierCandidate = '+recevierCandidate);pc.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:1,sdpMid:"video",candidate:recevierCandidate}))}}}else{var audioReceiverSdp=receiverSdp;var audioReceiverSdpIndex=audioReceiverSdp.indexOf("a=candidate");while(audioReceiverSdpIndex>-1){audioReceiverSdp=audioReceiverSdp.substring(audioReceiverSdpIndex+1);audioReceiverSdpIndex=audioReceiverSdp.indexOf("=");var recevierCandidate="";if(audioReceiverSdpIndex>-1){recevierCandidate=audioReceiverSdp.substring(0,audioReceiverSdpIndex-1)}else{recevierCandidate=audioReceiverSdp.substring(0,audioReceiverSdp.length-1)}if(recevierCandidate.indexOf("candidate")>-1){console.log('sdpMLineIndex:0,sdpMid: "audio"recevierCandidate = '+recevierCandidate);pc.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:0,sdpMid:"audio",candidate:recevierCandidate}))}}}return},_sendVoip:function(CallEventBuilder,callback,onError){var getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(getUserMedia){var iceServer={iceServers:YTX_CONFIG._voipCallData._iceServers};var isCaller=false;if(YTX_CONFIG._userName==CallEventBuilder.getCaller()){isCaller=true}var peerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection||window.msRTCPeerConnection;var options={optional:[{DtlsSrtpKeyAgreement:true}]};var pc=new peerConnection(iceServer,options);YTX_CONFIG._voipCallData._peerConnection=pc;pc.onicecandidate=function(event){};window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;if(!YTX_CONFIG._voipCallData._voipOtherView){var resp={};resp.code=YTX_CONFIG._errcode._VOIP_NO_VIDEO;onError(resp);return}pc.onaddstream=function(event){YTX_CONFIG._voipCallData._voipOtherView.src=window.URL.createObjectURL(event.stream)};var isVideo=null;if(!CallEventBuilder.getIsVoipCall()){isVideo=YTX_CONFIG._voipCallData._isVideo}else{if(CallEventBuilder.getIsVoipCall()==1){YTX_CONFIG._voipCallData._isVideo=true;isVideo=true}else{isVideo=false}}getUserMedia.call(navigator,{audio:true,video:isVideo},function(stream){var sendOfferFn=function(desc){pc.setLocalDescription(desc);var deleteOpusNum=" ";function sendOffer(){if(pc.iceGatheringState=="complete"){var strSDP=pc.localDescription.sdp;var candidateIndex=strSDP.indexOf("a=candidate");var preSDP=strSDP.substring(0,candidateIndex);var editedSDP=strSDP.substring(candidateIndex+1);var editeSDPIndex=editedSDP.indexOf("a=");while(editeSDPIndex>-1){var sigleCandidate=editedSDP.substring(0,editeSDPIndex);if(sigleCandidate.indexOf("172")==-1&&sigleCandidate.indexOf("candidate")>-1){preSDP+="a"+sigleCandidate}else{if(sigleCandidate.indexOf("candidate")==-1&&sigleCandidate.indexOf("opus")==-1&&sigleCandidate.indexOf("ISAC")==-1&&sigleCandidate.indexOf("PCMA")==-1&&sigleCandidate.indexOf("G722")==-1&&sigleCandidate.indexOf("=fmtp:"+deleteOpusNum)==-1){preSDP+="a"+sigleCandidate}}if(sigleCandidate.indexOf("opus")>-1){deleteOpusNum=sigleCandidate.substring(0,sigleCandidate.indexOf("opus")-1);deleteOpusNum=deleteOpusNum.substring(8)}editedSDP=editedSDP.substring(editeSDPIndex+1);editeSDPIndex=editedSDP.indexOf("a=")}preSDP+="a"+editedSDP;CallEventBuilder.setStrSDP(preSDP);var state=2;if(CallEventBuilder.getCallId()==YTX_CONFIG._voipCallData._callEventCallId){var sendStr=YTX_CONFIG._protobuf._buildCallEvent(CallEventBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}}else{state=4}var resp={};resp.callId=CallEventBuilder.getCallId();resp.caller=CallEventBuilder.getCaller();resp.called=CallEventBuilder.getCalled();resp.userdata=CallEventBuilder.getUserData();resp.state=state;var type=0;if(YTX_CONFIG._voipCallData._isVideo){type=1}resp.callType=type;YTX_CONFIG._voipListener(resp)}else{window.setTimeout(function(){sendOffer()},50)}}window.setTimeout(function(){sendOffer()},50)};var sendAnswerFn=function(desc){pc.setLocalDescription(desc);var deleteOpusNum=" ";function sendAnswer(){if(pc.iceGatheringState=="complete"){var strSDP=pc.localDescription.sdp;var candidateIndex=strSDP.indexOf("a=candidate");var preSDP=strSDP.substring(0,candidateIndex);var editedSDP=strSDP.substring(candidateIndex+1);var editeSDPIndex=editedSDP.indexOf("a=");while(editeSDPIndex>-1){var sigleCandidate=editedSDP.substring(0,editeSDPIndex);if(sigleCandidate.indexOf("172")==-1&&sigleCandidate.indexOf("candidate")>-1){preSDP+="a"+sigleCandidate}else{if(sigleCandidate.indexOf("candidate")==-1&&sigleCandidate.indexOf("opus")==-1&&sigleCandidate.indexOf("ISAC")==-1&&sigleCandidate.indexOf("PCMA")==-1&&sigleCandidate.indexOf("G722")==-1&&sigleCandidate.indexOf("=fmtp:"+deleteOpusNum)==-1){preSDP+="a"+sigleCandidate}}if(sigleCandidate.indexOf("opus")>-1){deleteOpusNum=sigleCandidate.substring(0,sigleCandidate.indexOf("opus")-1);deleteOpusNum=deleteOpusNum.substring(8)}editedSDP=editedSDP.substring(editeSDPIndex+1);editeSDPIndex=editedSDP.indexOf("a=")}preSDP+="a"+editedSDP;CallEventBuilder.setStrSDP(preSDP);if(CallEventBuilder.getCallId()==YTX_CONFIG._voipCallData._callEventCallId){var sendStr=YTX_CONFIG._protobuf._buildCallEvent(CallEventBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}YTX_CONFIG._voipCallData._connected=true}}else{window.setTimeout(function(){sendAnswer()},50)}}window.setTimeout(function(){sendAnswer()},50)},error=function(err){console.log("createOfferORAnswer Failed!")},remoteError=function(err){console.log("RemoteError"+err)};if(!!YTX_CONFIG._voipCallData._voipLocalView){YTX_CONFIG._voipCallData._voipLocalView.src=window.URL.createObjectURL(stream)}YTX_CONFIG._voipCallData._localMediaStream=stream;pc.addStream(stream);if(isCaller){var constraints={mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:isVideo}};pc.createOffer(sendOfferFn,error,constraints)}else{var sessionDescription=window.mozRTCSessionDescription||window.RTCSessionDescription;var inviteSdp=YTX_CONFIG._voipCallData._inviteSdp;pc.setRemoteDescription(new sessionDescription({type:"offer",sdp:inviteSdp}),function(){pc.createAnswer(sendAnswerFn,error)},remoteError);if(!!inviteSdp){var RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate;if(inviteSdp.indexOf("m=video")>-1){var audioInviteSdp=inviteSdp.substring(0,inviteSdp.indexOf("m=video"));var videoInviteSdp=inviteSdp.substring(inviteSdp.indexOf("m=video"));var audioInviteSdpIndex=audioInviteSdp.indexOf("a=candidate");var videoInviteSdpIndex=videoInviteSdp.indexOf("a=candidate");while(audioInviteSdpIndex>-1){audioInviteSdp=audioInviteSdp.substring(audioInviteSdpIndex+1);audioInviteSdpIndex=audioInviteSdp.indexOf("=");var inviteCandidate="";if(audioInviteSdpIndex>-1){inviteCandidate=audioInviteSdp.substring(0,audioInviteSdpIndex-1)}else{inviteCandidate=audioInviteSdp.substring(0,audioInviteSdp.length-1)}if(inviteCandidate.indexOf("candidate")>-1){pc.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:0,sdpMid:"audio",candidate:inviteCandidate}))}}while(videoInviteSdpIndex>-1){videoInviteSdp=videoInviteSdp.substring(videoInviteSdpIndex+1);videoInviteSdpIndex=videoInviteSdp.indexOf("=");var inviteCandidate="";if(videoInviteSdpIndex>-1){inviteCandidate=videoInviteSdp.substring(0,videoInviteSdpIndex-1)}else{inviteCandidate=videoInviteSdp.substring(0,videoInviteSdp.length-1)}if(inviteCandidate.indexOf("candidate")>-1){pc.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:1,sdpMid:"video",candidate:inviteCandidate}))}}}else{var audioInviteSdp=inviteSdp;var audioInviteSdpIndex=audioInviteSdp.indexOf("a=candidate");while(audioInviteSdpIndex>-1){audioInviteSdp=audioInviteSdp.substring(audioInviteSdpIndex+1);audioInviteSdpIndex=audioInviteSdp.indexOf("=");var inviteCandidate="";if(audioInviteSdpIndex>-1){inviteCandidate=audioInviteSdp.substring(0,audioInviteSdpIndex-1)}else{inviteCandidate=audioInviteSdp.substring(0,audioInviteSdp.length-1)}if(inviteCandidate.indexOf("candidate")>-1){pc.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:0,sdpMid:"audio",candidate:inviteCandidate}))}}}}}},function(error){pc.close();var resp={};resp.code=YTX_CONFIG._errcode._VOIP_MEDIA_ERROR;onError(resp)})}else{var resp={};resp.code=YTX_CONFIG._errcode._VOIP_NO_MEDIA;onError(resp)}},_checkASCII:function(content){var regx=/^[\x00-\\x7F\a-zA-Z\u4e00-\u9fa5、]+$/;if(regx.exec(content)==null){return false}return true},_checkCHAR:function(content){var regx=/^[a-zA-Z\u4e00-\u9fa5]+$/;if(regx.exec(content)==null){return false}return true}};window.RL_YTX=window.RL_YTX||{init:function(appid,serverIp,lvsServer){var resp={};if(!RL_YTX.checkH5()){resp.code=YTX_CONFIG._errcode._NOT_SUPPORT_H5;resp.msg="The brower do not support HTML5,please change the brower";return resp}if(!appid){resp.code=YTX_CONFIG._errcode._NO_REQUIRED_PARAM;resp.msg="appid  is null,please check you param";return resp}if(!!serverIp){YTX_CONFIG._server_ip[0]=Base64.encode(serverIp);YTX_CONFIG._file_server_url=Base64.encode("ws://"+serverIp)}if(!!lvsServer){YTX_CONFIG._lvs_servers[0]=Base64.encode(lvsServer)}YTX_CONFIG._appid=appid;resp.code=YTX_CONFIG._errcode._SUCC;resp.msg="init success";return resp},destory:function(){if(!!YTX_CONFIG._socket){YTX_CONFIG._socket.close()}},checkH5:function(){if(!!window.applicationCache&&!!window.WebSocket){YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,"this brower is support H5");return true}else{YTX_CONFIG._log(YTX_CONFIG._logLev._ERROR,"sorry, your brower not support H5, exist!");return false}},login:function(LoginBuilder,callback,onError){if(YTX_CONFIG._loginStatus!=1){if(YTX_CONFIG._loginStatus==3){YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,"user already login.")}else{if(YTX_CONFIG._loginStatus==2){YTX_CONFIG._log(YTX_CONFIG._logLev._INFO,"user logining")}}return}YTX_CONFIG._userName=LoginBuilder.getUserName();YTX_CONFIG._userPwd=LoginBuilder.getPwd();YTX_CONFIG._initScoket(LoginBuilder.getType(),callback,onError,LoginBuilder.getSig(),LoginBuilder.getTimestamp(),true)},logout:function(callback,onError){YTX_CONFIG._confirmMsg();var logoutStr=YTX_CONFIG._protobuf._buildLogout(callback,onError);if(!!logoutStr){YTX_CONFIG._sendMsg(logoutStr)}YTX_CONFIG._logout()},sendMsg:function(MsgBuilder,callback,onError,progress){var msgToken=null;if(MsgBuilder.getType()!=1&&!!MsgBuilder.getFile()){var FileReader=FileReader||window.FileReader;if(!FileReader){var resp={};resp.code=YTX_CONFIG._errcode._NOT_SUPPORT_FILE;resp.msgId=-1;resp.msgClientNo=-1;onError(resp);return -1}msgToken=YTX_CONFIG._generateFullMsgId(YTX_CONFIG._ClientNo+1);YTX_CONFIG._sendFile(MsgBuilder.getFile(),null,MsgBuilder.getReceiver(),MsgBuilder.getType(),msgToken,MsgBuilder.getDomain(),1,callback,onError,progress,MsgBuilder.getFileName())}else{msgToken=YTX_CONFIG._ClientNo+1;var sendStr=YTX_CONFIG._protobuf._buildSendTextMsg(MsgBuilder.getText(),MsgBuilder.getReceiver(),msgToken,MsgBuilder.getDomain(),callback,onError,MsgBuilder.getId());if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}msgToken=YTX_CONFIG._generateFullMsgId(msgToken)}return msgToken},startConsultationWithAgent:function(DeskMessageStartBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildStartMcmMsg(DeskMessageStartBuilder.getOsUnityAccount(),DeskMessageStartBuilder.getUserData(),callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},sendToDeskMessage:function(DeskMessageBuilder,callback,onError,progress){var msgId=null;if(DeskMessageBuilder.getType()!=1&&!!DeskMessageBuilder.getFile()){msgId=YTX_CONFIG._generateFullMsgId(YTX_CONFIG._ClientNo+1);YTX_CONFIG._sendFile(DeskMessageBuilder.getFile(),null,DeskMessageBuilder.getOsUnityAccount(),DeskMessageBuilder.getType(),msgId,DeskMessageBuilder.getUserData(),2,callback,onError,progress,DeskMessageBuilder.getFileName(),DeskMessageBuilder.getMsgId())}else{msgId=YTX_CONFIG._ClientNo+1;var sendStr=YTX_CONFIG._protobuf._buildSendMcmMsg(DeskMessageBuilder.getOsUnityAccount(),DeskMessageBuilder.getContent(),DeskMessageBuilder.getUserData(),DeskMessageBuilder.getMsgType(),msgId,callback,onError,DeskMessageBuilder.getMsgId());if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}msgId=YTX_CONFIG._generateFullMsgId(msgId)}return msgId},finishConsultationWithAgent:function(DeskMessageStopBuilder,callbac,onError){var sendStr=YTX_CONFIG._protobuf._buildStopMcmMsg(DeskMessageStopBuilder.getOsUnityAccount(),DeskMessageStopBuilder.getUserData(),callbac,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},getMyInfo:function(callback,onError){var sendStr=YTX_CONFIG._protobuf._buildGetMyInfo(callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},uploadPerfonInfo:function(uploadPersonInfoBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildSetMyInfo(uploadPersonInfoBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},getHistoryMessage:function(GetHistoryMessageBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildGetHistoryMessage(GetHistoryMessageBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},createGroup:function(CreateGroupBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildCreateGroup(CreateGroupBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},dismissGroup:function(DismissGroupBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildDismissGroup(DismissGroupBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},inviteJoinGroup:function(InviteJoinGroupBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildInviteJoinGroupr(InviteJoinGroupBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},confirmInviteJoinGroup:function(ConfirmInviteJoinGroupBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildConfirmInviteJoinGroupr(ConfirmInviteJoinGroupBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},quitGroup:function(QuitGroupBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildQuitGroup(QuitGroupBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},getGroupList:function(GetGroupListBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildGetGroupList(GetGroupListBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},getGroupMemberList:function(GetGroupMemberListBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildGetGroupMemberList(GetGroupMemberListBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},joinGroup:function(JoinGroupBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildJoinGroup(JoinGroupBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},confirmJoinGroup:function(ConfirmJoinGroupBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildConfirmJoinGroup(ConfirmJoinGroupBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},getGroupDetail:function(GetGroupDetailBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildGetGroupDetail(GetGroupDetailBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},searchGroups:function(SearchGroupsBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildSearchGroups(SearchGroupsBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},deleteGroupMember:function(DeleteGroupMemberBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildDeleteGroupMember(DeleteGroupMemberBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},forbidMemberSpeak:function(ForbidMemberSpeakBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildForbidMemberSpeak(ForbidMemberSpeakBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},setGroupMessageRule:function(SetGroupMessageRuleBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildSetGroupMessageRule(SetGroupMessageRuleBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},queryGroupMemberCard:function(QueryGroupMemberCardBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildQueryGroupMemberCard(QueryGroupMemberCardBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},modifyMemberCard:function(ModifyMemberCardBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildModifyMemberCard(ModifyMemberCardBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},modifyGroup:function(ModifyGroupBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildModifyGroup(ModifyGroupBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},getUserState:function(GetUserStateBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildGetUserState(GetUserStateBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},setCallView:function(view,localView){YTX_CONFIG._voipCallData._voipOtherView=view;YTX_CONFIG._voipCallData._voipLocalView=localView},makeCall:function(MakeCallBuilder,callback,onError){var getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(!getUserMedia){var resp={};resp.code=YTX_CONFIG._errcode._VOIP_NO_MEDIA;onError(resp);return}var timeStamp=new Date().getTime();var randomNum="";for(var i=0;i<6;i++){randomNum+=Math.floor(Math.random()*10)}var callId=timeStamp+randomNum;YTX_CONFIG._voipCallData._callEventCallId=callId;var CallEventBuilder=new YTX_CONFIG._protobuf._CallEventData(1,callId,MakeCallBuilder.getCallType(),MakeCallBuilder.getCalled(),YTX_CONFIG._userName);YTX_CONFIG._sendVoip(CallEventBuilder,callback,onError);return callId},accetpCall:function(AcceptCallBuilder,callback,onError){var CallEventBuilder=new YTX_CONFIG._protobuf._CallEventData(4,AcceptCallBuilder.getCallId(),null,YTX_CONFIG._userName,AcceptCallBuilder.getCaller());YTX_CONFIG._sendVoip(CallEventBuilder,callback,onError)},rejectCall:function(RejectCallBuilder,callback,onError){var CallEventBuilder=new YTX_CONFIG._protobuf._CallEventData(10,RejectCallBuilder.getCallId(),null,YTX_CONFIG._userName,RejectCallBuilder.getCaller(),null,null,603);var sendStr=YTX_CONFIG._protobuf._buildCallEvent(CallEventBuilder,callback,onError);YTX_CONFIG._voipCallData._callEventCallId=null;if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},releaseCall:function(ReleaseCallBuilder,callback,onError){var callEventType=7;if(ReleaseCallBuilder.getCaller()==YTX_CONFIG._userName&&!YTX_CONFIG._voipCallData._connected){callEventType=8}var CallEventBuilder=new YTX_CONFIG._protobuf._CallEventData(callEventType,ReleaseCallBuilder.getCallId(),null,ReleaseCallBuilder.getCalled(),ReleaseCallBuilder.getCaller());var sendStr=YTX_CONFIG._protobuf._buildCallEvent(CallEventBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}YTX_CONFIG._releaseVoip()},deleteReadMsg:function(DeleteReadMsgBuilder,callback,onError){var sendStr=YTX_CONFIG._protobuf._buildDeleteReadMsg(DeleteReadMsgBuilder,callback,onError);if(!!sendStr){YTX_CONFIG._sendMsg(sendStr)}},onMsgReceiveListener:function(callback){YTX_CONFIG._pushListener=callback},onMsgNotifyReceiveListener:function(callback){YTX_CONFIG._msgNotifyListener=callback},onDeskMsgReceiveListener:function(callback){YTX_CONFIG._mcmListener=callback},onNoticeReceiveListener:function(callback){YTX_CONFIG._noticeListener=callback},onConnectStateChangeLisenter:function(callback){YTX_CONFIG._connectStatListener=callback},onCallMsgListener:function(callback){YTX_CONFIG._voipListener=callback},LoginBuilder:function(type,userName,pwd,sig,timestamp){this._type=type;this._userName=userName;this._pwd=pwd;this._sig=sig;this._timestamp=timestamp;this.setType=function(type){this._type=type};this.setUserName=function(userName){this._userName=userName};this.setPwd=function(pwd){this._pwd=pwd};this.setSig=function(sig){this._sig=sig};this.setTimestamp=function(timestamp){this._timestamp=timestamp};this.getType=function(){return this._type};this.getUserName=function(){return this._userName};this.getPwd=function(){return this._pwd};this.getSig=function(){return this._sig};this.getTimestamp=function(){return this._timestamp}},MsgBuilder:function(id,content,file,type,receiver,domain,fileName){this._id=id;this._text=content;this._file=file;this._type=(!!type)?type:1;this._receiver=receiver;this._domain=domain;this._fileName=fileName;this.setId=function(id){this._id=id};this.setText=function(text){this._text=text};this.setFile=function(file){this._file=file};this.setType=function(type){this._type=type};this.setReceiver=function(receiver){this._receiver=receiver};this.setDomain=function(domain){this._domain=domain};this.setFileName=function(fileName){this._fileName=fileName};this.getId=function(){return this._id};this.getText=function(){return this._text};this.getFile=function(){return this._file};this.getType=function(){return this._type};this.getReceiver=function(){return this._receiver};this.getDomain=function(){return this._domain};this.getFileName=function(){return this._fileName}},_mcmType:{_mcmType_text:1,_mcmType_audio:2,_mcmType_video:3,_mcmType_pic:4,_mcmType_pos:5,_mcmType_file:6},DeskMessageStartBuilder:function(osUnityAccount,userData){this._osUnityAccount=osUnityAccount;this._userData=userData;this.setOsUnityAccount=function(osUnityAccount){this._osUnityAccount=osUnityAccount};this.setUserData=function(userData){this._userData=userData};this.getOsUnityAccount=function(){return this._osUnityAccount};this.getUserData=function(){return this._userData}},DeskMessageBuilder:function(content,file,type,userData,osUnityAccount,msgId,fileName){this._content=content;this._userData=userData;this._osUnityAccount=osUnityAccount;this._msgId=msgId;this._file=file;this._type=type;this._msgType=RL_YTX._mcmType._mcmType_text;this._fileName=fileName;this.setContent=function(content){this._content=content};this.setFile=function(file){this._file=file};this.setType=function(type){this._type=type};this.setOsUnityAccount=function(osUnityAccount){this._osUnityAccount=osUnityAccount};this.setMsgId=function(msgId){this._msgId=msgId};this.setUserData=function(userData){this._userData=userData};this.setFileName=function(fileName){this._fileName=fileName};this.getMsgId=function(){return this._msgId};this.getContent=function(){return this._content};this.getFile=function(){return this._file};this.getType=function(){return this._type};this.getUserData=function(){return this._userData};this.getOsUnityAccount=function(){return this._osUnityAccount};this.getMsgType=function(){return this._msgType};this.getFileName=function(){return this._fileName}},DeskMessageStopBuilder:function(osUnityAccount,userData){this._osUnityAccount=osUnityAccount;this._userData=userData;this.setOsUnityAccount=function(osUnityAccount){this._osUnityAccount=osUnityAccount};this.setUserData=function(userData){this._userData=userData};this.getOsUnityAccount=function(){return this._osUnityAccount};this.getUserData=function(){return this._userData}},SyncMsgBuilder:function(sVersion,eVersion,type){this._sVersion=sVersion;this._eVersion=eVersion;this._type=type;this.setSVersion=function(sVersion){this._sVersion=sVersion};this.setEVersion=function(eVersion){this._eVersion=eVersion};this.setType=function(type){this._type=type};this.getSVersion=function(){return this._sVersion};this.getEVersion=function(){return this._eVersion};this.getType=function(){return this._type}},UploadPersonInfoBuilder:function(nickName,sex,birth,sign){this._nickName=nickName;this._sex=(!!sex)?sex:1;this._birth=birth;this._sign=sign;this.setNickName=function(nickName){this._nickName=nickName};this.setSex=function(sex){this._sex=sex};this.setBirth=function(birth){this._birth=birth};this.setSign=function(sign){this._sign=sign};this.getNickName=function(){return this._nickName};this.getSex=function(){return this._sex};this.getBirth=function(){return this._birth};this.getSign=function(){return this._sign}},GetHistoryMessageBuilder:function(talker,pageSize,operator,msgId,order){this._talker=talker;this._pageSize=(!!pageSize)?pageSize:10;this._operator=operator;this._msgId=msgId;this._order=order;this.setTalker=function(talker){this._takler=talker};this.setPageSize=function(pageSize){if(!pageSize){pageSize=10}this._pageSize=pageSize};this.setOperator=function(operator){this._operator=operator};this.setMsgId=function(msgId){this._msgId=msgId};this.setOrder=function(order){this._order=order};this.getTalker=function(){return this._talker};this.getPageSize=function(){return this._pageSize};this.getOperator=function(){return this._operator};this.getMsgId=function(){return this._msgId};this.getOrder=function(){return this._order}},CreateGroupBuilder:function(groupName,groupType,province,city,scope,declared,permission,mode,groupDomain,target){this._groupName=groupName;this._groupType=(!!groupType)?groupType:2;this._province=province;this._city=city;this._scope=(!!scope)?scope:1;this._declared=declared;this._permission=(!!permission)?permission:1;this._mode=(!!mode)?mode:1;this._groupDomain=groupDomain;this._target=target;this.setGroupName=function(groupName){this._groupName=groupName};this.setGroupType=function(groupType){this._groupType=groupType};this.setProvince=function(province){this._province=province};this.setCity=function(city){this._city=city};this.setScope=function(scope){this._scope=scope};this.setDeclared=function(declared){this._declared=declared};this.setPermission=function(permission){this._permission=permission};this.setMode=function(mode){this._mode=mode};this.setGroupDomain=function(domain){this._groupDomain=domain};this.setTarget=function(target){this._target=target};this.getGroupName=function(){return this._groupName};this.getGroupType=function(){if(!!this._groupType){return this._groupType}return 1};this.getProvince=function(){return this._province};this.getCity=function(){return this._city};this.getScope=function(){if(!!this._scope){return this._scope}return 1};this.getDeclared=function(){return this._declared};this.getPermission=function(){if(!!this._permission){return this._permission}return 1};this.getMode=function(){if(!!this._mode){return this._mode}return 1};this.getGroupDomain=function(){return this._groupDomain};this.getTarget=function(){return this._target}},DismissGroupBuilder:function(groupId){this._groupId=groupId;this.setGroupId=function(groupId){this._groupId=groupId};this.getGroupId=function(){return this._groupId}},InviteJoinGroupBuilder:function(groupId,declared,members,confirm){this._groupId=groupId;this._declared=declared;this._members=members;this._confirm=(!!confirm)?confirm:2;this.setGroupId=function(groupId){this._groupId=groupId};this.setDeclared=function(declared){this._declared=declared};this.setMembers=function(members){this._members=members};this.setConfirm=function(confirm){this._confirm=confirm};this.getGroupId=function(){return this._groupId};this.getDeclared=function(){return this._declared};this.getMembers=function(){return this._members};this.getConfirm=function(){return this._confirm}},ConfirmInviteJoinGroupBuilder:function(invitor,groupId,confirm){this._invitor=invitor;this._groupId=groupId;this._confirm=(!!confirm)?confirm:1;this.setInvitor=function(invitor){this._invitor=invitor};this.setGroupId=function(groupId){this._groupId=groupId};this.setConfirm=function(confirm){this._confirm=confirm};this.getInvitor=function(){return this._invitor};this.getGroupId=function(){return this._groupId};this.getConfirm=function(){return this._confirm}},QuitGroupBuilder:function(groupId){this._groupid=groupId;this.setGroupId=function(groupId){this._groupid=groupId};this.getGroupId=function(){return this._groupid}},GetGroupListBuilder:function(groupId,pageSize,target){this._groupId=groupId;this._pageSize=(!!pageSize)?pageSize:50;this._target=isNaN(target)?undefined:target;this.setGroupId=function(groupId){this._groupId=groupId};this.setPageSize=function(pageSize){this._pageSize=pageSize};this.setTarget=function(target){if(isNaN(target)){target=undefined}this._target=target};this.getGroupId=function(){return this._groupId};this.getPageSize=function(){return this._pageSize};this.getTarget=function(){return this._target}},GetGroupMemberListBuilder:function(groupId,memberId,pageSize){this._groupId=groupId;this._memberId=memberId;this._pageSize=(!!pageSize)?pageSize:50;this.setGroupId=function(groupId){this._groupId=groupId};this.setPageSize=function(pageSize){this._pageSize=pageSize};this.setMemberId=function(memberId){this._memberId=memberId};this.getGroupId=function(){return this._groupId};this.getPageSize=function(){return this._pageSize};this.getMemberId=function(){return this._memberId}},JoinGroupBuilder:function(groupId,declared){this._groupId=groupId;this._declared=(!!declared)?declared:"";this.setGroupId=function(groupId){this._groupId=groupId};this.setDeclared=function(declared){if(!declared){declared=""}this._declared=declared};this.getGroupId=function(){return this._groupId};this.getDeclared=function(){return this._declared}},ConfirmJoinGroupBuilder:function(groupId,memberId,confirm){this._groupId=groupId;this._memberId=memberId;this._confirm=confirm;this.setGroupId=function(groupId){this._groupId=groupId};this.setMemberId=function(memberId){this._memberId=memberId};this.setConfirm=function(confirm){this._confirm=confirm};this.getGroupId=function(){return this._groupId};this.getMemberId=function(){return this._memberId};this.getConfirm=function(){return this._confirm}},GetGroupDetailBuilder:function(groupId){this._groupId=groupId;this.setGroupId=function(groupId){this._groupId=groupId};this.getGroupId=function(){return this._groupId}},SearchGroupsBuilder:function(searchType,keywords){this._searchType=searchType;this._keywords=keywords;this.setSearchType=function(searchType){this._searchType=searchType};this.setKeywords=function(keywords){this._keywords=keywords};this.getSearchType=function(){return this._searchType};this.getKeywords=function(){return this._keywords}},DeleteGroupMemberBuilder:function(groupId,memberId){this._groupId=groupId;this._memberId=memberId;this.setGroupId=function(groupId){this._groupId=groupId};this.setMemberId=function(memberId){this._memberId=memberId};this.getGroupId=function(){return this._groupId};this.getMemberId=function(){return this._memberId}},ForbidMemberSpeakBuilder:function(groupId,memberId,forbidState){this._groupId=groupId;this._memberId=memberId;this._forbidState=(!!forbidState&&!isNaN(forbidState))?forbidState:2;this.setGroupId=function(groupId){this._groupId=groupId};this.setMemberId=function(memberId){this._memberId=memberId};this.setForbidState=function(forbidState){if(!!forbidState&&!isNaN(forbidState)){this._forbidState=forbidState}else{this._forbidState=2}};this.getGroupId=function(){return this._groupId};this.getMemberId=function(){return this._memberId};this.getForbidState=function(){if(!!this._forbidState){return this._forbidState}else{return 2}}},SetGroupMessageRuleBuilder:function(groupId,isNotice,isApplePush){this._groupId=groupId;this._isNotice=(!!isNotice&&!isNaN(isNotice))?isNotice:null;this._isApplePush=(!!isApplePush&&!isNaN(isApplePush))?isNotice:null;this.setGroupId=function(groupId){this._groupId=groupId};this.setIsNotice=function(isNotice){if(!!isNotice&&!isNaN(isNotice)){this._isNotice=isNotice}else{this._isNotice=null}};this.setIsApplePush=function(isApplePush){if((!!isApplePush&&!isNaN(isApplePush))){this._isApplePush=isApplePush}else{this._isApplePush=null}};this.getGroupId=function(){return this._groupId};this.getIsNotice=function(){return this._isNotice};this.getIsApplePush=function(){return this._isApplePush}},QueryGroupMemberCardBuilder:function(memberId,belong){this._memberId=memberId;this._belong=belong;this.setMemberId=function(memberId){this._memberId=memberId};this.setBelong=function(belong){this._belong=belong};this.getMemberId=function(){return this._memberId};this.getBelong=function(){return this._belong}},ModifyMemberCardBuilder:function(member,belong,display,phone,mail,remark){this._member=member;this._belong=belong;this._display=display;this._phone=phone;this._mail=mail;this._remark=remark;this.setMember=function(member){this._member=member};this.setBelong=function(belong){this._belong=belong};this.setDisplay=function(display){this._display=display};this.setMail=function(mail){this._mail=mail};this.setPhone=function(phone){this._phone=phone};this.setRemark=function(remark){this._remark=remark};this.getMember=function(){return this._member};this.getBelong=function(){return this._belong};this.getDisplay=function(){return this._display};this.getPhone=function(){return this._phone};this.getMail=function(){return this._mail};this.getRemark=function(){return this._remark}},ModifyGroupBuilder:function(groupId,groupName,type,province,city,scope,declared,permission,groupDomain){this._groupId=groupId;this._groupName=groupName;this._type=type;this._province=province;this._city=city;this._scope=scope;this._declared=declared;this._permission=permission;this._groupDomain=groupDomain;this.setGroupId=function(groupId){this._groupId=groupId};this.setGroupName=function(groupName){this._groupName=groupName};this.setType=function(type){if(!!type&&!isNaN(type)){this._type=type}else{this._type=null}};this.setProvince=function(province){this._province=province};this.setCity=function(city){this._city=city};this.setScope=function(scope){if(!!scope&&!isNaN(scope)){this._scope=scope}else{this._scope=null}};this.setDeclared=function(declared){this._declared=declared};this.setPermission=function(permission){if(!!permission&&!isNaN(permission)){this._permission=permission}else{this._permission=null}};this.setGroupDomain=function(groupDomain){this._groupDomain=groupDomain};this.getGroupId=function(){return this._groupId};this.getGroupName=function(){return this._groupName};this.getType=function(){return this._type};this.getProvince=function(){return this._province};this.getCity=function(){return this._city};this.getScope=function(){return this._scope};this.getDeclared=function(){return this._declared};this.getPermission=function(){return this._permission};this.getGroupDomain=function(){return this._groupDomain}},GetUserStateBuilder:function(useracc){this._useracc=useracc;this.setUseracc=function(useracc){this._useracc=useracc};this.getUseracc=function(){return this._useracc}},MakeCallBuilder:function(called,callType){this._called=called;this._callType=(!!callType)?callType:1;this.setCalled=function(called){this._called=called};this.setCallType=function(callType){this._callType=callType};this.getCalled=function(){return this._called};this.getCallType=function(){return this._callType}},AcceptCallBuilder:function(callId,caller){this._callId=callId;this._caller=caller;this.setCallId=function(callId){this._callId=callId};this.setCaller=function(caller){this._caller=caller};this.getCallId=function(){return this._callId};this.getCaller=function(){return this._caller}},RejectCallBuilder:function(callId,caller,reason){this._callId=callId;this._caller=caller;this.setCallId=function(callId){this._callId=callId};this.setCaller=function(caller){this._caller=caller};this.getCallId=function(){return this._callId};this.getCaller=function(){return this._caller}},ReleaseCallBuilder:function(callId,caller,called){this._callId=callId;this._caller=caller;this._called=called;this.setCallId=function(callId){this._callId=callId};this.setCaller=function(caller){this._caller=caller};this.setCalled=function(called){this._called=called};this.getCallId=function(){return this._callId};this.getCaller=function(){return this._caller};this.getCalled=function(){return this._called}},DeleteReadMsgBuilder:function(version,msgid){this._msgid=msgid;this.setMsgid=function(msgid){this._msgid=msgid};this.getMsgid=function(){return this._msgid}}}})();

/*lrz.all.bundle.js*/
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){n(6),n(7),e.exports=n(8)},function(e,t,n){(function(t){!function(n){function r(e,t){return function(){e.apply(t,arguments)}}function i(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],l(e,r(a,this),r(s,this))}function o(e){var t=this;return null===this._state?void this._deferreds.push(e):void f(function(){var n=t._state?e.onFulfilled:e.onRejected;if(null===n)return void(t._state?e.resolve:e.reject)(t._value);var r;try{r=n(t._value)}catch(i){return void e.reject(i)}e.resolve(r)})}function a(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if("function"==typeof t)return void l(r(t,e),r(a,this),r(s,this))}this._state=!0,this._value=e,u.call(this)}catch(n){s.call(this,n)}}function s(e){this._state=!1,this._value=e,u.call(this)}function u(){for(var e=0,t=this._deferreds.length;t>e;e++)o.call(this,this._deferreds[e]);this._deferreds=null}function c(e,t,n,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r}function l(e,t,n){var r=!1;try{e(function(e){r||(r=!0,t(e))},function(e){r||(r=!0,n(e))})}catch(i){if(r)return;r=!0,n(i)}}var f="function"==typeof t&&t||function(e){setTimeout(e,1)},d=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};i.prototype["catch"]=function(e){return this.then(null,e)},i.prototype.then=function(e,t){var n=this;return new i(function(r,i){o.call(n,new c(e,t,r,i))})},i.all=function(){var e=Array.prototype.slice.call(1===arguments.length&&d(arguments[0])?arguments[0]:arguments);return new i(function(t,n){function r(o,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(e){r(o,e)},n)}e[o]=a,0===--i&&t(e)}catch(u){n(u)}}if(0===e.length)return t([]);for(var i=e.length,o=0;o<e.length;o++)r(o,e[o])})},i.resolve=function(e){return e&&"object"==typeof e&&e.constructor===i?e:new i(function(t){t(e)})},i.reject=function(e){return new i(function(t,n){n(e)})},i.race=function(e){return new i(function(t,n){for(var r=0,i=e.length;i>r;r++)e[r].then(t,n)})},i._setImmediateFn=function(e){f=e},i.prototype.always=function(e){var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){throw n})})},"undefined"!=typeof e&&e.exports?e.exports=i:n.Promise||(n.Promise=i)}(this)}).call(t,n(2).setImmediate)},function(e,t,n){(function(e,r){function i(e,t){this._id=e,this._clearFn=t}var o=n(3).nextTick,a=Function.prototype.apply,s=Array.prototype.slice,u={},c=0;t.setTimeout=function(){return new i(a.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(a.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},t.setImmediate="function"==typeof e?e:function(e){var n=c++,r=arguments.length<2?!1:s.call(arguments,1);return u[n]=!0,o(function(){u[n]&&(r?e.apply(null,r):e.call(null),t.clearImmediate(n))}),n},t.clearImmediate="function"==typeof r?r:function(e){delete u[e]}}).call(t,n(2).setImmediate,n(2).clearImmediate)},function(e,t){function n(){c=!1,a.length?u=a.concat(u):l=-1,u.length&&r()}function r(){if(!c){var e=setTimeout(n);c=!0;for(var t=u.length;t;){for(a=u,u=[];++l<t;)a&&a[l].run();l=-1,t=u.length}a=null,c=!1,clearTimeout(e)}}function i(e,t){this.fun=e,this.array=t}function o(){}var a,s=e.exports={},u=[],c=!1,l=-1;s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new i(e,t)),1!==u.length||c||setTimeout(r,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=o,s.addListener=o,s.once=o,s.off=o,s.removeListener=o,s.removeAllListeners=o,s.emit=o,s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(e,t){function n(){var e=~navigator.userAgent.indexOf("Android")&&~navigator.vendor.indexOf("Google")&&!~navigator.userAgent.indexOf("Chrome");return e&&navigator.userAgent.match(/AppleWebKit\/(\d+)/).pop()<=534||/MQQBrowser/g.test(navigator.userAgent)}function r(){var e=this,t=[],n=Array(21).join("-")+(+new Date*(1e16*Math.random())).toString(36),r=XMLHttpRequest.prototype.send;this.getParts=function(){return t.toString()},this.append=function(e,r,i){t.push("--"+n+'\r\nContent-Disposition: form-data; name="'+e+'"'),r instanceof Blob?(t.push('; filename="'+(i||"blob")+'"\r\nContent-Type: '+r.type+"\r\n\r\n"),t.push(r)):t.push("\r\n\r\n"+r),t.push("\r\n")},XMLHttpRequest.prototype.send=function(o){var a,s,u=this;o===e?(t.push("--"+n+"--\r\n"),s=new i(t),a=new FileReader,a.onload=function(){r.call(u,a.result)},a.onerror=function(e){throw e},a.readAsArrayBuffer(s),this.setRequestHeader("Content-Type","multipart/form-data; boundary="+n),XMLHttpRequest.prototype.send=r):r.call(this,o)}}var i=function(){try{return new Blob,!0}catch(e){return!1}}()?window.Blob:function(e,t){var n=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MSBlobBuilder||window.MozBlobBuilder);return e.forEach(function(e){n.append(e)}),n.getBlob(t?t.type:void 0)};e.exports={Blob:i,FormData:n()?r:FormData}},function(e,t,n){var r,i;(function(){function n(e){return!!e.exifdata}function o(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var n=atob(e),r=n.length,i=new ArrayBuffer(r),o=new Uint8Array(i),a=0;r>a;a++)o[a]=n.charCodeAt(a);return i}function a(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(e){(200==this.status||0===this.status)&&t(this.response)},n.send()}function s(e,t){function n(n){var r=u(n),i=c(n);e.exifdata=r||{},e.iptcdata=i||{},t&&t.call(e)}if(e.src)if(/^data\:/i.test(e.src)){var r=o(e.src);n(r)}else if(/^blob\:/i.test(e.src)){var i=new FileReader;i.onload=function(e){n(e.target.result)},a(e.src,function(e){i.readAsArrayBuffer(e)})}else{var s=new XMLHttpRequest;s.onload=function(){200==this.status||0===this.status?n(s.response):t(new Error("Could not load image")),s=null},s.open("GET",e.src,!0),s.responseType="arraybuffer",s.send(null)}else if(window.FileReader&&(e instanceof window.Blob||e instanceof window.File)){var i=new FileReader;i.onload=function(e){p&&console.log("Got file of length "+e.target.result.byteLength),n(e.target.result)},i.readAsArrayBuffer(e)}}function u(e){var t=new DataView(e);if(p&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return p&&console.log("Not a valid JPEG"),!1;for(var n,r=2,i=e.byteLength;i>r;){if(255!=t.getUint8(r))return p&&console.log("Not a valid marker at offset "+r+", found: "+t.getUint8(r)),!1;if(n=t.getUint8(r+1),p&&console.log(n),225==n)return p&&console.log("Found 0xFFE1 marker"),g(t,r+4,t.getUint16(r+2)-2);r+=2+t.getUint16(r+2)}}function c(e){var t=new DataView(e);if(p&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return p&&console.log("Not a valid JPEG"),!1;for(var n=2,r=e.byteLength,i=function(e,t){return 56===e.getUint8(t)&&66===e.getUint8(t+1)&&73===e.getUint8(t+2)&&77===e.getUint8(t+3)&&4===e.getUint8(t+4)&&4===e.getUint8(t+5)};r>n;){if(i(t,n)){var o=t.getUint8(n+7);o%2!==0&&(o+=1),0===o&&(o=4);var a=n+8+o,s=t.getUint16(n+6+o);return l(e,a,s)}n++}}function l(e,t,n){for(var r,i,o,a,s,u=new DataView(e),c={},l=t;t+n>l;)28===u.getUint8(l)&&2===u.getUint8(l+1)&&(a=u.getUint8(l+2),a in S&&(o=u.getInt16(l+3),s=o+5,i=S[a],r=h(u,l+5,o),c.hasOwnProperty(i)?c[i]instanceof Array?c[i].push(r):c[i]=[c[i],r]:c[i]=r)),l++;return c}function f(e,t,n,r,i){var o,a,s,u=e.getUint16(n,!i),c={};for(s=0;u>s;s++)o=n+12*s+2,a=r[e.getUint16(o,!i)],!a&&p&&console.log("Unknown tag: "+e.getUint16(o,!i)),c[a]=d(e,o,t,n,i);return c}function d(e,t,n,r,i){var o,a,s,u,c,l,f=e.getUint16(t+2,!i),d=e.getUint32(t+4,!i),g=e.getUint32(t+8,!i)+n;switch(f){case 1:case 7:if(1==d)return e.getUint8(t+8,!i);for(o=d>4?g:t+8,a=[],u=0;d>u;u++)a[u]=e.getUint8(o+u);return a;case 2:return o=d>4?g:t+8,h(e,o,d-1);case 3:if(1==d)return e.getUint16(t+8,!i);for(o=d>2?g:t+8,a=[],u=0;d>u;u++)a[u]=e.getUint16(o+2*u,!i);return a;case 4:if(1==d)return e.getUint32(t+8,!i);for(a=[],u=0;d>u;u++)a[u]=e.getUint32(g+4*u,!i);return a;case 5:if(1==d)return c=e.getUint32(g,!i),l=e.getUint32(g+4,!i),s=new Number(c/l),s.numerator=c,s.denominator=l,s;for(a=[],u=0;d>u;u++)c=e.getUint32(g+8*u,!i),l=e.getUint32(g+4+8*u,!i),a[u]=new Number(c/l),a[u].numerator=c,a[u].denominator=l;return a;case 9:if(1==d)return e.getInt32(t+8,!i);for(a=[],u=0;d>u;u++)a[u]=e.getInt32(g+4*u,!i);return a;case 10:if(1==d)return e.getInt32(g,!i)/e.getInt32(g+4,!i);for(a=[],u=0;d>u;u++)a[u]=e.getInt32(g+8*u,!i)/e.getInt32(g+4+8*u,!i);return a}}function h(e,t,n){var r,i="";for(r=t;t+n>r;r++)i+=String.fromCharCode(e.getUint8(r));return i}function g(e,t){if("Exif"!=h(e,t,4))return p&&console.log("Not valid EXIF data! "+h(e,t,4)),!1;var n,r,i,o,a,s=t+6;if(18761==e.getUint16(s))n=!1;else{if(19789!=e.getUint16(s))return p&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;n=!0}if(42!=e.getUint16(s+2,!n))return p&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var u=e.getUint32(s+4,!n);if(8>u)return p&&console.log("Not valid TIFF data! (First offset less than 8)",e.getUint32(s+4,!n)),!1;if(r=f(e,s,s+u,v,n),r.ExifIFDPointer){o=f(e,s,s+r.ExifIFDPointer,w,n);for(i in o){switch(i){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":o[i]=b[i][o[i]];break;case"ExifVersion":case"FlashpixVersion":o[i]=String.fromCharCode(o[i][0],o[i][1],o[i][2],o[i][3]);break;case"ComponentsConfiguration":o[i]=b.Components[o[i][0]]+b.Components[o[i][1]]+b.Components[o[i][2]]+b.Components[o[i][3]]}r[i]=o[i]}}if(r.GPSInfoIFDPointer){a=f(e,s,s+r.GPSInfoIFDPointer,y,n);for(i in a){switch(i){case"GPSVersionID":a[i]=a[i][0]+"."+a[i][1]+"."+a[i][2]+"."+a[i][3]}r[i]=a[i]}}return r}var p=!1,m=function(e){return e instanceof m?e:this instanceof m?void(this.EXIFwrapped=e):new m(e)};"undefined"!=typeof e&&e.exports&&(t=e.exports=m),t.EXIF=m;var w=m.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},v=m.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},y=m.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},b=m.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},S={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};m.getData=function(e,t){return(e instanceof Image||e instanceof HTMLImageElement)&&!e.complete?!1:(n(e)?t&&t.call(e):s(e,t),!0)},m.getTag=function(e,t){return n(e)?e.exifdata[t]:void 0},m.getAllTags=function(e){if(!n(e))return{};var t,r=e.exifdata,i={};for(t in r)r.hasOwnProperty(t)&&(i[t]=r[t]);return i},m.pretty=function(e){if(!n(e))return"";var t,r=e.exifdata,i="";for(t in r)r.hasOwnProperty(t)&&(i+="object"==typeof r[t]?r[t]instanceof Number?t+" : "+r[t]+" ["+r[t].numerator+"/"+r[t].denominator+"]\r\n":t+" : ["+r[t].length+" values]\r\n":t+" : "+r[t]+"\r\n");return i},m.readFromBinaryFile=function(e){return u(e)},r=[],i=function(){return m}.apply(t,r),!(void 0!==i&&(e.exports=i))}).call(this)},function(e,t,n){var r,i;!function(){function n(e){var t=e.naturalWidth,n=e.naturalHeight;if(t*n>1048576){var r=document.createElement("canvas");r.width=r.height=1;var i=r.getContext("2d");return i.drawImage(e,-t+1,0),0===i.getImageData(0,0,1,1).data[3]}return!1}function o(e,t,n){var r=document.createElement("canvas");r.width=1,r.height=n;var i=r.getContext("2d");i.drawImage(e,0,0);for(var o=i.getImageData(0,0,1,n).data,a=0,s=n,u=n;u>a;){var c=o[4*(u-1)+3];0===c?s=u:a=u,u=s+a>>1}var l=u/n;return 0===l?1:l}function a(e,t,n){var r=document.createElement("canvas");return s(e,r,t,n),r.toDataURL("image/jpeg",t.quality||.8)}function s(e,t,r,i){var a=e.naturalWidth,s=e.naturalHeight,c=r.width,l=r.height,f=t.getContext("2d");f.save(),u(t,f,c,l,r.orientation);var d=n(e);d&&(a/=2,s/=2);var h=1024,g=document.createElement("canvas");g.width=g.height=h;for(var p=g.getContext("2d"),m=i?o(e,a,s):1,w=Math.ceil(h*c/a),v=Math.ceil(h*l/s/m),y=0,b=0;s>y;){for(var S=0,I=0;a>S;)p.clearRect(0,0,h,h),p.drawImage(e,-S,-y),f.drawImage(g,0,0,h,h,I,b,w,v),S+=h,I+=w;y+=h,b+=v}f.restore(),g=p=null}function u(e,t,n,r,i){switch(i){case 5:case 6:case 7:case 8:e.width=r,e.height=n;break;default:e.width=n,e.height=r}switch(i){case 2:t.translate(n,0),t.scale(-1,1);break;case 3:t.translate(n,r),t.rotate(Math.PI);break;case 4:t.translate(0,r),t.scale(1,-1);break;case 5:t.rotate(.5*Math.PI),t.scale(1,-1);break;case 6:t.rotate(.5*Math.PI),t.translate(0,-r);break;case 7:t.rotate(.5*Math.PI),t.translate(n,-r),t.scale(-1,1);break;case 8:t.rotate(-.5*Math.PI),t.translate(-n,0)}}function c(e){if(window.Blob&&e instanceof Blob){var t=new Image,n=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!n)throw Error("No createObjectURL function found to create blob url");t.src=n.createObjectURL(e),this.blob=e,e=t}if(!e.naturalWidth&&!e.naturalHeight){var r=this;e.onload=function(){var e=r.imageLoadListeners;if(e){r.imageLoadListeners=null;for(var t=0,n=e.length;n>t;t++)e[t]()}},this.imageLoadListeners=[]}this.srcImage=e}c.prototype.render=function(e,t,n){if(this.imageLoadListeners){var r=this;return void this.imageLoadListeners.push(function(){r.render(e,t,n)})}t=t||{};var i=this.srcImage,o=i.src,u=o.length,c=i.naturalWidth,l=i.naturalHeight,f=t.width,d=t.height,h=t.maxWidth,g=t.maxHeight,p=this.blob&&"image/jpeg"===this.blob.type||0===o.indexOf("data:image/jpeg")||o.indexOf(".jpg")===u-4||o.indexOf(".jpeg")===u-5;f&&!d?d=l*f/c<<0:d&&!f?f=c*d/l<<0:(f=c,d=l),h&&f>h&&(f=h,d=l*f/c<<0),g&&d>g&&(d=g,f=c*d/l<<0);var m={width:f,height:d};for(var w in t)m[w]=t[w];var v=e.tagName.toLowerCase();"img"===v?e.src=a(this.srcImage,m,p):"canvas"===v&&s(this.srcImage,e,m,p),"function"==typeof this.onrender&&this.onrender(e),n&&n()},r=[],i=function(){return c}.apply(t,r),!(void 0!==i&&(e.exports=i))}()},function(e,t){function n(e){function t(e){for(var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],n=0;64>n;n++){var r=F((t[n]*e+50)/100);1>r?r=1:r>255&&(r=255),x[N[n]]=r}for(var i=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],o=0;64>o;o++){var a=F((i[o]*e+50)/100);1>a?a=1:a>255&&(a=255),D[N[o]]=a}for(var s=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],u=0,c=0;8>c;c++)for(var l=0;8>l;l++)U[u]=1/(x[N[u]]*s[c]*s[l]*8),C[u]=1/(D[N[u]]*s[c]*s[l]*8),u++}function n(e,t){for(var n=0,r=0,i=new Array,o=1;16>=o;o++){for(var a=1;a<=e[o];a++)i[t[r]]=[],i[t[r]][0]=n,i[t[r]][1]=o,r++,n++;n*=2}return i}function r(){y=n(W,H),b=n(V,X),S=n(z,q),I=n(Q,Y)}function i(){for(var e=1,t=2,n=1;15>=n;n++){for(var r=e;t>r;r++)A[32767+r]=n,T[32767+r]=[],T[32767+r][1]=n,T[32767+r][0]=r;for(var i=-(t-1);-e>=i;i++)A[32767+i]=n,T[32767+i]=[],T[32767+i][1]=n,T[32767+i][0]=t-1+i;e<<=1,t<<=1}}function o(){for(var e=0;256>e;e++)k[e]=19595*e,k[e+256>>0]=38470*e,k[e+512>>0]=7471*e+32768,k[e+768>>0]=-11059*e,k[e+1024>>0]=-21709*e,k[e+1280>>0]=32768*e+8421375,k[e+1536>>0]=-27439*e,k[e+1792>>0]=-5329*e}function a(e){for(var t=e[0],n=e[1]-1;n>=0;)t&1<<n&&(G|=1<<O),n--,O--,0>O&&(255==G?(s(255),s(0)):s(G),O=7,G=0)}function s(e){M.push(j[e])}function u(e){s(e>>8&255),s(255&e)}function c(e,t){var n,r,i,o,a,s,u,c,l,f=0;const d=8,h=64;for(l=0;d>l;++l){n=e[f],r=e[f+1],i=e[f+2],o=e[f+3],a=e[f+4],s=e[f+5],u=e[f+6],c=e[f+7];var g=n+c,p=n-c,m=r+u,w=r-u,v=i+s,y=i-s,b=o+a,S=o-a,I=g+b,P=g-b,F=m+v,x=m-v;e[f]=I+F,e[f+4]=I-F;var D=.707106781*(x+P);e[f+2]=P+D,e[f+6]=P-D,I=S+y,F=y+w,x=w+p;var U=.382683433*(I-x),C=.5411961*I+U,T=1.306562965*x+U,A=.707106781*F,R=p+A,M=p-A;e[f+5]=M+C,e[f+3]=M-C,e[f+1]=R+T,e[f+7]=R-T,f+=8}for(f=0,l=0;d>l;++l){n=e[f],r=e[f+8],i=e[f+16],o=e[f+24],a=e[f+32],s=e[f+40],u=e[f+48],c=e[f+56];var G=n+c,O=n-c,_=r+u,B=r-u,E=i+s,j=i-s,k=o+a,N=o-a,W=G+k,H=G-k,z=_+E,q=_-E;e[f]=W+z,e[f+32]=W-z;var V=.707106781*(q+H);e[f+16]=H+V,e[f+48]=H-V,W=N+j,z=j+B,q=B+O;var X=.382683433*(W-q),Q=.5411961*W+X,Y=1.306562965*q+X,K=.707106781*z,J=O+K,Z=O-K;e[f+40]=Z+Q,e[f+24]=Z-Q,e[f+8]=J+Y,e[f+56]=J-Y,f++}var $;for(l=0;h>l;++l)$=e[l]*t[l],L[l]=$>0?$+.5|0:$-.5|0;return L}function l(){u(65504),u(16),s(74),s(70),s(73),s(70),s(0),s(1),s(1),s(0),u(1),u(1),s(0),s(0)}function f(e,t){u(65472),u(17),s(8),u(t),u(e),s(3),s(1),s(17),s(0),s(2),s(17),s(1),s(3),s(17),s(1)}function d(){u(65499),u(132),s(0);for(var e=0;64>e;e++)s(x[e]);s(1);for(var t=0;64>t;t++)s(D[t])}function h(){u(65476),u(418),s(0);for(var e=0;16>e;e++)s(W[e+1]);for(var t=0;11>=t;t++)s(H[t]);s(16);for(var n=0;16>n;n++)s(z[n+1]);for(var r=0;161>=r;r++)s(q[r]);s(1);for(var i=0;16>i;i++)s(V[i+1]);for(var o=0;11>=o;o++)s(X[o]);s(17);for(var a=0;16>a;a++)s(Q[a+1]);for(var c=0;161>=c;c++)s(Y[c])}function g(){u(65498),u(12),s(3),s(1),s(0),s(2),s(17),s(3),s(17),s(0),s(63),s(0)}function p(e,t,n,r,i){var o,s=i[0],u=i[240];const l=16,f=63,d=64;for(var h=c(e,t),g=0;d>g;++g)R[N[g]]=h[g];var p=R[0]-n;n=R[0],0==p?a(r[0]):(o=32767+p,a(r[A[o]]),a(T[o]));for(var m=63;m>0&&0==R[m];m--);if(0==m)return a(s),n;for(var w,v=1;m>=v;){for(var y=v;0==R[v]&&m>=v;++v);var b=v-y;if(b>=l){w=b>>4;for(var S=1;w>=S;++S)a(u);b=15&b}o=32767+R[v],a(i[(b<<4)+A[o]]),a(T[o]),v++}return m!=f&&a(s),n}function m(){for(var e=String.fromCharCode,t=0;256>t;t++)j[t]=e(t)}function w(e){if(0>=e&&(e=1),e>100&&(e=100),P!=e){var n=0;n=50>e?Math.floor(5e3/e):Math.floor(200-2*e),t(n),P=e}}function v(){var t=(new Date).getTime();e||(e=50),m(),r(),i(),o(),w(e);(new Date).getTime()-t}var y,b,S,I,P,F=(Math.round,Math.floor),x=new Array(64),D=new Array(64),U=new Array(64),C=new Array(64),T=new Array(65535),A=new Array(65535),L=new Array(64),R=new Array(64),M=[],G=0,O=7,_=new Array(64),B=new Array(64),E=new Array(64),j=new Array(256),k=new Array(2048),N=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],W=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],H=[0,1,2,3,4,5,6,7,8,9,10,11],z=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],q=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],V=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],X=[0,1,2,3,4,5,6,7,8,9,10,11],Q=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Y=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(e,t,n){var r=(new Date).getTime();t&&w(t),M=new Array,G=0,O=7,u(65496),l(),d(),f(e.width,e.height),h(),g();var i=0,o=0,s=0;G=0,O=7,this.encode.displayName="_encode_";for(var c,m,v,P,F,x,D,T,A,L=e.data,R=e.width,j=e.height,N=4*R,W=0;j>W;){for(c=0;N>c;){for(F=N*W+c,x=F,D=-1,T=0,A=0;64>A;A++)T=A>>3,D=4*(7&A),x=F+T*N+D,W+T>=j&&(x-=N*(W+1+T-j)),c+D>=N&&(x-=c+D-N+4),m=L[x++],v=L[x++],P=L[x++],_[A]=(k[m]+k[v+256>>0]+k[P+512>>0]>>16)-128,B[A]=(k[m+768>>0]+k[v+1024>>0]+k[P+1280>>0]>>16)-128,E[A]=(k[m+1280>>0]+k[v+1536>>0]+k[P+1792>>0]>>16)-128;i=p(_,U,i,y,S),o=p(B,C,o,b,I),s=p(E,C,s,b,I),c+=32}W+=8}if(O>=0){var H=[];H[1]=O+1,H[0]=(1<<O+1)-1,a(H)}if(u(65497),n){for(var z=M.length,q=new Uint8Array(z),V=0;z>V;V++)q[V]=M[V].charCodeAt();M=[];(new Date).getTime()-r;return q}var X="data:image/jpeg;base64,"+btoa(M.join(""));M=[];(new Date).getTime()-r;return X},v()}e.exports=n},function(e,t,n){function r(e,t){var n=this;if(!e)throw new Error("没有收到图片，可能的解决方案：https://github.com/think2011/localResizeIMG/issues/7");t=t||{},n.defaults={width:null,height:null,fieldName:"file",quality:.7},n.file=e;for(var r in t)t.hasOwnProperty(r)&&(n.defaults[r]=t[r]);return this.init()}function i(e){var t=null;return t=e?[].filter.call(document.scripts,function(t){return-1!==t.src.indexOf(e)})[0]:document.scripts[document.scripts.length-1],t?t.src.substr(0,t.src.lastIndexOf("/")):null}function o(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var n=e.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(t.length),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return new s.Blob([r.buffer],{type:n})}n.p=i("lrz")+"/",window.URL=window.URL||window.webkitURL;var a=n(1),s=n(4),u=n(5),c=function(e){var t=/OS (\d)_.* like Mac OS X/g.exec(e),n=/Android (\d.*?);/g.exec(e)||/Android\/(\d.*?) /g.exec(e);return{oldIOS:t?+t.pop()<8:!1,oldAndroid:n?+n.pop().substr(0,3)<4.5:!1,iOS:/\(i[^;]+;( U;)? CPU.+Mac OS X/.test(e),android:/Android/g.test(e),mQQBrowser:/MQQBrowser/g.test(e)}}(navigator.userAgent);r.prototype.init=function(){var e=this,t=e.file,n="string"==typeof t,r=/^data:/.test(t),i=new Image,u=document.createElement("canvas"),c=n?t:URL.createObjectURL(t);if(e.img=i,e.blob=c,e.canvas=u,n?e.fileName=r?"base64.jpg":t.split("/").pop():e.fileName=t.name,!document.createElement("canvas").getContext)throw new Error("浏览器不支持canvas");return new a(function(n,a){i.onerror=function(){throw new Error("加载图片文件失败")},i.onload=function(){e._getBase64().then(function(e){return e.length<10&&a("生成base64失败"),e}).then(function(r){var i=null;"object"==typeof e.file&&r.length>e.file.size?(i=new FormData,t=e.file):(i=new s.FormData,t=o(r)),i.append(e.defaults.fieldName,t,e.fileName.replace(/\..+/g,".jpg")),n({formData:i,fileLen:+t.size,base64:r,base64Len:r.length,origin:e.file});for(var a in e)e.hasOwnProperty(a)&&(e[a]=null);URL.revokeObjectURL(e.blob)})},!r&&(i.crossOrigin="*"),i.src=c})},r.prototype._getBase64=function(){var e=this,t=e.img,n=e.file,r=e.canvas;return new a(function(i){try{u.getData("object"==typeof n?n:t,function(){e.orientation=u.getTag(this,"Orientation"),e.resize=e._getResize(),e.ctx=r.getContext("2d"),r.width=e.resize.width,r.height=e.resize.height,e.ctx.fillStyle="#fff",e.ctx.fillRect(0,0,r.width,r.height),c.oldIOS?e._createBase64ForOldIOS().then(i):e._createBase64().then(i)})}catch(o){throw new Error(o)}})},r.prototype._createBase64ForOldIOS=function(){var e=this,t=e.img,r=e.canvas,i=e.defaults,o=e.orientation;return new a(function(e){!function(){var a=[n(6)];(function(n){var a=new n(t);"5678".indexOf(o)>-1?a.render(r,{width:r.height,height:r.width,orientation:o}):a.render(r,{width:r.width,height:r.height,orientation:o}),e(r.toDataURL("image/jpeg",i.quality))}).apply(null,a)}()})},r.prototype._createBase64=function(){var e=this,t=e.resize,r=e.img,i=e.canvas,o=e.ctx,s=e.defaults,u=e.orientation;switch(u){case 3:o.rotate(180*Math.PI/180),o.drawImage(r,-t.width,-t.height,t.width,t.height);break;case 6:o.rotate(90*Math.PI/180),o.drawImage(r,0,-t.width,t.height,t.width);break;case 8:o.rotate(270*Math.PI/180),o.drawImage(r,-t.height,0,t.height,t.width);break;case 2:o.translate(t.width,0),o.scale(-1,1),o.drawImage(r,0,0,t.width,t.height);break;case 4:o.translate(t.width,0),o.scale(-1,1),o.rotate(180*Math.PI/180),o.drawImage(r,-t.width,-t.height,t.width,t.height);break;case 5:o.translate(t.width,0),o.scale(-1,1),o.rotate(90*Math.PI/180),o.drawImage(r,0,-t.width,t.height,t.width);break;case 7:o.translate(t.width,0),o.scale(-1,1),o.rotate(270*Math.PI/180),o.drawImage(r,-t.height,0,t.height,t.width);break;default:o.drawImage(r,0,0,t.width,t.height)}return new a(function(e){c.oldAndroid||c.mQQBrowser||!navigator.userAgent?!function(){var t=[n(7)];(function(t){var n=new t,r=o.getImageData(0,0,i.width,i.height);e(n.encode(r,100*s.quality))}).apply(null,t)}():e(i.toDataURL("image/jpeg",s.quality))})},r.prototype._getResize=function(){var e=this,t=e.img,n=e.defaults,r=n.width,i=n.height,o=e.orientation,a={width:t.width,height:t.height};if("5678".indexOf(o)>-1&&(a.width=t.height,a.height=t.width),a.width<r||a.height<i)return a;var s=a.width/a.height;for(r&&i?s>=r/i?a.width>r&&(a.width=r,a.height=Math.ceil(r/s)):a.height>i&&(a.height=i,a.width=Math.ceil(i*s)):r?r<a.width&&(a.width=r,a.height=Math.ceil(r/s)):i&&i<a.height&&(a.width=Math.ceil(i*s),a.height=i);a.width>=3264||a.height>=2448;)a.width*=.8,a.height*=.8;return a},window.lrz=function(e,t){return new r(e,t)},window.lrz.version="4.8.35",e.exports=window.lrz}])});

/* hammer 2016-05-11 */
!function(a,b,c,d){"use strict";function e(a,b,c){return setTimeout(k(a,c),b)}function f(a,b,c){return Array.isArray(a)?(g(a,c[b],c),!0):!1}function g(a,b,c){var e;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0;e<a.length;)b.call(c,a[e],e,a),e++;else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(a,b,c){for(var e=Object.keys(b),f=0;f<e.length;)(!c||c&&a[e[f]]===d)&&(a[e[f]]=b[e[f]]),f++;return a}function i(a,b){return h(a,b,!0)}function j(a,b,c){var d,e=b.prototype;d=a.prototype=Object.create(e),d.constructor=a,d._super=e,c&&h(d,c)}function k(a,b){return function(){return a.apply(b,arguments)}}function l(a,b){return typeof a==ka?a.apply(b?b[0]||d:d,b):a}function m(a,b){return a===d?b:a}function n(a,b,c){g(r(b),function(b){a.addEventListener(b,c,!1)})}function o(a,b,c){g(r(b),function(b){a.removeEventListener(b,c,!1)})}function p(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function q(a,b){return a.indexOf(b)>-1}function r(a){return a.trim().split(/\s+/g)}function s(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==b||!c&&a[d]===b)return d;d++}return-1}function t(a){return Array.prototype.slice.call(a,0)}function u(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];s(e,g)<0&&d.push(a[f]),e[f]=g,f++}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function v(a,b){for(var c,e,f=b[0].toUpperCase()+b.slice(1),g=0;g<ia.length;){if(c=ia[g],e=c?c+f:b,e in a)return e;g++}return d}function w(){return oa++}function x(a){var b=a.ownerDocument;return b.defaultView||b.parentWindow}function y(a,b){var c=this;this.manager=a,this.callback=b,this.element=a.element,this.target=a.options.inputTarget,this.domHandler=function(b){l(a.options.enable,[a])&&c.handler(b)},this.init()}function z(a){var b,c=a.options.inputClass;return new(b=c?c:ra?N:sa?Q:qa?S:M)(a,A)}function A(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&ya&&d-e===0,g=b&(Aa|Ba)&&d-e===0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,B(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function B(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=E(b)),e>1&&!c.firstMultiple?c.firstMultiple=E(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=F(d);b.timeStamp=na(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=J(h,i),b.distance=I(h,i),C(c,b),b.offsetDirection=H(b.deltaX,b.deltaY),b.scale=g?L(g.pointers,d):1,b.rotation=g?K(g.pointers,d):0,D(c,b);var j=a.element;p(b.srcEvent.target,j)&&(j=b.srcEvent.target),b.target=j}function C(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};b.eventType!==ya&&f.eventType!==Aa||(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function D(a,b){var c,e,f,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=Ba&&(i>xa||h.velocity===d)){var j=h.deltaX-b.deltaX,k=h.deltaY-b.deltaY,l=G(i,j,k);e=l.x,f=l.y,c=ma(l.x)>ma(l.y)?l.x:l.y,g=H(j,k),a.lastInterval=b}else c=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=e,b.velocityY=f,b.direction=g}function E(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:la(a.pointers[c].clientX),clientY:la(a.pointers[c].clientY)},c++;return{timeStamp:na(),pointers:b,center:F(b),deltaX:a.deltaX,deltaY:a.deltaY}}function F(a){var b=a.length;if(1===b)return{x:la(a[0].clientX),y:la(a[0].clientY)};for(var c=0,d=0,e=0;b>e;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:la(c/b),y:la(d/b)}}function G(a,b,c){return{x:b/a||0,y:c/a||0}}function H(a,b){return a===b?Ca:ma(a)>=ma(b)?a>0?Da:Ea:b>0?Fa:Ga}function I(a,b,c){c||(c=Ka);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function J(a,b,c){c||(c=Ka);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function K(a,b){return J(b[1],b[0],La)-J(a[1],a[0],La)}function L(a,b){return I(b[0],b[1],La)/I(a[0],a[1],La)}function M(){this.evEl=Na,this.evWin=Oa,this.allow=!0,this.pressed=!1,y.apply(this,arguments)}function N(){this.evEl=Ra,this.evWin=Sa,y.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function O(){this.evTarget=Ua,this.evWin=Va,this.started=!1,y.apply(this,arguments)}function P(a,b){var c=t(a.touches),d=t(a.changedTouches);return b&(Aa|Ba)&&(c=u(c.concat(d),"identifier",!0)),[c,d]}function Q(){this.evTarget=Xa,this.targetIds={},y.apply(this,arguments)}function R(a,b){var c=t(a.touches),d=this.targetIds;if(b&(ya|za)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=t(a.changedTouches),h=[],i=this.target;if(f=c.filter(function(a){return p(a.target,i)}),b===ya)for(e=0;e<f.length;)d[f[e].identifier]=!0,e++;for(e=0;e<g.length;)d[g[e].identifier]&&h.push(g[e]),b&(Aa|Ba)&&delete d[g[e].identifier],e++;return h.length?[u(f.concat(h),"identifier",!0),h]:void 0}function S(){y.apply(this,arguments);var a=k(this.handler,this);this.touch=new Q(this.manager,a),this.mouse=new M(this.manager,a)}function T(a,b){this.manager=a,this.set(b)}function U(a){if(q(a,bb))return bb;var b=q(a,cb),c=q(a,db);return b&&c?cb+" "+db:b||c?b?cb:db:q(a,ab)?ab:_a}function V(a){this.id=w(),this.manager=null,this.options=i(a||{},this.defaults),this.options.enable=m(this.options.enable,!0),this.state=eb,this.simultaneous={},this.requireFail=[]}function W(a){return a&jb?"cancel":a&hb?"end":a&gb?"move":a&fb?"start":""}function X(a){return a==Ga?"down":a==Fa?"up":a==Da?"left":a==Ea?"right":""}function Y(a,b){var c=b.manager;return c?c.get(a):a}function Z(){V.apply(this,arguments)}function $(){Z.apply(this,arguments),this.pX=null,this.pY=null}function _(){Z.apply(this,arguments)}function aa(){V.apply(this,arguments),this._timer=null,this._input=null}function ba(){Z.apply(this,arguments)}function ca(){Z.apply(this,arguments)}function da(){V.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ea(a,b){return b=b||{},b.recognizers=m(b.recognizers,ea.defaults.preset),new fa(a,b)}function fa(a,b){b=b||{},this.options=i(b,ea.defaults),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.element=a,this.input=z(this),this.touchAction=new T(this,this.options.touchAction),ga(this,!0),g(b.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[3])},this)}function ga(a,b){var c=a.element;g(a.options.cssProps,function(a,d){c.style[v(c.style,d)]=b?a:""})}function ha(a,c){var d=b.createEvent("Event");d.initEvent(a,!0,!0),d.gesture=c,c.target.dispatchEvent(d)}var ia=["","webkit","moz","MS","ms","o"],ja=b.createElement("div"),ka="function",la=Math.round,ma=Math.abs,na=Date.now,oa=1,pa=/mobile|tablet|ip(ad|hone|od)|android/i,qa="ontouchstart"in a,ra=v(a,"PointerEvent")!==d,sa=qa&&pa.test(navigator.userAgent),ta="touch",ua="pen",va="mouse",wa="kinect",xa=25,ya=1,za=2,Aa=4,Ba=8,Ca=1,Da=2,Ea=4,Fa=8,Ga=16,Ha=Da|Ea,Ia=Fa|Ga,Ja=Ha|Ia,Ka=["x","y"],La=["clientX","clientY"];y.prototype={handler:function(){},init:function(){this.evEl&&n(this.element,this.evEl,this.domHandler),this.evTarget&&n(this.target,this.evTarget,this.domHandler),this.evWin&&n(x(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&o(this.element,this.evEl,this.domHandler),this.evTarget&&o(this.target,this.evTarget,this.domHandler),this.evWin&&o(x(this.element),this.evWin,this.domHandler)}};var Ma={mousedown:ya,mousemove:za,mouseup:Aa},Na="mousedown",Oa="mousemove mouseup";j(M,y,{handler:function(a){var b=Ma[a.type];b&ya&&0===a.button&&(this.pressed=!0),b&za&&1!==a.which&&(b=Aa),this.pressed&&this.allow&&(b&Aa&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:va,srcEvent:a}))}});var Pa={pointerdown:ya,pointermove:za,pointerup:Aa,pointercancel:Ba,pointerout:Ba},Qa={2:ta,3:ua,4:va,5:wa},Ra="pointerdown",Sa="pointermove pointerup pointercancel";a.MSPointerEvent&&(Ra="MSPointerDown",Sa="MSPointerMove MSPointerUp MSPointerCancel"),j(N,y,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Pa[d],f=Qa[a.pointerType]||a.pointerType,g=f==ta,h=s(b,a.pointerId,"pointerId");e&ya&&(0===a.button||g)?0>h&&(b.push(a),h=b.length-1):e&(Aa|Ba)&&(c=!0),0>h||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Ta={touchstart:ya,touchmove:za,touchend:Aa,touchcancel:Ba},Ua="touchstart",Va="touchstart touchmove touchend touchcancel";j(O,y,{handler:function(a){var b=Ta[a.type];if(b===ya&&(this.started=!0),this.started){var c=P.call(this,a,b);b&(Aa|Ba)&&c[0].length-c[1].length===0&&(this.started=!1),this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:ta,srcEvent:a})}}});var Wa={touchstart:ya,touchmove:za,touchend:Aa,touchcancel:Ba},Xa="touchstart touchmove touchend touchcancel";j(Q,y,{handler:function(a){var b=Wa[a.type],c=R.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:ta,srcEvent:a})}}),j(S,y,{handler:function(a,b,c){var d=c.pointerType==ta,e=c.pointerType==va;if(d)this.mouse.allow=!1;else if(e&&!this.mouse.allow)return;b&(Aa|Ba)&&(this.mouse.allow=!0),this.callback(a,b,c)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Ya=v(ja.style,"touchAction"),Za=Ya!==d,$a="compute",_a="auto",ab="manipulation",bb="none",cb="pan-x",db="pan-y";T.prototype={set:function(a){a==$a&&(a=this.compute()),Za&&(this.manager.element.style[Ya]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return g(this.manager.recognizers,function(b){l(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),U(a.join(" "))},preventDefaults:function(a){if(!Za){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,e=q(d,bb),f=q(d,db),g=q(d,cb);return e||f&&c&Ha||g&&c&Ia?this.preventSrc(b):void 0}},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var eb=1,fb=2,gb=4,hb=8,ib=hb,jb=16,kb=32;V.prototype={defaults:{},set:function(a){return h(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(f(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=Y(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return f(a,"dropRecognizeWith",this)?this:(a=Y(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(f(a,"requireFailure",this))return this;var b=this.requireFail;return a=Y(a,this),-1===s(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(f(a,"dropRequireFailure",this))return this;a=Y(a,this);var b=s(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(c.options.event+(b?W(d):""),a)}var c=this,d=this.state;hb>d&&b(!0),b(),d>=hb&&b(!0)},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=kb)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(kb|eb)))return!1;a++}return!0},recognize:function(a){var b=h({},a);return l(this.options.enable,[this,b])?(this.state&(ib|jb|kb)&&(this.state=eb),this.state=this.process(b),void(this.state&(fb|gb|hb|jb)&&this.tryEmit(b))):(this.reset(),void(this.state=kb))},process:function(a){},getTouchAction:function(){},reset:function(){}},j(Z,V,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(fb|gb),e=this.attrTest(a);return d&&(c&Ba||!e)?b|jb:d||e?c&Aa?b|hb:b&fb?b|gb:fb:kb}}),j($,Z,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ja},getTouchAction:function(){var a=this.options.direction,b=[];return a&Ha&&b.push(db),a&Ia&&b.push(cb),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Ha?(e=0===f?Ca:0>f?Da:Ea,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?Ca:0>g?Fa:Ga,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return Z.prototype.attrTest.call(this,a)&&(this.state&fb||!(this.state&fb)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=X(a.direction);b&&this.manager.emit(this.options.event+b,a),this._super.emit.call(this,a)}}),j(_,Z,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[bb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&fb)},emit:function(a){if(this._super.emit.call(this,a),1!==a.scale){var b=a.scale<1?"in":"out";this.manager.emit(this.options.event+b,a)}}}),j(aa,V,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[_a]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(Aa|Ba)&&!f)this.reset();else if(a.eventType&ya)this.reset(),this._timer=e(function(){this.state=ib,this.tryEmit()},b.time,this);else if(a.eventType&Aa)return ib;return kb},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===ib&&(a&&a.eventType&Aa?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=na(),this.manager.emit(this.options.event,this._input)))}}),j(ba,Z,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[bb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&fb)}}),j(ca,Z,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Ha|Ia,pointers:1},getTouchAction:function(){return $.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Ha|Ia)?b=a.velocity:c&Ha?b=a.velocityX:c&Ia&&(b=a.velocityY),this._super.attrTest.call(this,a)&&c&a.direction&&a.distance>this.options.threshold&&ma(b)>this.options.velocity&&a.eventType&Aa},emit:function(a){var b=X(a.direction);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),j(da,V,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[ab]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime<b.time;if(this.reset(),a.eventType&ya&&0===this.count)return this.failTimeout();if(d&&f&&c){if(a.eventType!=Aa)return this.failTimeout();var g=this.pTime?a.timeStamp-this.pTime<b.interval:!0,h=!this.pCenter||I(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,h&&g?this.count+=1:this.count=1,this._input=a;var i=this.count%b.taps;if(0===i)return this.hasRequireFailures()?(this._timer=e(function(){this.state=ib,this.tryEmit()},b.interval,this),fb):ib}return kb},failTimeout:function(){return this._timer=e(function(){this.state=kb},this.options.interval,this),kb},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ib&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ea.VERSION="2.0.4",ea.defaults={domEvents:!1,touchAction:$a,enable:!0,inputTarget:null,inputClass:null,preset:[[ba,{enable:!1}],[_,{enable:!1},["rotate"]],[ca,{direction:Ha}],[$,{direction:Ha},["swipe"]],[da],[da,{event:"doubletap",taps:2},["tap"]],[aa]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var lb=1,mb=2;fa.prototype={set:function(a){return h(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?mb:lb},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&ib)&&(e=b.curRecognizer=null);for(var f=0;f<d.length;)c=d[f],b.stopped===mb||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(fb|gb|hb)&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof V)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(f(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(f(a,"remove",this))return this;var b=this.recognizers;return a=this.get(a),b.splice(s(b,a),1),this.touchAction.update(),this},on:function(a,b){var c=this.handlers;return g(r(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this},off:function(a,b){var c=this.handlers;return g(r(a),function(a){b?c[a].splice(s(c[a],b),1):delete c[a]}),this},emit:function(a,b){this.options.domEvents&&ha(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&ga(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},h(ea,{INPUT_START:ya,INPUT_MOVE:za,INPUT_END:Aa,INPUT_CANCEL:Ba,STATE_POSSIBLE:eb,STATE_BEGAN:fb,STATE_CHANGED:gb,STATE_ENDED:hb,STATE_RECOGNIZED:ib,STATE_CANCELLED:jb,STATE_FAILED:kb,DIRECTION_NONE:Ca,DIRECTION_LEFT:Da,DIRECTION_RIGHT:Ea,DIRECTION_UP:Fa,DIRECTION_DOWN:Ga,DIRECTION_HORIZONTAL:Ha,DIRECTION_VERTICAL:Ia,DIRECTION_ALL:Ja,Manager:fa,Input:y,TouchAction:T,TouchInput:Q,MouseInput:M,PointerEventInput:N,TouchMouseInput:S,SingleTouchInput:O,Recognizer:V,AttrRecognizer:Z,Tap:da,Pan:$,Swipe:ca,Pinch:_,Rotate:ba,Press:aa,on:n,off:o,each:g,merge:i,extend:h,inherit:j,bindFn:k,prefixed:v}),typeof define==ka&&define.amd?define(function(){return ea}):"undefined"!=typeof module&&module.exports?module.exports=ea:a[c]=ea}(window,document,"Hammer");

/* iscroll-zoom.js 2016-05-11 */
!function(a,b,c){function d(a,d){this.wrapper="string"==typeof a?b.querySelector(a):a,this.scroller=this.wrapper.children[0],this.scrollerStyle=this.scroller.style,this.options={zoomMin:1,zoomMax:4,zoomStart:1,resizeScrollbars:!0,mouseWheelSpeed:20,snapThreshold:.334,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:"",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0};for(var e in d)this.options[e]=d[e];this.translateZ=this.options.HWCompositing&&h.hasPerspective?" translateZ(0)":"",this.options.useTransition=h.hasTransition&&this.options.useTransition,this.options.useTransform=h.hasTransform&&this.options.useTransform,this.options.eventPassthrough=this.options.eventPassthrough===!0?"vertical":this.options.eventPassthrough,this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,this.options.scrollY="vertical"==this.options.eventPassthrough?!1:this.options.scrollY,this.options.scrollX="horizontal"==this.options.eventPassthrough?!1:this.options.scrollX,this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough,this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold,this.options.bounceEasing="string"==typeof this.options.bounceEasing?h.ease[this.options.bounceEasing]||h.ease.circular:this.options.bounceEasing,this.options.resizePolling=void 0===this.options.resizePolling?60:this.options.resizePolling,this.options.tap===!0&&(this.options.tap="tap"),"scale"==this.options.shrinkScrollbars&&(this.options.useTransition=!1),this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1,this.x=0,this.y=0,this.directionX=0,this.directionY=0,this._events={},this.scale=c.min(c.max(this.options.zoomStart,this.options.zoomMin),this.options.zoomMax),this._init(),this.refresh(),this.scrollTo(this.options.startX,this.options.startY),this.enable()}function e(a,c,d){var e=b.createElement("div"),f=b.createElement("div");return d===!0&&(e.style.cssText="position:absolute;z-index:9999",f.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px"),f.className="iScrollIndicator","h"==a?(d===!0&&(e.style.cssText+=";height:7px;left:2px;right:2px;bottom:0",f.style.height="100%"),e.className="iScrollHorizontalScrollbar"):(d===!0&&(e.style.cssText+=";width:7px;bottom:2px;top:2px;right:1px",f.style.width="100%"),e.className="iScrollVerticalScrollbar"),e.style.cssText+=";overflow:hidden",c||(e.style.pointerEvents="none"),e.appendChild(f),e}function f(c,d){this.wrapper="string"==typeof d.el?b.querySelector(d.el):d.el,this.wrapperStyle=this.wrapper.style,this.indicator=this.wrapper.children[0],this.indicatorStyle=this.indicator.style,this.scroller=c,this.options={listenX:!0,listenY:!0,interactive:!1,resize:!0,defaultScrollbars:!1,shrink:!1,fade:!1,speedRatioX:0,speedRatioY:0};for(var e in d)this.options[e]=d[e];this.sizeRatioX=1,this.sizeRatioY=1,this.maxPosX=0,this.maxPosY=0,this.options.interactive&&(this.options.disableTouch||(h.addEvent(this.indicator,"touchstart",this),h.addEvent(a,"touchend",this)),this.options.disablePointer||(h.addEvent(this.indicator,h.prefixPointerEvent("pointerdown"),this),h.addEvent(a,h.prefixPointerEvent("pointerup"),this)),this.options.disableMouse||(h.addEvent(this.indicator,"mousedown",this),h.addEvent(a,"mouseup",this))),this.options.fade&&(this.wrapperStyle[h.style.transform]=this.scroller.translateZ,this.wrapperStyle[h.style.transitionDuration]=h.isBadAndroid?"0.001s":"0ms",this.wrapperStyle.opacity="0")}var g=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)},h=function(){function d(a){return g===!1?!1:""===g?a:g+a.charAt(0).toUpperCase()+a.substr(1)}var e={},f=b.createElement("div").style,g=function(){for(var a,b=["t","webkitT","MozT","msT","OT"],c=0,d=b.length;d>c;c++)if(a=b[c]+"ransform",a in f)return b[c].substr(0,b[c].length-1);return!1}();e.getTime=Date.now||function(){return(new Date).getTime()},e.extend=function(a,b){for(var c in b)a[c]=b[c]},e.addEvent=function(a,b,c,d){a.addEventListener(b,c,!!d)},e.removeEvent=function(a,b,c,d){a.removeEventListener(b,c,!!d)},e.prefixPointerEvent=function(b){return a.MSPointerEvent?"MSPointer"+b.charAt(9).toUpperCase()+b.substr(10):b},e.momentum=function(a,b,d,e,f,g){var h,i,j=a-b,k=c.abs(j)/d;return g=void 0===g?6e-4:g,h=a+k*k/(2*g)*(0>j?-1:1),i=k/g,e>h?(h=f?e-f/2.5*(k/8):e,j=c.abs(h-a),i=j/k):h>0&&(h=f?f/2.5*(k/8):0,j=c.abs(a)+h,i=j/k),{destination:c.round(h),duration:i}};var h=d("transform");return e.extend(e,{hasTransform:h!==!1,hasPerspective:d("perspective")in f,hasTouch:"ontouchstart"in a,hasPointer:a.PointerEvent||a.MSPointerEvent,hasTransition:d("transition")in f}),e.isBadAndroid=/Android /.test(a.navigator.appVersion)&&!/Chrome\/\d/.test(a.navigator.appVersion),e.extend(e.style={},{transform:h,transitionTimingFunction:d("transitionTimingFunction"),transitionDuration:d("transitionDuration"),transitionDelay:d("transitionDelay"),transformOrigin:d("transformOrigin")}),e.hasClass=function(a,b){var c=new RegExp("(^|\\s)"+b+"(\\s|$)");return c.test(a.className)},e.addClass=function(a,b){if(!e.hasClass(a,b)){var c=a.className.split(" ");c.push(b),a.className=c.join(" ")}},e.removeClass=function(a,b){if(e.hasClass(a,b)){var c=new RegExp("(^|\\s)"+b+"(\\s|$)","g");a.className=a.className.replace(c," ")}},e.offset=function(a){for(var b=-a.offsetLeft,c=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;return{left:b,top:c}},e.preventDefaultException=function(a,b){for(var c in b)if(b[c].test(a[c]))return!0;return!1},e.extend(e.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,pointerdown:3,pointermove:3,pointerup:3,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3}),e.extend(e.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(a){return a*(2-a)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(a){return c.sqrt(1- --a*a)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(a){var b=4;return(a-=1)*a*((b+1)*a+b)+1}},bounce:{style:"",fn:function(a){return(a/=1)<1/2.75?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}},elastic:{style:"",fn:function(a){var b=.22,d=.4;return 0===a?0:1==a?1:d*c.pow(2,-10*a)*c.sin((a-b/4)*(2*c.PI)/b)+1}}}),e.tap=function(a,c){var d=b.createEvent("Event");d.initEvent(c,!0,!0),d.pageX=a.pageX,d.pageY=a.pageY,a.target.dispatchEvent(d)},e.click=function(a){var c,d=a.target;/(SELECT|INPUT|TEXTAREA)/i.test(d.tagName)||(c=b.createEvent("MouseEvents"),c.initMouseEvent("click",!0,!0,a.view,1,d.screenX,d.screenY,d.clientX,d.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null),c._constructed=!0,d.dispatchEvent(c))},e}();d.prototype={version:"5.1.3",_init:function(){this._initEvents(),this.options.zoom&&this._initZoom(),(this.options.scrollbars||this.options.indicators)&&this._initIndicators(),this.options.mouseWheel&&this._initWheel(),this.options.snap&&this._initSnap(),this.options.keyBindings&&this._initKeys()},destroy:function(){this._initEvents(!0),this._execEvent("destroy")},_transitionEnd:function(a){a.target==this.scroller&&this.isInTransition&&(this._transitionTime(),this.resetPosition(this.options.bounceTime)||(this.isInTransition=!1,this._execEvent("scrollEnd")))},_start:function(a){if((1==h.eventType[a.type]||0===a.button)&&this.enabled&&(!this.initiated||h.eventType[a.type]===this.initiated)){!this.options.preventDefault||h.isBadAndroid||h.preventDefaultException(a.target,this.options.preventDefaultException)||a.preventDefault();var b,d=a.touches?a.touches[0]:a;this.initiated=h.eventType[a.type],this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this._transitionTime(),this.startTime=h.getTime(),this.options.useTransition&&this.isInTransition?(this.isInTransition=!1,b=this.getComputedPosition(),this._translate(c.round(b.x),c.round(b.y)),this._execEvent("scrollEnd")):!this.options.useTransition&&this.isAnimating&&(this.isAnimating=!1,this._execEvent("scrollEnd")),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=d.pageX,this.pointY=d.pageY,this._execEvent("beforeScrollStart")}},_move:function(a){if(this.enabled&&h.eventType[a.type]===this.initiated){this.options.preventDefault&&a.preventDefault();var b,d,e,f,g=a.touches?a.touches[0]:a,i=g.pageX-this.pointX,j=g.pageY-this.pointY,k=h.getTime();if(this.pointX=g.pageX,this.pointY=g.pageY,this.distX+=i,this.distY+=j,e=c.abs(this.distX),f=c.abs(this.distY),!(k-this.endTime>300&&10>e&&10>f)){if(this.directionLocked||this.options.freeScroll||(e>f+this.options.directionLockThreshold?this.directionLocked="h":f>=e+this.options.directionLockThreshold?this.directionLocked="v":this.directionLocked="n"),"h"==this.directionLocked){if("vertical"==this.options.eventPassthrough)a.preventDefault();else if("horizontal"==this.options.eventPassthrough)return void(this.initiated=!1);j=0}else if("v"==this.directionLocked){if("horizontal"==this.options.eventPassthrough)a.preventDefault();else if("vertical"==this.options.eventPassthrough)return void(this.initiated=!1);i=0}i=this.hasHorizontalScroll?i:0,j=this.hasVerticalScroll?j:0,b=this.x+i,d=this.y+j,(b>0||b<this.maxScrollX)&&(b=this.options.bounce?this.x+i/3:b>0?0:this.maxScrollX),(d>0||d<this.maxScrollY)&&(d=this.options.bounce?this.y+j/3:d>0?0:this.maxScrollY),this.directionX=i>0?-1:0>i?1:0,this.directionY=j>0?-1:0>j?1:0,this.moved||this._execEvent("scrollStart"),this.moved=!0,this._translate(b,d),k-this.startTime>300&&(this.startTime=k,this.startX=this.x,this.startY=this.y)}}},_end:function(a){if(this.enabled&&h.eventType[a.type]===this.initiated){this.options.preventDefault&&!h.preventDefaultException(a.target,this.options.preventDefaultException)&&a.preventDefault();var b,d,e=(a.changedTouches?a.changedTouches[0]:a,h.getTime()-this.startTime),f=c.round(this.x),g=c.round(this.y),i=c.abs(f-this.startX),j=c.abs(g-this.startY),k=0,l="";if(this.isInTransition=0,this.initiated=0,this.endTime=h.getTime(),!this.resetPosition(this.options.bounceTime)){if(this.scrollTo(f,g),!this.moved)return this.options.tap&&h.tap(a,this.options.tap),this.options.click&&h.click(a),void this._execEvent("scrollCancel");if(this._events.flick&&200>e&&100>i&&100>j)return void this._execEvent("flick");if(this.options.momentum&&300>e&&(b=this.hasHorizontalScroll?h.momentum(this.x,this.startX,e,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:f,duration:0},d=this.hasVerticalScroll?h.momentum(this.y,this.startY,e,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:g,duration:0},f=b.destination,g=d.destination,k=c.max(b.duration,d.duration),this.isInTransition=1),this.options.snap){var m=this._nearestSnap(f,g);this.currentPage=m,k=this.options.snapSpeed||c.max(c.max(c.min(c.abs(f-m.x),1e3),c.min(c.abs(g-m.y),1e3)),300),f=m.x,g=m.y,this.directionX=0,this.directionY=0,l=this.options.bounceEasing}return f!=this.x||g!=this.y?((f>0||f<this.maxScrollX||g>0||g<this.maxScrollY)&&(l=h.ease.quadratic),void this.scrollTo(f,g,k,l)):void this._execEvent("scrollEnd")}}},_resize:function(){var a=this;clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){a.refresh()},this.options.resizePolling)},resetPosition:function(a){var b=this.x,c=this.y;return a=a||0,!this.hasHorizontalScroll||this.x>0?b=0:this.x<this.maxScrollX&&(b=this.maxScrollX),!this.hasVerticalScroll||this.y>0?c=0:this.y<this.maxScrollY&&(c=this.maxScrollY),b==this.x&&c==this.y?!1:(this.scrollTo(b,c,a,this.options.bounceEasing),!0)},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){this.wrapper.offsetHeight;this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.scrollerWidth=c.round(this.scroller.offsetWidth*this.scale),this.scrollerHeight=c.round(this.scroller.offsetHeight*this.scale),this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=h.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition(this.options.bounceTime)},on:function(a,b){this._events[a]||(this._events[a]=[]),this._events[a].push(b)},off:function(a,b){if(this._events[a]){var c=this._events[a].indexOf(b);c>-1&&this._events[a].splice(c,1)}},_execEvent:function(a){if(this._events[a]){var b=0,c=this._events[a].length;if(c)for(;c>b;b++)this._events[a][b].apply(this,[].slice.call(arguments,1))}},scrollBy:function(a,b,c,d){a=this.x+a,b=this.y+b,c=c||0,this.scrollTo(a,b,c,d)},scrollTo:function(a,b,c,d){d=d||h.ease.circular,this.isInTransition=this.options.useTransition&&c>0,!c||this.options.useTransition&&d.style?(this._transitionTimingFunction(d.style),this._transitionTime(c),this._translate(a,b)):this._animate(a,b,c,d.fn)},scrollToElement:function(a,b,d,e,f){if(a=a.nodeType?a:this.scroller.querySelector(a)){var g=h.offset(a);g.left-=this.wrapperOffset.left,g.top-=this.wrapperOffset.top,d===!0&&(d=c.round(a.offsetWidth/2-this.wrapper.offsetWidth/2)),e===!0&&(e=c.round(a.offsetHeight/2-this.wrapper.offsetHeight/2)),g.left-=d||0,g.top-=e||0,g.left=g.left>0?0:g.left<this.maxScrollX?this.maxScrollX:g.left,g.top=g.top>0?0:g.top<this.maxScrollY?this.maxScrollY:g.top,b=void 0===b||null===b||"auto"===b?c.max(c.abs(this.x-g.left),c.abs(this.y-g.top)):b,this.scrollTo(g.left,g.top,b,f)}},_transitionTime:function(a){if(a=a||0,this.scrollerStyle[h.style.transitionDuration]=a+"ms",!a&&h.isBadAndroid&&(this.scrollerStyle[h.style.transitionDuration]="0.001s"),this.indicators)for(var b=this.indicators.length;b--;)this.indicators[b].transitionTime(a)},_transitionTimingFunction:function(a){if(this.scrollerStyle[h.style.transitionTimingFunction]=a,this.indicators)for(var b=this.indicators.length;b--;)this.indicators[b].transitionTimingFunction(a)},_translate:function(a,b){if(this.options.useTransform?this.scrollerStyle[h.style.transform]="translate("+a+"px,"+b+"px) scale("+this.scale+") "+this.translateZ:(a=c.round(a),b=c.round(b),this.scrollerStyle.left=a+"px",this.scrollerStyle.top=b+"px"),this.x=a,this.y=b,this.indicators)for(var d=this.indicators.length;d--;)this.indicators[d].updatePosition()},_initEvents:function(b){var c=b?h.removeEvent:h.addEvent,d=this.options.bindToWrapper?this.wrapper:a;c(a,"orientationchange",this),c(a,"resize",this),this.options.click&&c(this.wrapper,"click",this,!0),this.options.disableMouse||(c(this.wrapper,"mousedown",this),c(d,"mousemove",this),c(d,"mousecancel",this),c(d,"mouseup",this)),h.hasPointer&&!this.options.disablePointer&&(c(this.wrapper,h.prefixPointerEvent("pointerdown"),this),c(d,h.prefixPointerEvent("pointermove"),this),c(d,h.prefixPointerEvent("pointercancel"),this),c(d,h.prefixPointerEvent("pointerup"),this)),h.hasTouch&&!this.options.disableTouch&&(c(this.wrapper,"touchstart",this),c(d,"touchmove",this),c(d,"touchcancel",this),c(d,"touchend",this)),c(this.scroller,"transitionend",this),c(this.scroller,"webkitTransitionEnd",this),c(this.scroller,"oTransitionEnd",this),c(this.scroller,"MSTransitionEnd",this)},getComputedPosition:function(){var b,c,d=a.getComputedStyle(this.scroller,null);return this.options.useTransform?(d=d[h.style.transform].split(")")[0].split(", "),b=+(d[12]||d[4]),c=+(d[13]||d[5])):(b=+d.left.replace(/[^-\d.]/g,""),c=+d.top.replace(/[^-\d.]/g,"")),{x:b,y:c}},_initIndicators:function(){function a(a){for(var b=h.indicators.length;b--;)a.call(h.indicators[b])}var b,c=this.options.interactiveScrollbars,d="string"!=typeof this.options.scrollbars,g=[],h=this;this.indicators=[],this.options.scrollbars&&(this.options.scrollY&&(b={el:e("v",c,this.options.scrollbars),interactive:c,defaultScrollbars:!0,customStyle:d,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenX:!1},this.wrapper.appendChild(b.el),g.push(b)),this.options.scrollX&&(b={el:e("h",c,this.options.scrollbars),interactive:c,defaultScrollbars:!0,customStyle:d,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenY:!1},this.wrapper.appendChild(b.el),g.push(b))),this.options.indicators&&(g=g.concat(this.options.indicators));for(var i=g.length;i--;)this.indicators.push(new f(this,g[i]));this.options.fadeScrollbars&&(this.on("scrollEnd",function(){a(function(){this.fade()})}),this.on("scrollCancel",function(){a(function(){this.fade()})}),this.on("scrollStart",function(){a(function(){this.fade(1)})}),this.on("beforeScrollStart",function(){a(function(){this.fade(1,!0)})})),this.on("refresh",function(){a(function(){this.refresh()})}),this.on("destroy",function(){a(function(){this.destroy()}),delete this.indicators})},_initZoom:function(){this.scrollerStyle[h.style.transformOrigin]="0 0"},_zoomStart:function(a){var b=c.abs(a.touches[0].pageX-a.touches[1].pageX),d=c.abs(a.touches[0].pageY-a.touches[1].pageY);this.touchesDistanceStart=c.sqrt(b*b+d*d),this.startScale=this.scale,this.originX=c.abs(a.touches[0].pageX+a.touches[1].pageX)/2+this.wrapperOffset.left-this.x,this.originY=c.abs(a.touches[0].pageY+a.touches[1].pageY)/2+this.wrapperOffset.top-this.y,this._execEvent("zoomStart")},_zoom:function(a){if(this.enabled&&h.eventType[a.type]===this.initiated){this.options.preventDefault&&a.preventDefault();var b,d,e,f=c.abs(a.touches[0].pageX-a.touches[1].pageX),g=c.abs(a.touches[0].pageY-a.touches[1].pageY),i=c.sqrt(f*f+g*g),j=1/this.touchesDistanceStart*i*this.startScale;this.scaled=!0,j<this.options.zoomMin?j=.5*this.options.zoomMin*c.pow(2,j/this.options.zoomMin):j>this.options.zoomMax&&(j=2*this.options.zoomMax*c.pow(.5,this.options.zoomMax/j)),b=j/this.startScale,d=this.originX-this.originX*b+this.startX,e=this.originY-this.originY*b+this.startY,this.scale=j,this.scrollTo(d,e,0)}},_zoomEnd:function(a){if(this.enabled&&h.eventType[a.type]===this.initiated){this.options.preventDefault&&a.preventDefault();var b,c,d;this.isInTransition=0,this.initiated=0,this.scale>this.options.zoomMax?this.scale=this.options.zoomMax:this.scale<this.options.zoomMin&&(this.scale=this.options.zoomMin),this.refresh(),d=this.scale/this.startScale,b=this.originX-this.originX*d+this.startX,c=this.originY-this.originY*d+this.startY,b>0?b=0:b<this.maxScrollX&&(b=this.maxScrollX),c>0?c=0:c<this.maxScrollY&&(c=this.maxScrollY),this.scrollTo(b,c,this.options.bounceTime),this.scaled=!1,this._execEvent("zoomEnd")}},zoom:function(a,b,c,d){if(a<this.options.zoomMin?a=this.options.zoomMin:a>this.options.zoomMax&&(a=this.options.zoomMax),a!=this.scale){var e=a/this.scale;b=void 0===b?this.wrapperWidth/2-this.wrapperOffset.left:b,c=void 0===c?this.wrapperHeight/2-this.wrapperOffset.top:c,d=void 0===d?300:d,b=b+this.wrapperOffset.left-this.x,c=c+this.wrapperOffset.top-this.y,b=b-b*e+this.x,c=c-c*e+this.y,this.scale=a,this.refresh(),b>0?b=0:b<this.maxScrollX&&(b=this.maxScrollX),c>0?c=0:c<this.maxScrollY&&(c=this.maxScrollY),this.scrollTo(b,c,d)}},_wheelZoom:function(a){var b,d,e=this;if(clearTimeout(this.wheelTimeout),this.wheelTimeout=setTimeout(function(){e._execEvent("zoomEnd")},400),"deltaY"in a)b=-a.deltaY/c.abs(a.deltaY);else if("wheelDeltaY"in a)b=a.wheelDeltaY/c.abs(a.wheelDeltaY);else if("wheelDelta"in a)b=a.wheelDelta/c.abs(a.wheelDelta);else{if(!("detail"in a))return;b=-a.detail/c.abs(a.detail)}isNaN(b)&&(b=0),d=this.scale+.01*b,this.zoom(d,a.pageX,a.pageY,0),a.preventDefault(),a.stopPropagation()},_initWheel:function(){h.addEvent(this.wrapper,"wheel",this),h.addEvent(this.wrapper,"mousewheel",this),h.addEvent(this.wrapper,"DOMMouseScroll",this),this.on("destroy",function(){h.removeEvent(this.wrapper,"wheel",this),h.removeEvent(this.wrapper,"mousewheel",this),h.removeEvent(this.wrapper,"DOMMouseScroll",this)})},_wheel:function(a){if(this.enabled){a.preventDefault(),a.stopPropagation();var b,d,e,f,g=this;if(void 0===this.wheelTimeout&&g._execEvent("scrollStart"),clearTimeout(this.wheelTimeout),this.wheelTimeout=setTimeout(function(){g._execEvent("scrollEnd"),g.wheelTimeout=void 0},400),"deltaX"in a)1===a.deltaMode?(b=-a.deltaX*this.options.mouseWheelSpeed,d=-a.deltaY*this.options.mouseWheelSpeed):(b=-a.deltaX,d=-a.deltaY);else if("wheelDeltaX"in a)b=a.wheelDeltaX/120*this.options.mouseWheelSpeed,d=a.wheelDeltaY/120*this.options.mouseWheelSpeed;else if("wheelDelta"in a)b=d=a.wheelDelta/120*this.options.mouseWheelSpeed;else{if(!("detail"in a))return;b=d=-a.detail/3*this.options.mouseWheelSpeed}if(b*=this.options.invertWheelDirection,d*=this.options.invertWheelDirection,this.hasVerticalScroll||(b=d,d=0),this.options.snap)return e=this.currentPage.pageX,f=this.currentPage.pageY,b>0?e--:0>b&&e++,d>0?f--:0>d&&f++,void this.goToPage(e,f);e=this.x+c.round(this.hasHorizontalScroll?b:0),f=this.y+c.round(this.hasVerticalScroll?d:0),e>0?e=0:e<this.maxScrollX&&(e=this.maxScrollX),f>0?f=0:f<this.maxScrollY&&(f=this.maxScrollY),this.scrollTo(e,f,0)}},_initSnap:function(){this.currentPage={},"string"==typeof this.options.snap&&(this.options.snap=this.scroller.querySelectorAll(this.options.snap)),this.on("refresh",function(){var a,b,d,e,f,g,h=0,i=0,j=0,k=this.options.snapStepX||this.wrapperWidth,l=this.options.snapStepY||this.wrapperHeight;if(this.pages=[],this.wrapperWidth&&this.wrapperHeight&&this.scrollerWidth&&this.scrollerHeight){if(this.options.snap===!0)for(d=c.round(k/2),e=c.round(l/2);j>-this.scrollerWidth;){for(this.pages[h]=[],a=0,f=0;f>-this.scrollerHeight;)this.pages[h][a]={x:c.max(j,this.maxScrollX),y:c.max(f,this.maxScrollY),width:k,height:l,cx:j-d,cy:f-e},f-=l,a++;j-=k,h++}else for(g=this.options.snap,a=g.length,b=-1;a>h;h++)(0===h||g[h].offsetLeft<=g[h-1].offsetLeft)&&(i=0,b++),this.pages[i]||(this.pages[i]=[]),j=c.max(-g[h].offsetLeft,this.maxScrollX),f=c.max(-g[h].offsetTop,this.maxScrollY),d=j-c.round(g[h].offsetWidth/2),e=f-c.round(g[h].offsetHeight/2),this.pages[i][b]={x:j,y:f,width:g[h].offsetWidth,height:g[h].offsetHeight,cx:d,cy:e},j>this.maxScrollX&&i++;this.goToPage(this.currentPage.pageX||0,this.currentPage.pageY||0,0),this.options.snapThreshold%1===0?(this.snapThresholdX=this.options.snapThreshold,this.snapThresholdY=this.options.snapThreshold):(this.snapThresholdX=c.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width*this.options.snapThreshold),this.snapThresholdY=c.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height*this.options.snapThreshold))}}),this.on("flick",function(){var a=this.options.snapSpeed||c.max(c.max(c.min(c.abs(this.x-this.startX),1e3),c.min(c.abs(this.y-this.startY),1e3)),300);this.goToPage(this.currentPage.pageX+this.directionX,this.currentPage.pageY+this.directionY,a)})},_nearestSnap:function(a,b){if(!this.pages.length)return{x:0,y:0,pageX:0,pageY:0};var d=0,e=this.pages.length,f=0;if(c.abs(a-this.absStartX)<this.snapThresholdX&&c.abs(b-this.absStartY)<this.snapThresholdY)return this.currentPage;for(a>0?a=0:a<this.maxScrollX&&(a=this.maxScrollX),b>0?b=0:b<this.maxScrollY&&(b=this.maxScrollY);e>d;d++)if(a>=this.pages[d][0].cx){a=this.pages[d][0].x;break}for(e=this.pages[d].length;e>f;f++)if(b>=this.pages[0][f].cy){b=this.pages[0][f].y;break}return d==this.currentPage.pageX&&(d+=this.directionX,0>d?d=0:d>=this.pages.length&&(d=this.pages.length-1),a=this.pages[d][0].x),f==this.currentPage.pageY&&(f+=this.directionY,0>f?f=0:f>=this.pages[0].length&&(f=this.pages[0].length-1),b=this.pages[0][f].y),{x:a,y:b,pageX:d,pageY:f}},goToPage:function(a,b,d,e){e=e||this.options.bounceEasing,a>=this.pages.length?a=this.pages.length-1:0>a&&(a=0),b>=this.pages[a].length?b=this.pages[a].length-1:0>b&&(b=0);var f=this.pages[a][b].x,g=this.pages[a][b].y;d=void 0===d?this.options.snapSpeed||c.max(c.max(c.min(c.abs(f-this.x),1e3),c.min(c.abs(g-this.y),1e3)),300):d,this.currentPage={x:f,y:g,pageX:a,pageY:b},this.scrollTo(f,g,d,e)},next:function(a,b){var c=this.currentPage.pageX,d=this.currentPage.pageY;c++,c>=this.pages.length&&this.hasVerticalScroll&&(c=0,d++),this.goToPage(c,d,a,b)},prev:function(a,b){var c=this.currentPage.pageX,d=this.currentPage.pageY;c--,0>c&&this.hasVerticalScroll&&(c=0,d--),this.goToPage(c,d,a,b)},_initKeys:function(b){var c,d={pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40};if("object"==typeof this.options.keyBindings)for(c in this.options.keyBindings)"string"==typeof this.options.keyBindings[c]&&(this.options.keyBindings[c]=this.options.keyBindings[c].toUpperCase().charCodeAt(0));else this.options.keyBindings={};for(c in d)this.options.keyBindings[c]=this.options.keyBindings[c]||d[c];h.addEvent(a,"keydown",this),this.on("destroy",function(){h.removeEvent(a,"keydown",this)})},_key:function(a){if(this.enabled){var b,d=this.options.snap,e=d?this.currentPage.pageX:this.x,f=d?this.currentPage.pageY:this.y,g=h.getTime(),i=this.keyTime||0,j=.25;switch(this.options.useTransition&&this.isInTransition&&(b=this.getComputedPosition(),this._translate(c.round(b.x),c.round(b.y)),this.isInTransition=!1),this.keyAcceleration=200>g-i?c.min(this.keyAcceleration+j,50):0,a.keyCode){case this.options.keyBindings.pageUp:this.hasHorizontalScroll&&!this.hasVerticalScroll?e+=d?1:this.wrapperWidth:f+=d?1:this.wrapperHeight;break;case this.options.keyBindings.pageDown:this.hasHorizontalScroll&&!this.hasVerticalScroll?e-=d?1:this.wrapperWidth:f-=d?1:this.wrapperHeight;break;case this.options.keyBindings.end:e=d?this.pages.length-1:this.maxScrollX,f=d?this.pages[0].length-1:this.maxScrollY;break;case this.options.keyBindings.home:e=0,f=0;break;case this.options.keyBindings.left:e+=d?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.up:f+=d?1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.right:e-=d?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.down:f-=d?1:5+this.keyAcceleration>>0;break;default:return}if(d)return void this.goToPage(e,f);e>0?(e=0,this.keyAcceleration=0):e<this.maxScrollX&&(e=this.maxScrollX,this.keyAcceleration=0),f>0?(f=0,this.keyAcceleration=0):f<this.maxScrollY&&(f=this.maxScrollY,this.keyAcceleration=0),this.scrollTo(e,f,0),this.keyTime=g}},_animate:function(a,b,c,d){function e(){var m,n,o,p=h.getTime();return p>=l?(f.isAnimating=!1,f._translate(a,b),void(f.resetPosition(f.options.bounceTime)||f._execEvent("scrollEnd"))):(p=(p-k)/c,o=d(p),m=(a-i)*o+i,n=(b-j)*o+j,f._translate(m,n),void(f.isAnimating&&g(e)))}var f=this,i=this.x,j=this.y,k=h.getTime(),l=k+c;this.isAnimating=!0,e()},handleEvent:function(a){switch(a.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(a),this.options.zoom&&a.touches&&a.touches.length>1&&this._zoomStart(a);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":if(this.options.zoom&&a.touches&&a.touches[1])return void this._zoom(a);this._move(a);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":if(this.scaled)return void this._zoomEnd(a);this._end(a);break;case"orientationchange":case"resize":this._resize();break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this._transitionEnd(a);break;case"wheel":case"DOMMouseScroll":case"mousewheel":if("zoom"==this.options.wheelAction)return void this._wheelZoom(a);this._wheel(a);break;case"keydown":this._key(a)}}},f.prototype={handleEvent:function(a){switch(a.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(a);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":this._move(a);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":this._end(a)}},destroy:function(){this.options.interactive&&(h.removeEvent(this.indicator,"touchstart",this),h.removeEvent(this.indicator,h.prefixPointerEvent("pointerdown"),this),h.removeEvent(this.indicator,"mousedown",this),h.removeEvent(a,"touchmove",this),h.removeEvent(a,h.prefixPointerEvent("pointermove"),this),h.removeEvent(a,"mousemove",this),h.removeEvent(a,"touchend",this),h.removeEvent(a,h.prefixPointerEvent("pointerup"),this),h.removeEvent(a,"mouseup",this)),this.options.defaultScrollbars&&this.wrapper.parentNode.removeChild(this.wrapper)},_start:function(b){var c=b.touches?b.touches[0]:b;b.preventDefault(),b.stopPropagation(),this.transitionTime(),this.initiated=!0,this.moved=!1,this.lastPointX=c.pageX,this.lastPointY=c.pageY,this.startTime=h.getTime(),this.options.disableTouch||h.addEvent(a,"touchmove",this),this.options.disablePointer||h.addEvent(a,h.prefixPointerEvent("pointermove"),this),this.options.disableMouse||h.addEvent(a,"mousemove",this),this.scroller._execEvent("beforeScrollStart")},_move:function(a){var b,c,d,e,f=a.touches?a.touches[0]:a;h.getTime();this.moved||this.scroller._execEvent("scrollStart"),this.moved=!0,b=f.pageX-this.lastPointX,this.lastPointX=f.pageX,c=f.pageY-this.lastPointY,this.lastPointY=f.pageY,d=this.x+b,e=this.y+c,this._pos(d,e),a.preventDefault(),a.stopPropagation()},_end:function(b){if(this.initiated){if(this.initiated=!1,b.preventDefault(),b.stopPropagation(),h.removeEvent(a,"touchmove",this),h.removeEvent(a,h.prefixPointerEvent("pointermove"),this),h.removeEvent(a,"mousemove",this),this.scroller.options.snap){var d=this.scroller._nearestSnap(this.scroller.x,this.scroller.y),e=this.options.snapSpeed||c.max(c.max(c.min(c.abs(this.scroller.x-d.x),1e3),c.min(c.abs(this.scroller.y-d.y),1e3)),300);this.scroller.x==d.x&&this.scroller.y==d.y||(this.scroller.directionX=0,this.scroller.directionY=0,this.scroller.currentPage=d,this.scroller.scrollTo(d.x,d.y,e,this.scroller.options.bounceEasing))}this.moved&&this.scroller._execEvent("scrollEnd")}},transitionTime:function(a){a=a||0,this.indicatorStyle[h.style.transitionDuration]=a+"ms",!a&&h.isBadAndroid&&(this.indicatorStyle[h.style.transitionDuration]="0.001s")},transitionTimingFunction:function(a){this.indicatorStyle[h.style.transitionTimingFunction]=a},refresh:function(){this.transitionTime(),this.options.listenX&&!this.options.listenY?this.indicatorStyle.display=this.scroller.hasHorizontalScroll?"block":"none":this.options.listenY&&!this.options.listenX?this.indicatorStyle.display=this.scroller.hasVerticalScroll?"block":"none":this.indicatorStyle.display=this.scroller.hasHorizontalScroll||this.scroller.hasVerticalScroll?"block":"none",this.scroller.hasHorizontalScroll&&this.scroller.hasVerticalScroll?(h.addClass(this.wrapper,"iScrollBothScrollbars"),h.removeClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="8px":this.wrapper.style.bottom="8px")):(h.removeClass(this.wrapper,"iScrollBothScrollbars"),h.addClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="2px":this.wrapper.style.bottom="2px"));this.wrapper.offsetHeight;this.options.listenX&&(this.wrapperWidth=this.wrapper.clientWidth,this.options.resize?(this.indicatorWidth=c.max(c.round(this.wrapperWidth*this.wrapperWidth/(this.scroller.scrollerWidth||this.wrapperWidth||1)),8),this.indicatorStyle.width=this.indicatorWidth+"px"):this.indicatorWidth=this.indicator.clientWidth,this.maxPosX=this.wrapperWidth-this.indicatorWidth,
"clip"==this.options.shrink?(this.minBoundaryX=-this.indicatorWidth+8,this.maxBoundaryX=this.wrapperWidth-8):(this.minBoundaryX=0,this.maxBoundaryX=this.maxPosX),this.sizeRatioX=this.options.speedRatioX||this.scroller.maxScrollX&&this.maxPosX/this.scroller.maxScrollX),this.options.listenY&&(this.wrapperHeight=this.wrapper.clientHeight,this.options.resize?(this.indicatorHeight=c.max(c.round(this.wrapperHeight*this.wrapperHeight/(this.scroller.scrollerHeight||this.wrapperHeight||1)),8),this.indicatorStyle.height=this.indicatorHeight+"px"):this.indicatorHeight=this.indicator.clientHeight,this.maxPosY=this.wrapperHeight-this.indicatorHeight,"clip"==this.options.shrink?(this.minBoundaryY=-this.indicatorHeight+8,this.maxBoundaryY=this.wrapperHeight-8):(this.minBoundaryY=0,this.maxBoundaryY=this.maxPosY),this.maxPosY=this.wrapperHeight-this.indicatorHeight,this.sizeRatioY=this.options.speedRatioY||this.scroller.maxScrollY&&this.maxPosY/this.scroller.maxScrollY),this.updatePosition()},updatePosition:function(){var a=this.options.listenX&&c.round(this.sizeRatioX*this.scroller.x)||0,b=this.options.listenY&&c.round(this.sizeRatioY*this.scroller.y)||0;this.options.ignoreBoundaries||(a<this.minBoundaryX?("scale"==this.options.shrink&&(this.width=c.max(this.indicatorWidth+a,8),this.indicatorStyle.width=this.width+"px"),a=this.minBoundaryX):a>this.maxBoundaryX?"scale"==this.options.shrink?(this.width=c.max(this.indicatorWidth-(a-this.maxPosX),8),this.indicatorStyle.width=this.width+"px",a=this.maxPosX+this.indicatorWidth-this.width):a=this.maxBoundaryX:"scale"==this.options.shrink&&this.width!=this.indicatorWidth&&(this.width=this.indicatorWidth,this.indicatorStyle.width=this.width+"px"),b<this.minBoundaryY?("scale"==this.options.shrink&&(this.height=c.max(this.indicatorHeight+3*b,8),this.indicatorStyle.height=this.height+"px"),b=this.minBoundaryY):b>this.maxBoundaryY?"scale"==this.options.shrink?(this.height=c.max(this.indicatorHeight-3*(b-this.maxPosY),8),this.indicatorStyle.height=this.height+"px",b=this.maxPosY+this.indicatorHeight-this.height):b=this.maxBoundaryY:"scale"==this.options.shrink&&this.height!=this.indicatorHeight&&(this.height=this.indicatorHeight,this.indicatorStyle.height=this.height+"px")),this.x=a,this.y=b,this.scroller.options.useTransform?this.indicatorStyle[h.style.transform]="translate("+a+"px,"+b+"px)"+this.scroller.translateZ:(this.indicatorStyle.left=a+"px",this.indicatorStyle.top=b+"px")},_pos:function(a,b){0>a?a=0:a>this.maxPosX&&(a=this.maxPosX),0>b?b=0:b>this.maxPosY&&(b=this.maxPosY),a=this.options.listenX?c.round(a/this.sizeRatioX):this.scroller.x,b=this.options.listenY?c.round(b/this.sizeRatioY):this.scroller.y,this.scroller.scrollTo(a,b)},fade:function(a,b){if(!b||this.visible){clearTimeout(this.fadeTimeout),this.fadeTimeout=null;var c=a?250:500,d=a?0:300;a=a?"1":"0",this.wrapperStyle[h.style.transitionDuration]=c+"ms",this.fadeTimeout=setTimeout(function(a){this.wrapperStyle.opacity=a,this.visible=+a}.bind(this,a),d)}}},d.utils=h,"undefined"!=typeof module&&module.exports?module.exports=d:a.IScroll=d}(window,document,Math);

/* jQuery photoClip v1.5.1 | Relying on the plug-in [iscroll-zoom.js] [hammer.js] */
!function(t,o){"use strict";"function"==typeof define&&define.amd?define(["jquery","iscroll-zoom","hammer"],o):"object"==typeof exports?module.exports=o(require("jquery"),require("iscroll-zoom"),require("hammer")):o(t.jQuery,t.IScroll,t.Hammer)}(this,function(t,o,e){"use strict";function i(i,r){function s(){O=!0,J.append(this),w.call(this,X,function(){Y=this.naturalWidth,Z=this.naturalHeight}),w(G,function(){l()}),A.call(this,this.src)}function c(){var t={zoom:!0,scrollX:!0,scrollY:!0,freeScroll:!0,mouseWheel:!0,wheelAction:"zoom"};V=new o(B[0],t)}function l(){io=0,no=0,ao=0,J.css({width:Y,height:Z}),S(J,io,no,ao),z(Y,Z),V.zoom(V.options.zoomStart),h(Y,Z);var t=.5*(L-Y*V.options.zoomStart),o=.5*(R-Z*V.options.zoomStart);V.scrollTo(t,o)}function h(t,o){G.css({width:t,height:o}),B.append(G),V.refresh()}function p(){var t=!!navigator.userAgent.match(/mobile/i);if(t){var o=new e(G[0]);o.add(new e.Rotate);var i,n;o.on("rotatemove",function(t){eo||(i=t.rotation,i>180?i-=360:-180>i&&(i+=360),n=i>0?1:0>i?-1:0)}),o.on("rotateend",function(t){eo||Math.abs(i)>30&&(1==n?d(t.center):-1==n&&u(t.center))})}else G.on("dblclick",function(t){d({x:t.clientX,y:t.clientY})})}function d(t){f(90,t)}function u(t){f(-90,t)}function f(t,o){if(!eo){eo=!0;var e;e=o?x(G,o.x,o.y):b(G,B,.5*L,.5*R);var i,n,a=y(ao,e),r=a.x,s=a.y,c=0,l=0,p=0,d=0,u=ao+t;90==u||-270==u?(c=r+s,l=s-r,u>ao?(p=Z-r-s,d=r-s):ao>u&&(p=Z-s-(Y-r),d=r+s-Z),i=Z,n=Y):180==u||-180==u?(c=2*r,l=2*s,u>ao?(p=Y-r-(Z-s),d=Z-(r+s)):ao>u&&(p=Y-(r+s),d=Z-s-(Y-r)),i=Y,n=Z):270==u||-90==u?(c=r-s,l=r+s,u>ao?(p=r+s-Y,d=Y-r-(Z-s)):ao>u&&(p=s-r,d=Y-r-s),i=Z,n=Y):(0==u||360==u||-360==u)&&(c=0,l=0,u>ao?(p=r-s,d=r+s-Y):ao>u&&(p=r+s-Z,d=s-r),i=Y,n=Z),0==ao?(io=0,no=0):90==ao||-270==ao?(io-=r+s,no-=s-r):180==ao||-180==ao?(io-=2*r,no-=2*s):(270==ao||-90==ao)&&(io-=r-s,no-=r+s),io=io.toFixed(2)-0,no=no.toFixed(2)-0,S(J,io,no,ao,r,s),F(J,io,no,u,200,function(){eo=!1,ao=u%360,io+=c+p,no+=l+d,io=io.toFixed(2)-0,no=no.toFixed(2)-0,S(J,io,no,ao),V.scrollTo(V.x-p*V.scale,V.y-d*V.scale),z(i,n),V.scale<V.options.zoomMin&&V.zoom(V.options.zoomMin),h(i,n)})}}function m(){N=document.createElement("canvas"),N.width=L,N.height=R}function g(){if(!O)return void alert("亲，当前没有图片可以裁剪!");var t=b(G,B),o=V.scale,e=N.getContext("2d");e.clearRect(0,0,N.width,N.height),e.save(),H?e.scale(o,o):(N.width=L/o,N.height=R/o),e.translate(io-t.x/o,no-t.y/o),e.rotate(ao*Math.PI/180),e.drawImage(X[0],0,0),e.restore();var i=N.toDataURL(I,1);K.css("background-image","url("+i+")"),D.call(X[0],i)}function v(){w(Q,function(){$=Q.width(),_=Q.height()})}function b(t,o,e,i){e=e||0,i=i||0;var n,a;return w(t,function(){n=t.offset()}),w(o,function(){a=o.offset()}),{x:a.left-n.left+e,y:a.top-n.top+i}}function x(t,o,e){o=o||0,e=e||0;var i;return w(t,function(){i=t.offset()}),{x:o+oo.scrollLeft()-i.left,y:e+oo.scrollTop()-i.top}}function w(o,e){var i=t();t.each(o,function(o,e){for(var n,a=t(e),r=a.parents().andSelf().filter(":hidden"),o=0;o<r.length&&a.is(":hidden");o++)n=r.eq(o),"none"==n.css("display")&&(i=i.add(n.show()))}),"function"==typeof e&&e.call(this),i.hide()}function y(t,o){var e=V.scale,i={};return 0==t?(i.x=o.x/e,i.y=o.y/e):90==t||-270==t?(i.x=o.y/e,i.y=Z-o.x/e):180==t||-180==t?(i.x=Y-o.x/e,i.y=Z-o.y/e):(270==t||-90==t)&&(i.x=Y-o.y/e,i.y=o.x/e),i}function k(t,o,e,i){var n=t/e,a=o/i;return n>a?n:a}function z(t,o){V.options.zoomMin=k(L,R,t,o),V.options.zoomMax=Math.max(1,V.options.zoomMin),V.options.zoomStart=Math.min(V.options.zoomMax,k($,_,t,o))}function T(t,o,e,i){o=o||.8,e=e||0;var n=i||"image/jpeg",a=t.naturalWidth,r=t.naturalHeight,s=Math.max(a,r);if(s>1024){var c=Math.min(a,r);c=c/s*1024,s=1024,a>r?(a=s,r=c):(a=c,r=s)}var l=document.createElement("canvas"),h=l.getContext("2d");e?(l.width=r,l.height=a,h.translate(r,0),h.rotate(e*Math.PI/180)):(l.width=a,l.height=r),h.drawImage(t,0,0,a,r);var p=l.toDataURL(n,o||.8);return p}function M(o){X&&X.length&&(X.remove(),delete X[0]),X=t("<img>").css({"user-select":"none","pointer-events":"none"}),X.load(s),X.attr("src",o)}function S(t,o,e,i,n,r){n=n||0,r=r||0;var s={};s[a+"transform"]="translateZ(0) translate("+o+"px,"+e+"px) rotate("+i+"deg)",s[a+"transform-origin"]=n+"px "+r+"px",t.css(s)}function F(t,o,e,i,r,s){t.css(a+"transform"),t.css(a+"transition",a+"transform "+r+"ms"),t.one(n,function(){t.css(a+"transition",""),s.call(this)}),t.css(a+"transform","translateZ(0) translate("+o+"px,"+e+"px) rotate("+i+"deg)")}function j(){Q=t(i).css({"user-select":"none",overflow:"hidden"}),"static"==Q.css("position")&&Q.css("position","relative"),B=t("<div class='photo-clip-view'>").css({position:"absolute",left:"50%",top:"50%",width:L,height:R,"margin-left":-L/2,"margin-top":-R/2}).appendTo(Q),G=t("<div class='photo-clip-moveLayer'>").appendTo(B),J=t("<div class='photo-clip-rotateLayer'>").appendTo(G);{var o=t("<div class='photo-clip-mask'>").css({position:"absolute",left:0,top:0,width:"100%",height:"100%","pointer-events":"none"}).appendTo(Q);t("<div class='photo-clip-mask-left'>").css({position:"absolute",left:0,right:"50%",top:"50%",bottom:"50%",width:"auto",height:R,"margin-right":L/2,"margin-top":-R/2,"margin-bottom":-R/2,"background-color":"rgba(0,0,0,.5)"}).appendTo(o),t("<div class='photo-clip-mask-right'>").css({position:"absolute",left:"50%",right:0,top:"50%",bottom:"50%","margin-left":L/2,"margin-top":-R/2,"margin-bottom":-R/2,"background-color":"rgba(0,0,0,.5)"}).appendTo(o),t("<div class='photo-clip-mask-top'>").css({position:"absolute",left:0,right:0,top:0,bottom:"50%","margin-bottom":R/2,"background-color":"rgba(0,0,0,.5)"}).appendTo(o),t("<div class='photo-clip-mask-bottom'>").css({position:"absolute",left:0,right:0,top:"50%",bottom:0,"margin-top":R/2,"background-color":"rgba(0,0,0,.5)"}).appendTo(o),t("<div class='photo-clip-area'>").css({border:"1px dashed #ddd",position:"absolute",left:"50%",top:"50%",width:L,height:R,"margin-left":-L/2-1,"margin-top":-R/2-1}).appendTo(o)}K=t(q),K.length&&K.css({"background-color":"#fff","background-repeat":"no-repeat","background-position":"center","background-size":"contain"})}var L=r.width,R=r.height,C=r.file,q=r.view,E=r.ok,I=r.outputType||"image/jpeg",H=r.strictSize,W=r.loadStart,A=r.loadComplete,P=r.loadError,D=r.clipFinish;"jpg"===I?I="image/jpeg":"png"===I&&(I="image/png");var U=t(C);if(U.length){var X,Y,Z,O;U.attr("accept","image/*"),U.change(function(){if(this.files.length){if(!/image\/\w+/.test(this.files[0].type))return alert("图片格式不正确，请选择正确格式的图片文件！"),!1;var o=new FileReader;o.onprogress=function(t){console.log((t.loaded/t.total*100).toFixed()+"%")},o.onload=function(o){var e=o.total/1024;if(e>1024){var i=1024/e,n=t("<img>").hide();n.load(function(){var t=this.naturalWidth;n.appendTo(document.body);var o=this.naturalHeight;n.remove(),delete n[0],n=null;var e=0;t==o&&(e=90);var a=T(this,i,e,I);M(a)}),n.attr("src",this.result)}else M(this.result)},o.onerror=function(t){alert("图片加载失败"),P.call(this,t)},o.readAsDataURL(this.files[0]),W.call(o,this.files[0])}}),U.click(function(){this.value=""});var Q,B,G,J,K,N,V,$,_;j(),c(),p(),m();var to=t(E);to.length&&to.click(function(){g()});var oo=t(window);v(),oo.resize(v);var eo,io,no,ao}}t.fn.photoClip=function(o){if(!window.FileReader)return void alert("您的浏览器不支持 HTML5 的 FileReader API， 因此无法初始化图片裁剪插件，请更换最新的浏览器！");var e={width:200,height:200,file:"",view:"",ok:"",outputType:"jpg",strictSize:!1,loadStart:function(){},loadComplete:function(){},loadError:function(){},clipFinish:function(){}};return t.extend(e,o),this.each(function(){i(this,e)}),this};var n,a="";return function(){var t,o={Webkit:"webkit",Moz:"",O:"o"},e=document.documentElement,i=function(o){return t?t+o:o.toLowerCase()};for(var r in o)if(void 0!==e.style[r+"TransitionProperty"]){a="-"+r.toLowerCase()+"-",t=o[r];break}n=i("TransitionEnd")}(),t});


/* mui.pullToRefresh.js 2016-05-19 */
!function(a,b,c){var d="beforeChangeOffset",e="afterChangeOffset",f="pullstart",g="pulling",h=d,i=e,j="dragEndAfterChangeOffset",k=a.className("transitioning"),l=a.className("pull-top-tips"),m=a.className("pull-bottom-tips"),n=a.className("pull-loading"),o=a.className("scroll"),p=a.className("pull-loading")+" "+a.className("icon")+" "+a.className("icon-pulldown"),q=p+" "+a.className("reverse"),r=a.className("pull-loading")+" "+a.className("spinner"),s=a.className("hidden"),t="."+n;a.PullToRefresh=a.Class.extend({init:function(b,c){this.element=b,this.options=a.extend(!0,{down:{height:75,callback:!1},up:{auto:!1,offset:100,show:!0,contentdown:"上拉显示更多",contentrefresh:"正在加载...",contentnomore:"没有更多数据了",callback:!1},preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/}},c),this.stopped=this.isNeedRefresh=this.isDragging=!1,this.state=d,this.isInScroll=this.element.classList.contains(o),this.initPullUpTips(),this.initEvent()},_preventDefaultException:function(a,b){for(var c in b)if(b[c].test(a[c]))return!0;return!1},initEvent:function(){a.isFunction(this.options.down.callback)&&(this.element.addEventListener("touchstart",this),this.element.addEventListener("drag",this),this.element.addEventListener("dragend",this)),this.pullUpTips&&(this.element.addEventListener("dragup",this),this.isInScroll?this.element.addEventListener("scrollbottom",this):b.addEventListener("scroll",this))},handleEvent:function(a){switch(a.type){case"touchstart":this.isInScroll&&this._canPullDown()&&a.target&&!this._preventDefaultException(a.target,this.options.preventDefaultException)&&a.preventDefault();break;case"drag":this._drag(a);break;case"dragend":this._dragend(a);break;case"webkitTransitionEnd":this._transitionEnd(a);break;case"dragup":case"scroll":this._dragup(a);break;case"scrollbottom":this.pullUpLoading(a)}},initPullDownTips:function(){var b=this;a.isFunction(b.options.down.callback)&&(b.pullDownTips=function(){var a=c.querySelector("."+l);return a&&a.parentNode.removeChild(a),a||(a=c.createElement("div"),a.classList.add(l),a.innerHTML='<div class="mui-pull-top-wrapper"><span class="mui-pull-loading mui-icon mui-icon-pulldown"></span></div>',a.addEventListener("webkitTransitionEnd",b)),b.pullDownTipsIcon=a.querySelector(t),c.body.appendChild(a),a}())},initPullUpTips:function(){var b=this;a.isFunction(b.options.up.callback)&&(b.pullUpTips=function(){var a=b.element.querySelector("."+m);return a||(a=c.createElement("div"),a.classList.add(m),b.options.up.show||a.classList.add(s),a.innerHTML='<div class="mui-pull-bottom-wrapper"><span class="mui-pull-loading">'+b.options.up.contentdown+"</span></div>",b.element.appendChild(a)),b.pullUpTipsIcon=a.querySelector(t),a}())},_transitionEnd:function(a){a.target===this.pullDownTips&&this.removing&&this.removePullDownTips()},_dragup:function(b){var c=this;if(!c.loading){if(b&&b.detail&&a.gestures.session.drag)c.isDraggingUp=!0;else if(!c.isDraggingUp)return;c.isDragging||c._canPullUp()&&c.pullUpLoading(b)}},_canPullUp:function(){if(this.removing)return!1;if(this.isInScroll){var d=this.element.parentNode.getAttribute("data-scroll");if(d){var e=a.data[d];return e.y===e.maxScrollY}}return b.pageYOffset+b.innerHeight+this.options.up.offset>=c.documentElement.scrollHeight},_canPullDown:function(){if(this.removing)return!1;if(this.isInScroll){var b=this.element.parentNode.getAttribute("data-scroll");if(b){var d=a.data[b];return 0===d.y}}return 0===c.body.scrollTop},_drag:function(f){if(this.loading||this.stopped)return f.stopPropagation(),void f.detail.gesture.preventDefault();var g=f.detail;if(!this.isDragging&&"down"===g.direction&&this._canPullDown()){if(c.querySelector("."+l))return f.stopPropagation(),void f.detail.gesture.preventDefault();this.isDragging=!0,this.removing=!1,this.startDeltaY=g.deltaY,a.gestures.session.lockDirection=!0,a.gestures.session.startDirection=g.direction,this._pullStart(this.startDeltaY)}if(this.isDragging){f.stopPropagation(),f.detail.gesture.preventDefault();var h=g.deltaY-this.startDeltaY;h=Math.min(h,1.5*this.options.down.height),this.deltaY=h,this._pulling(h);var i=h>this.options.down.height?e:d;if(this.state!==i&&(this.state=i,this.state===e?(this.removing=!1,this.isNeedRefresh=!0):(this.removing=!0,this.isNeedRefresh=!1),this["_"+i](h)),a.os.ios&&parseFloat(a.os.version)>=8){var j=g.gesture.touches[0].clientY;if(j+10>b.innerHeight||10>j)return void this._dragend(f)}}},_dragend:function(a){var b=this;b.isDragging&&(b.isDragging=!1,b._dragEndAfterChangeOffset(b.isNeedRefresh)),b.isPullingUp&&(b.pullingUpTimeout&&clearTimeout(b.pullingUpTimeout),b.pullingUpTimeout=setTimeout(function(){b.isPullingUp=!1},1e3))},_pullStart:function(b){this.pullStart(b),a.trigger(this.element,f,{api:this,startDeltaY:b})},_pulling:function(b){this.pulling(b),a.trigger(this.element,g,{api:this,deltaY:b})},_beforeChangeOffset:function(b){this.beforeChangeOffset(b),a.trigger(this.element,h,{api:this,deltaY:b})},_afterChangeOffset:function(b){this.afterChangeOffset(b),a.trigger(this.element,i,{api:this,deltaY:b})},_dragEndAfterChangeOffset:function(b){this.dragEndAfterChangeOffset(b),a.trigger(this.element,j,{api:this,isNeedRefresh:b})},removePullDownTips:function(){if(this.pullDownTips)try{this.pullDownTips.parentNode&&this.pullDownTips.parentNode.removeChild(this.pullDownTips),this.pullDownTips=null,this.removing=!1}catch(a){}},pullStart:function(a){this.initPullDownTips(a)},pulling:function(a){this.pullDownTips.style.webkitTransform="translate3d(0,"+a+"px,0)"},beforeChangeOffset:function(a){this.pullDownTipsIcon.className=p},afterChangeOffset:function(a){this.pullDownTipsIcon.className=q},dragEndAfterChangeOffset:function(a){a?(this.pullDownTipsIcon.className=r,this.pullDownLoading()):(this.pullDownTipsIcon.className=p,this.endPullDownToRefresh())},pullDownLoading:function(){if(!this.loading){if(!this.pullDownTips)return this.initPullDownTips(),void this.dragEndAfterChangeOffset(!0);this.loading=!0,this.pullDownTips.classList.add(k),this.pullDownTips.style.webkitTransform="translate3d(0,"+this.options.down.height+"px,0)",this.options.down.callback.apply(this)}},pullUpLoading:function(a){this.loading||this.finished||(this.loading=!0,this.isDraggingUp=!1,this.pullUpTips.classList.remove(s),a&&a.detail&&a.detail.gesture&&a.detail.gesture.preventDefault(),this.pullUpTipsIcon.innerHTML=this.options.up.contentrefresh,this.options.up.callback.apply(this))},endPullDownToRefresh:function(){this.loading=!1,this.pullUpTips&&this.pullUpTips.classList.remove(s),this.pullDownTips.classList.add(k),this.pullDownTips.style.webkitTransform="translate3d(0,0,0)",this.deltaY<=0?this.removePullDownTips():this.removing=!0},endPullUpToRefresh:function(a){a?(this.finished=!0,this.pullUpTipsIcon.innerHTML=this.options.up.contentnomore,this.element.removeEventListener("dragup",this),b.removeEventListener("scroll",this)):this.pullUpTipsIcon.innerHTML=this.options.up.contentdown,this.loading=!1},setStopped:function(a){a!=this.stopped&&(this.stopped=a,this.pullUpTips&&this.pullUpTips.classList[a?"add":"remove"](s))},refresh:function(a){a&&this.finished&&this.pullUpTipsIcon&&(this.pullUpTipsIcon.innerHTML=this.options.up.contentdown,this.element.addEventListener("dragup",this),b.addEventListener("scroll",this),this.finished=!1)}}),a.fn.pullToRefresh=function(b){var c=[];return b=b||{},this.each(function(){var d=this,e=null,f=d.getAttribute("data-pullToRefresh");f?e=a.data[f]:(f=++a.uuid,a.data[f]=e=new a.PullToRefresh(d,b),d.setAttribute("data-pullToRefresh",f)),b.up&&b.up.auto&&e.pullUpLoading(),c.push(e)}),1===c.length?c[0]:c}}(mui,window,document);

/* mui.pullToRefresh.material.js 2016-05-19 */
!function(a){var b=a.className("pull-top-tips");a.PullToRefresh=a.PullToRefresh.extend({init:function(b,c){this._super(b,c),this.options=a.extend(!0,{down:{tips:{colors:["008000","d8ad44","d00324","dc00b8","017efc"],size:200,lineWidth:15,duration:1e3,tail_duration:2500}}},this.options),this.options.down.tips.color=this.options.down.tips.colors[0],this.options.down.tips.colors=this.options.down.tips.colors.map(function(a){return{r:parseInt(a.substring(0,2),16),g:parseInt(a.substring(2,4),16),b:parseInt(a.substring(4,6),16)}})},initPullDownTips:function(){var c=this;a.isFunction(c.options.down.callback)&&(c.pullDownTips=function(){var a=document.querySelector("."+b);return a&&a.parentNode.removeChild(a),a||(a=document.createElement("div"),a.classList.add(b),a.innerHTML='<div class="mui-pull-top-wrapper"><div class="mui-pull-top-canvas"><canvas id="pullDownTips" width="'+c.options.down.tips.size+'" height="'+c.options.down.tips.size+'"></canvas></div></div>',a.addEventListener("webkitTransitionEnd",c),document.body.appendChild(a)),c.pullDownCanvas=document.getElementById("pullDownTips"),c.pullDownCanvasCtx=c.pullDownCanvas.getContext("2d"),c.canvasUtils.init(c.pullDownCanvas,c.options.down.tips),a}())},removePullDownTips:function(){this._super(),this.canvasUtils.stopSpin()},pulling:function(a){var b=Math.min(a/(1.5*this.options.down.height),1),c=Math.min(1,2*b);this.pullDownTips.style.webkitTransform="translate3d(0,"+(0>a?0:a)+"px,0)",this.pullDownCanvas.style.opacity=c,this.pullDownCanvas.style.webkitTransform="rotate("+300*b+"deg)";var d=this.pullDownCanvas,e=this.pullDownCanvasCtx,f=this.options.down.tips.size;e.lineWidth=this.options.down.tips.lineWidth,e.fillStyle="#"+this.options.down.tips.color,e.strokeStyle="#"+this.options.down.tips.color,e.stroke(),e.clearRect(0,0,f,f),d.style.display="none",d.offsetHeight,d.style.display="inherit",this.canvasUtils.drawArcedArrow(e,f/2+.5,f/2,f/4,0*Math.PI,5/3*Math.PI*c,!1,1,2,.7853981633974483,25,this.options.down.tips.lineWidth,this.options.down.tips.lineWidth)},beforeChangeOffset:function(a){},afterChangeOffset:function(a){},dragEndAfterChangeOffset:function(a){a?(this.canvasUtils.startSpin(),this.pullDownLoading()):(this.canvasUtils.stopSpin(),this.endPullDownToRefresh())},canvasUtils:function(){function b(a,b,c,d){return c*a/d+b}function c(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b}function d(a,b,c){var d=Math.min(b,c),e=Math.max(b,c);return d>a?d:a>e?d:a}var e=null,f=null,g=200,h=15,i=0,j=0,k=0,l=0,m=0,n=180,o=Math.PI/180,p=1e3,q=2500,r=["35ad0e","d8ad44","d00324","dc00b8","017efc"],s=null,t=function(a,b,c,d,e,f,g,h){"use strict";"string"==typeof b&&(b=parseInt(b)),"string"==typeof c&&(c=parseInt(c)),"string"==typeof d&&(d=parseInt(d)),"string"==typeof e&&(e=parseInt(e)),"string"==typeof f&&(f=parseInt(f)),"string"==typeof g&&(g=parseInt(g));2*Math.PI;switch(a.save(),a.beginPath(),a.moveTo(b,c),a.lineTo(d,e),a.lineTo(f,g),h){case 0:var i=Math.sqrt((f-b)*(f-b)+(g-c)*(g-c));a.arcTo(d,e,b,c,.55*i),a.fill();break;case 1:a.beginPath(),a.moveTo(b,c),a.lineTo(d,e),a.lineTo(f,g),a.lineTo(b,c),a.fill();break;case 2:a.stroke();break;case 3:var j=(b+d+f)/3,k=(c+e+g)/3;a.quadraticCurveTo(j,k,b,c),a.fill();break;case 4:var l,m,n,o,i,p=5;if(f==b)i=g-c,l=(d+b)/2,n=(d+b)/2,m=e+i/p,o=e-i/p;else{i=Math.sqrt((f-b)*(f-b)+(g-c)*(g-c));var q=(b+f)/2,r=(c+g)/2,s=(q+d)/2,t=(r+e)/2,u=(g-c)/(f-b),v=i/(2*Math.sqrt(u*u+1))/p,w=u*v;l=s-v,m=t-w,n=s+v,o=t+w}a.bezierCurveTo(l,m,n,o,b,c),a.fill()}a.restore()},u=function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";h="undefined"!=typeof h?h:3,i="undefined"!=typeof i?i:1,j="undefined"!=typeof j?j:Math.PI/8,l=l||1,m=m||10,k="undefined"!=typeof k?k:10,a.save(),a.lineWidth=l,a.beginPath(),a.arc(b,c,d,e,f,g),a.stroke();var n,o,p,q,r;1&i&&(n=Math.cos(e)*d+b,o=Math.sin(e)*d+c,p=Math.atan2(b-n,o-c),g?(q=n+10*Math.cos(p),r=o+10*Math.sin(p)):(q=n-10*Math.cos(p),r=o-10*Math.sin(p)),v(a,n,o,q,r,h,2,j,k)),2&i&&(n=Math.cos(f)*d+b,o=Math.sin(f)*d+c,p=Math.atan2(b-n,o-c),g?(q=n-10*Math.cos(p),r=o-10*Math.sin(p)):(q=n+10*Math.cos(p),r=o+10*Math.sin(p)),v(a,n-m*Math.sin(f),o+m*Math.cos(f),q-m*Math.sin(f),r+m*Math.cos(f),h,2,j,k)),a.restore()},v=function(a,b,c,d,e,f,g,h,i){"use strict";"string"==typeof b&&(b=parseInt(b)),"string"==typeof c&&(c=parseInt(c)),"string"==typeof d&&(d=parseInt(d)),"string"==typeof e&&(e=parseInt(e)),f="undefined"!=typeof f?f:3,g="undefined"!=typeof g?g:1,h="undefined"!=typeof h?h:Math.PI/8,i="undefined"!=typeof i?i:10;var j,k,l,m,n="function"!=typeof f?t:f,o=Math.sqrt((d-b)*(d-b)+(e-c)*(e-c)),p=(o-i/3)/o;1&g?(j=Math.round(b+(d-b)*p),k=Math.round(c+(e-c)*p)):(j=d,k=e),2&g?(l=b+(d-b)*(1-p),m=c+(e-c)*(1-p)):(l=b,m=c),a.beginPath(),a.moveTo(l,m),a.lineTo(j,k),a.stroke();var q=Math.atan2(e-c,d-b),r=Math.abs(i/Math.cos(h));if(1&g){var s=q+Math.PI+h,u=d+Math.cos(s)*r,v=e+Math.sin(s)*r,w=q+Math.PI-h,x=d+Math.cos(w)*r,y=e+Math.sin(w)*r;n(a,u,v,d,e,x,y,f)}if(2&g){var s=q+h,u=b+Math.cos(s)*r,v=c+Math.sin(s)*r,w=q-h,x=b+Math.cos(w)*r,y=c+Math.sin(w)*r;n(a,u,v,b,c,x,y,f)}},w=function(a,c){var e=a%c;k>e&&r.push(r.shift());var f=r[0],g=r[1],h=d(b(e,f.r,g.r-f.r,c),f.r,g.r),i=d(b(e,f.g,g.g-f.g,c),f.g,g.g),j=d(b(e,f.b,g.b-f.b,c),f.b,g.b);return k=e,"rgb("+parseInt(h)+","+parseInt(i)+","+parseInt(j)+")"},x=function(a){var d=a||(new Date).getTime();j||(j=d),i=d-j,l=c((i+q/2)%q,0,p,q),m=b((i+l)%p,0,360,p),n=20+Math.abs(b((i+q/2)%q,-300,600,q)),f.lineWidth=h,f.lineCap="round",f.strokeStyle=w(i,p),f.clearRect(0,0,g,g),e.style.display="none",e.offsetHeight,e.style.display="inherit",f.beginPath(),f.arc(g/2,g/2,g/4,parseInt(m-n)%360*o,parseInt(m)%360*o,!1),f.stroke(),s=requestAnimationFrame(x)},y=function(){j=0,k=0,s=requestAnimationFrame(x)},z=function(){s&&cancelAnimationFrame(s)},A=function(b,c){e=b,f=e.getContext("2d");var c=a.extend(!0,{},c);r=c.colors,p=c.duration,q=c.tail_duration,g=c.size,h=c.lineWidth};return{init:A,drawArcedArrow:u,startSpin:y,stopSpin:z}}()})}(mui);







