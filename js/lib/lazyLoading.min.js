/* 页面需延迟加载的js库 2016-05-05 */
function base64encode(a){var b,c,d,e,f,g;for(d=a.length,c=0,b="";d>c;){if(e=255&a.charCodeAt(c++),c==d){b+=base64EncodeChars.charAt(e>>2),b+=base64EncodeChars.charAt((3&e)<<4),b+="==";break}if(f=a.charCodeAt(c++),c==d){b+=base64EncodeChars.charAt(e>>2),b+=base64EncodeChars.charAt((3&e)<<4|(240&f)>>4),b+=base64EncodeChars.charAt((15&f)<<2),b+="=";break}g=a.charCodeAt(c++),b+=base64EncodeChars.charAt(e>>2),b+=base64EncodeChars.charAt((3&e)<<4|(240&f)>>4),b+=base64EncodeChars.charAt((15&f)<<2|(192&g)>>6),b+=base64EncodeChars.charAt(63&g)}return b}function base64decode(a){var b,c,d,e,f,g,h;for(g=a.length,f=0,h="";g>f;){do b=base64DecodeChars[255&a.charCodeAt(f++)];while(g>f&&-1==b);if(-1==b)break;do c=base64DecodeChars[255&a.charCodeAt(f++)];while(g>f&&-1==c);if(-1==c)break;h+=String.fromCharCode(b<<2|(48&c)>>4);do{if(d=255&a.charCodeAt(f++),61==d)return h;d=base64DecodeChars[d]}while(g>f&&-1==d);if(-1==d)break;h+=String.fromCharCode((15&c)<<4|(60&d)>>2);do{if(e=255&a.charCodeAt(f++),61==e)return h;e=base64DecodeChars[e]}while(g>f&&-1==e);if(-1==e)break;h+=String.fromCharCode((3&d)<<6|e)}return h}function utf16to8(a){var b,c,d,e;for(b="",d=a.length,c=0;d>c;c++)e=a.charCodeAt(c),e>=1&&127>=e?b+=a.charAt(c):e>2047?(b+=String.fromCharCode(224|e>>12&15),b+=String.fromCharCode(128|e>>6&63),b+=String.fromCharCode(128|e>>0&63)):(b+=String.fromCharCode(192|e>>6&31),b+=String.fromCharCode(128|e>>0&63));return b}function utf8to16(a){var b,c,d,e,f,g;for(b="",d=a.length,c=0;d>c;)switch(e=a.charCodeAt(c++),e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=a.charAt(c-1);break;case 12:case 13:f=a.charCodeAt(c++),b+=String.fromCharCode((31&e)<<6|63&f);break;case 14:f=a.charCodeAt(c++),g=a.charCodeAt(c++),b+=String.fromCharCode((15&e)<<12|(63&f)<<6|(63&g)<<0)}return b}var base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64DecodeChars=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);
/* 页面需延迟加载的js库 2016-05-05 */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["jquery","iscroll-zoom","hammer","lrz"],b):"object"==typeof exports?module.exports=b(require("jquery"),require("iscroll-zoom"),require("hammer"),require("lrz")):b(a.jQuery,a.IScroll,a.Hammer,a.lrz)}(this,function(a,b,c,d){"use strict";function e(e,h){function i(){X=!0,_.append(this),v.call(this,U,function(){V=this.naturalWidth,W=this.naturalHeight}),v($,function(){k()}),M.call(this,this.src)}function j(){var a={zoom:!0,scrollX:!0,scrollY:!0,freeScroll:!0,mouseWheel:!0,wheelAction:"zoom"};ca=new b(Z[0],a)}function k(){ia=0,ja=0,ka=0,_.css({width:V,height:W}),B(_,ia,ja,ka),y(V,W),ca.zoom(ca.options.zoomStart),l(V,W);var a=.5*(P-V*ca.options.zoomStart),b=.5*(Q-W*ca.options.zoomStart);ca.scrollTo(a,b)}function l(a,b){$.css({width:a,height:b}),Z.append($),ca.refresh()}function m(){var a=!!navigator.userAgent.match(/mobile/i);if(a){var b=new c($[0]);b.add(new c.Rotate);var d,e;b.on("rotatemove",function(a){ha||(d=a.rotation,d>180?d-=360:-180>d&&(d+=360),e=d>0?1:0>d?-1:0)}),b.on("rotateend",function(a){ha||Math.abs(d)>30&&(1==e?n(a.center):-1==e&&o(a.center))})}else $.on("dblclick",function(a){n({x:a.clientX,y:a.clientY})})}function n(a){p(90,a)}function o(a){p(-90,a)}function p(a,b){if(!ha){ha=!0;var c;c=b?u($,b.x,b.y):t($,Z,.5*P,.5*Q);var d,e,f=w(ka,c),g=f.x,h=f.y,i=0,j=0,k=0,m=0,n=ka+a;90==n||-270==n?(i=g+h,j=h-g,n>ka?(k=W-g-h,m=g-h):ka>n&&(k=W-h-(V-g),m=g+h-W),d=W,e=V):180==n||-180==n?(i=2*g,j=2*h,n>ka?(k=V-g-(W-h),m=W-(g+h)):ka>n&&(k=V-(g+h),m=W-h-(V-g)),d=V,e=W):270==n||-90==n?(i=g-h,j=g+h,n>ka?(k=g+h-V,m=V-g-(W-h)):ka>n&&(k=h-g,m=V-g-h),d=W,e=V):0!=n&&360!=n&&-360!=n||(i=0,j=0,n>ka?(k=g-h,m=g+h-V):ka>n&&(k=g+h-W,m=h-g),d=V,e=W),0==ka?(ia=0,ja=0):90==ka||-270==ka?(ia-=g+h,ja-=h-g):180==ka||-180==ka?(ia-=2*g,ja-=2*h):270!=ka&&-90!=ka||(ia-=g-h,ja-=g+h),ia=ia.toFixed(2)-0,ja=ja.toFixed(2)-0,B(_,ia,ja,ka,g,h),C(_,ia,ja,n,200,function(){ha=!1,ka=n%360,ia+=i+k,ja+=j+m,ia=ia.toFixed(2)-0,ja=ja.toFixed(2)-0,B(_,ia,ja,ka),ca.scrollTo(ca.x-k*ca.scale,ca.y-m*ca.scale),y(d,e),ca.scale<ca.options.zoomMin&&ca.zoom(ca.options.zoomMin),l(d,e)})}}function q(){ba=document.createElement("canvas")}function r(){if(!X)return void alert("亲，当前没有图片可以裁剪!");var a=t($,Z),b=ca.scale,c=ba.getContext("2d");c.clearRect(0,0,ba.width,ba.height),c.save(),R&&S?(ba.width=R,ba.height=S,c.scale(R/P*b,S/Q*b)):(ba.width=P/b,ba.height=Q/b),c.translate(ia-a.x/b,ja-a.y/b),c.rotate(ka*Math.PI/180),c.drawImage(U[0],0,0),c.restore();var d=ba.toDataURL(K,1);aa.css("background-image","url("+d+")"),O.call(U[0],d)}function s(){v(Y,function(){da=Y.width(),ea=Y.height()})}function t(a,b,c,d){c=c||0,d=d||0;var e,f;return v(a,function(){e=a.offset()}),v(b,function(){f=b.offset()}),{x:f.left-e.left+c,y:f.top-e.top+d}}function u(a,b,c){b=b||0,c=c||0;var d;return v(a,function(){d=a.offset()}),{x:b+ga.scrollLeft()-d.left,y:c+ga.scrollTop()-d.top}}function v(b,c){var d=a();a.each(b,function(b,c){for(var e,f=a(c),g=f.parents().andSelf().filter(":hidden"),b=0;b<g.length&&f.is(":hidden");b++)e=g.eq(b),"none"==e.css("display")&&(d=d.add(e.show()))}),"function"==typeof c&&c.call(this),d.hide()}function w(a,b){var c=ca.scale,d={};return 0==a?(d.x=b.x/c,d.y=b.y/c):90==a||-270==a?(d.x=b.y/c,d.y=W-b.x/c):180==a||-180==a?(d.x=V-b.x/c,d.y=W-b.y/c):270!=a&&-90!=a||(d.x=V-b.y/c,d.y=b.x/c),d}function x(a,b,c,d){var e=a/c,f=b/d;return e>f?e:f}function y(a,b){ca.options.zoomMin=x(P,Q,a,b),ca.options.zoomMax=Math.max(1,ca.options.zoomMin),ca.options.zoomStart=Math.min(ca.options.zoomMax,x(da,ea,a,b))}function z(){U&&U.length&&(U.remove(),delete U[0])}function A(b){z(),U=a("<img>").css({"user-select":"none","pointer-events":"none"}),U.load(i),U.attr("src",b)}function B(a,b,c,d,e,f){e=e||0,f=f||0;var h={};h[g+"transform"]="translateZ(0) translate("+b+"px,"+c+"px) rotate("+d+"deg)",h[g+"transform-origin"]=e+"px "+f+"px",a.css(h)}function C(a,b,c,d,e,h){a.css(g+"transform"),a.css(g+"transition",g+"transform "+e+"ms"),a.one(f,function(){a.css(g+"transition",""),h.call(this)}),a.css(g+"transform","translateZ(0) translate("+b+"px,"+c+"px) rotate("+d+"deg)")}function D(a){return"[object Array]"===Object.prototype.toString.call(a)}function E(){Y=a(e).css({"user-select":"none",overflow:"hidden"}),"static"==Y.css("position")&&Y.css("position","relative"),Z=a("<div class='photo-clip-view'>").css({position:"absolute",left:"50%",top:"50%",width:P,height:Q,"margin-left":-P/2,"margin-top":-Q/2}).appendTo(Y),$=a("<div class='photo-clip-moveLayer'>").appendTo(Z),_=a("<div class='photo-clip-rotateLayer'>").appendTo($);var b=a("<div class='photo-clip-mask'>").css({position:"absolute",left:0,top:0,width:"100%",height:"100%","pointer-events":"none"}).appendTo(Y);a("<div class='photo-clip-mask-left'>").css({position:"absolute",left:0,right:"50%",top:"50%",bottom:"50%",width:"auto",height:Q,"margin-right":P/2,"margin-top":-Q/2,"margin-bottom":-Q/2,"background-color":"rgba(0,0,0,.5)"}).appendTo(b),a("<div class='photo-clip-mask-right'>").css({position:"absolute",left:"50%",right:0,top:"50%",bottom:"50%","margin-left":P/2,"margin-top":-Q/2,"margin-bottom":-Q/2,"background-color":"rgba(0,0,0,.5)"}).appendTo(b),a("<div class='photo-clip-mask-top'>").css({position:"absolute",left:0,right:0,top:0,bottom:"50%","margin-bottom":Q/2,"background-color":"rgba(0,0,0,.5)"}).appendTo(b),a("<div class='photo-clip-mask-bottom'>").css({position:"absolute",left:0,right:0,top:"50%",bottom:0,"margin-top":Q/2,"background-color":"rgba(0,0,0,.5)"}).appendTo(b),a("<div class='photo-clip-area'>").css({border:"1px dashed #ddd",position:"absolute",left:"50%",top:"50%",width:P,height:Q,"margin-left":-P/2-1,"margin-top":-Q/2-1}).appendTo(b);aa=a(I),aa.length&&aa.css({"background-color":"#666","background-repeat":"no-repeat","background-position":"center","background-size":"contain"})}var F=h.size,G=h.outputSize,H=h.file,I=h.view,J=h.ok,K="image/jpeg",L=h.loadStart,M=h.loadComplete,N=h.loadError,O=h.clipFinish;D(F)||(F=[260,260]),D(G)||(G=[0,0]);var P=F[0]||260,Q=F[1]||260,R=Math.max(G[0],0),S=Math.max(G[1],0),T=a(H);if(T.length){var U,V,W,X;T.attr("accept","image/*"),T.change(function(){if(this.files.length){var a=this.files[0];if(!/image\/\w+/.test(a.type))return alert("图片格式不正确，请选择正确格式的图片文件！"),!1;var b=new FileReader;b.onprogress=function(a){console.log((a.loaded/a.total*100).toFixed()+"%")},b.onload=function(b){d(a).then(function(a){A(a.base64)})["catch"](function(a){alert("图片处理失败"),N.call(this,a)})},b.onerror=function(a){alert("图片加载失败"),N.call(this,a)},b.readAsDataURL(a),L.call(b,a)}}),T.click(function(){this.value=""});var Y,Z,$,_,aa,ba,ca,da,ea;E(),j(),m(),q();var fa=a(J);fa.length&&fa.click(function(){r()});var ga=a(window);s(),ga.resize(s);var ha,ia,ja,ka}}a.fn.photoClip=function(b){if(!window.FileReader)return void alert("您的浏览器不支持 HTML5 的 FileReader API， 因此无法初始化图片裁剪插件，请更换最新的浏览器！");var c={size:[260,260],outputSize:[0,0],file:"",view:"",ok:"",loadStart:function(){},loadComplete:function(){},loadError:function(){},clipFinish:function(){}};return a.extend(c,b),this.each(function(){e(this,c)}),this};var f,g="";return function(){var a,b={Webkit:"webkit",Moz:"",O:"o"},c=document.documentElement,d=function(b){return a?a+b:b.toLowerCase()};for(var e in b)if(void 0!==c.style[e+"TransitionProperty"]){g="-"+e.toLowerCase()+"-",a=b[e];break}f=d("TransitionEnd")}(),a});
/* 页面需延迟加载的js库 2016-05-05 */
!function(a,b){var c='<div id="{{id}}" class="mui-slider mui-preview-image mui-fullscreen"><div class="mui-preview-header">{{header}}</div><div class="mui-slider-group"></div><div class="mui-preview-footer mui-hidden">{{footer}}</div><div class="mui-preview-loading"><span class="mui-spinner mui-spinner-white"></span></div></div>',d='<div class="mui-slider-item mui-zoom-wrapper {{className}}"><div class="mui-zoom-scroller"><img src="{{src}}" data-preview-lazyload="{{lazyload}}" style="{{style}}" class="mui-zoom"></div></div>',e="__DEFAULT",f=document.createElement("div"),g=function(b){this.options=a.extend(!0,{id:"__MUI_PREVIEWIMAGE",zoom:!0,header:'<span class="mui-preview-indicator"></span>',footer:""},b||{}),this.init(),this.initEvent()},h=g.prototype;h.init=function(){var b=this.options,d=document.getElementById(this.options.id);d||(f.innerHTML=c.replace(/\{\{id\}\}/g,this.options.id).replace("{{header}}",b.header).replace("{{footer}}",b.footer),document.body.appendChild(f.firstElementChild),d=document.getElementById(this.options.id)),this.element=d,this.scroller=this.element.querySelector(a.classSelector(".slider-group")),this.indicator=this.element.querySelector(a.classSelector(".preview-indicator")),this.loader=this.element.querySelector(a.classSelector(".preview-loading")),b.footer&&this.element.querySelector(a.classSelector(".preview-footer")).classList.remove(a.className("hidden")),this.addImages()},h.initEvent=function(){var b=this;a(document.body).on("tap","img[data-preview-src]",function(){return b.isAnimationing()?!1:(b.open(this),!1)});var c=null,d=function(){!c&&(c=a.later(function(){b.isInAnimation=!0,b.loader.removeEventListener("tap",d),b.scroller.removeEventListener("tap",d),b.close()},300))};this.scroller.addEventListener("doubletap",function(){c&&(c.cancel(),c=null)}),this.element.addEventListener("webkitAnimationEnd",function(){b.element.classList.contains(a.className("preview-out"))?(b.element.style.display="none",b.element.classList.remove(a.className("preview-out")),c=null):(b.loader.addEventListener("tap",d),b.scroller.addEventListener("tap",d)),b.isInAnimation=!1}),this.element.addEventListener("slide",function(c){if(b.options.zoom){var d=b.element.querySelector(".mui-zoom-wrapper:nth-child("+(b.lastIndex+1)+")");d&&a(d).zoom().setZoom(1)}var e=c.detail.slideNumber;b.lastIndex=e,b.indicator&&(b.indicator.innerText=e+1+"/"+b.currentGroup.length),b._loadItem(e)})},h.isAnimationing=function(){return this.isInAnimation?!0:(this.isInAnimation=!0,!1)},h.addImages=function(a,b){this.groups={};var c=[];if(c=a?a===e?document.querySelectorAll("img[data-preview-src]:not([data-preview-group])"):document.querySelectorAll("img[data-preview-src][data-preview-group='"+a+"']"):document.querySelectorAll("img[data-preview-src]"),c.length)for(var d=0,f=c.length;f>d;d++)this.addImage(c[d])},h.addImage=function(a){var b=a.getAttribute("data-preview-group");b=b||e,this.groups[b]||(this.groups[b]=[]);var c=a.getAttribute("src");if(a.__mui_img_data&&a.__mui_img_data.src===c)this.groups[b].push(a.__mui_img_data);else{var d=a.getAttribute("data-preview-src");d||(d=c);var f={src:c,lazyload:c===d?"":d,loaded:c===d,sWidth:0,sHeight:0,sTop:0,sLeft:0,sScale:1,el:a};this.groups[b].push(f),a.__mui_img_data=f}},h.empty=function(){this.scroller.innerHTML=""},h._initImgData=function(c,d){if(!c.sWidth){var e=c.el;c.sWidth=e.offsetWidth,c.sHeight=e.offsetHeight;var f=a.offset(e);c.sTop=f.top,c.sLeft=f.left,c.sScale=Math.max(c.sWidth/b.innerWidth,c.sHeight/b.innerHeight)}d.style.webkitTransform="translate3d(0,0,0) scale("+c.sScale+")"},h._getScale=function(a,b){var c=a.width/b.width,d=a.height/b.height,e=1;return e=d>=c?a.height/(b.height*c):a.width/(b.width*d)},h._imgTransitionEnd=function(b){var c=b.target;c.classList.remove(a.className("transitioning")),c.removeEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this))},h._loadItem=function(b,c){var d=this.scroller.querySelector(a.classSelector(".slider-item:nth-child("+(b+1)+")")),e=this.currentGroup[b],f=d.querySelector("img");if(this._initImgData(e,f),c){var g=this._getPosition(e);f.style.webkitTransitionDuration="0ms",f.style.webkitTransform="translate3d("+g.x+"px,"+g.y+"px,0) scale("+e.sScale+")",f.offsetHeight}if(!e.loaded&&f.getAttribute("data-preview-lazyload")){var h=this;h.loader.classList.add(a.className("active")),f.style.webkitTransitionDuration="0.5s",f.addEventListener("webkitTransitionEnd",h._imgTransitionEnd.bind(h)),f.style.webkitTransform="translate3d(0,0,0) scale("+e.sScale+")",this.loadImage(f,function(){e.loaded=!0,f.src=e.lazyload,h._initZoom(d,this.width,this.height),f.classList.add(a.className("transitioning")),f.addEventListener("webkitTransitionEnd",h._imgTransitionEnd.bind(h)),f.setAttribute("style",""),f.offsetHeight,h.loader.classList.remove(a.className("active"))})}else e.lazyload&&(f.src=e.lazyload),this._initZoom(d,f.width,f.height),f.classList.add(a.className("transitioning")),f.addEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this)),f.setAttribute("style",""),f.offsetHeight;this._preloadItem(b+1),this._preloadItem(b-1)},h._preloadItem=function(b){var c=this.scroller.querySelector(a.classSelector(".slider-item:nth-child("+(b+1)+")"));if(c){var d=this.currentGroup[b];if(!d.sWidth){var e=c.querySelector("img");this._initImgData(d,e)}}},h._initZoom=function(b,c,d){if(this.options.zoom&&!b.getAttribute("data-zoomer")){var e=b.querySelector(a.classSelector(".zoom"));if("IMG"===e.tagName){var f=this,g=f._getScale({width:b.offsetWidth,height:b.offsetHeight},{width:c,height:d});a(b).zoom({maxZoom:Math.max(g,1)})}else a(b).zoom()}},h.loadImage=function(a,b){var c=function(){b&&b.call(this)},d=new Image;d.onload=c,d.onerror=c,d.src=a.getAttribute("data-preview-lazyload")},h.getRangeByIndex=function(a,b){return{from:0,to:b-1}},h._getPosition=function(a){var c=a.sLeft-b.pageXOffset,d=a.sTop-b.pageYOffset,e=(b.innerWidth-a.sWidth)/2,f=(b.innerHeight-a.sHeight)/2;return{left:c,top:d,x:c-e,y:d-f}},h.refresh=function(c,e){this.currentGroup=e;for(var f=e.length,g=[],h=this.getRangeByIndex(c,f),i=h.from,j=h.to+1,k=c,l="",m="",n=(b.innerWidth,b.innerHeight,0);j>i;i++,n++){var o=e[i],p="";o.sWidth&&(p="-webkit-transform:translate3d(0,0,0) scale("+o.sScale+");transform:translate3d(0,0,0) scale("+o.sScale+")"),m=d.replace("{{src}}",o.src).replace("{{lazyload}}",o.lazyload).replace("{{style}}",p),i===c?(k=n,l=a.className("active")):l="",g.push(m.replace("{{className}}",l))}this.scroller.innerHTML=g.join(""),this.element.style.display="block",this.element.classList.add(a.className("preview-in")),this.lastIndex=k,this.element.offsetHeight,a(this.element).slider().gotoItem(k,0),this.indicator&&(this.indicator.innerText=k+1+"/"+this.currentGroup.length),this._loadItem(k,!0)},h.openByGroup=function(a,b){a=Math.min(Math.max(0,a),this.groups[b].length-1),this.refresh(a,this.groups[b])},h.open=function(b,c){this.element.classList.contains(a.className("preview-in"))||("number"==typeof b?(c=c||e,this.addImages(c,b),this.openByGroup(b,c)):(c=b.getAttribute("data-preview-group"),c=c||e,this.addImages(c,b),this.openByGroup(this.groups[c].indexOf(b.__mui_img_data),c)))},h.close=function(c,d){this.element.classList.remove(a.className("preview-in")),this.element.classList.add(a.className("preview-out"));var e=this.scroller.querySelector(a.classSelector(".slider-item:nth-child("+(this.lastIndex+1)+")")),f=e.querySelector("img");if(f){f.classList.add(a.className("transitioning"));var g=this.currentGroup[this.lastIndex],h=this._getPosition(g),i=h.left,j=h.top;j>b.innerHeight||i>b.innerWidth||0>j||0>i?(f.style.opacity=0,f.style.webkitTransitionDuration="0.5s",f.style.webkitTransform="scale("+g.sScale+")"):(this.options.zoom&&a(f.parentNode.parentNode).zoom().toggleZoom(0),f.style.webkitTransitionDuration="0.5s",f.style.webkitTransform="translate3d("+h.x+"px,"+h.y+"px,0) scale("+g.sScale+")")}for(var k=this.element.querySelectorAll(a.classSelector(".zoom-wrapper")),l=0,m=k.length;m>l;l++)a(k[l]).zoom().destory()},h.isShown=function(){return this.element.classList.contains(a.className("preview-in"))};var i=null;a.previewImage=function(a){return i||(i=new g(a)),i},a.getPreviewImage=function(){return i}}(mui,window);
/* 页面需延迟加载的js库 2016-05-05 */
!function(a,b){var c=a.className("zoom"),d=a.className("zoom-scroller"),e="."+c,f="."+d,g="pinchstart",h="pinch",i="pinchend";"ongesturestart"in b&&(g="gesturestart",h="gesturechange",i="gestureend"),a.Zoom=function(b,c){var d=this;d.options=a.extend(a.Zoom.defaults,c),d.wrapper=d.element=b,d.scroller=b.querySelector(f),d.scrollerStyle=d.scroller&&d.scroller.style,d.zoomer=b.querySelector(e),d.zoomerStyle=d.zoomer&&d.zoomer.style,d.init=function(){a.options.gestureConfig.pinch=!0,a.options.gestureConfig.doubletap=!0,d.initEvents()},d.initEvents=function(a){var b=a?"removeEventListener":"addEventListener",c=d.scroller;c[b](g,d.onPinchstart),c[b](h,d.onPinch),c[b](i,d.onPinchend),c[b]("touchstart",d.onTouchstart),c[b]("touchmove",d.onTouchMove),c[b]("touchcancel",d.onTouchEnd),c[b]("touchend",d.onTouchEnd),c[b]("drag",function(a){(q||m)&&a.stopPropagation()}),c[b]("doubletap",function(a){d.toggleZoom(a.detail.center)})},d.transition=function(a,b){return b=b||0,a.webkitTransitionDuration=b+"ms",d},d.translate=function(a,b,c){return b=b||0,c=c||0,a.webkitTransform="translate3d("+b+"px,"+c+"px,0px)",d},d.scale=function(a,b){return b=b||1,a.webkitTransform="translate3d(0,0,0) scale("+b+")",d},d.scrollerTransition=function(a){return d.transition(d.scrollerStyle,a)},d.scrollerTransform=function(a,b){return d.translate(d.scrollerStyle,a,b)},d.zoomerTransition=function(a){return d.transition(d.zoomerStyle,a)},d.zoomerTransform=function(a){return d.scale(d.zoomerStyle,a)};var j=1,k=1,l=!1,m=!1;d.onPinchstart=function(a){m=!0},d.onPinch=function(a){l||(d.zoomerTransition(0),l=!0),j=(a.detail?a.detail.scale:a.scale)*k,j>d.options.maxZoom&&(j=d.options.maxZoom-1+Math.pow(j-d.options.maxZoom+1,.5)),j<d.options.minZoom&&(j=d.options.minZoom+1-Math.pow(d.options.minZoom-j+1,.5)),d.zoomerTransform(j)},d.onPinchend=function(a){j=Math.max(Math.min(j,d.options.maxZoom),d.options.minZoom),d.zoomerTransition(d.options.speed).zoomerTransform(j),k=j,l=!1},d.setZoom=function(a){j=k=a,d.scrollerTransition(d.options.speed).scrollerTransform(0,0),d.zoomerTransition(d.options.speed).zoomerTransform(j)},d.toggleZoom=function(b,c){if("number"==typeof b&&(c=b,b=void 0),c="undefined"==typeof c?d.options.speed:c,j&&1!==j)j=k=1,d.scrollerTransition(c).scrollerTransform(0,0);else if(j=k=d.options.maxZoom,b){var e=a.offset(d.zoomer),f=e.top,g=e.left,h=(b.x-g)*j,i=(b.y-f)*j;this._cal(),h>=v&&v+n>=h?h=v-h+n/2:v>h?h=v-h+n/2:h>v+n&&(h=v+n-h-n/2),i>=w&&w+o>=i?i=w-i+o/2:w>i?i=w-i+o/2:i>w+o&&(i=w+o-i-o/2),h=Math.min(Math.max(h,t),v),i=Math.min(Math.max(i,u),w),d.scrollerTransition(c).scrollerTransform(h,i)}else d.scrollerTransition(c).scrollerTransform(0,0);d.zoomerTransition(c).zoomerTransform(j)},d._cal=function(){n=d.wrapper.offsetWidth,o=d.wrapper.offsetHeight,x=d.zoomer.offsetWidth,y=d.zoomer.offsetHeight;var a=x*j,b=y*j;t=Math.min(n/2-a/2,0),v=-t,u=Math.min(o/2-b/2,0),w=-u};var n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G={},H={};return d.onTouchstart=function(a){a.preventDefault(),p=!0,G.x="touchstart"===a.type?a.targetTouches[0].pageX:a.pageX,G.y="touchstart"===a.type?a.targetTouches[0].pageY:a.pageY},d.onTouchMove=function(b){if(b.preventDefault(),p){if(!q){n=d.wrapper.offsetWidth,o=d.wrapper.offsetHeight,x=d.zoomer.offsetWidth,y=d.zoomer.offsetHeight;var c=a.parseTranslateMatrix(a.getStyles(d.scroller,"webkitTransform"));z=c.x||0,A=c.y||0,d.scrollerTransition(0)}var e=x*j,f=y*j;if(!(n>e&&o>f)){if(t=Math.min(n/2-e/2,0),v=-t,u=Math.min(o/2-f/2,0),w=-u,H.x="touchmove"===b.type?b.targetTouches[0].pageX:b.pageX,H.y="touchmove"===b.type?b.targetTouches[0].pageY:b.pageY,!q&&!l&&(Math.floor(t)===Math.floor(z)&&H.x<G.x||Math.floor(v)===Math.floor(z)&&H.x>G.x))return void(p=!1);q=!0,r=H.x-G.x+z,s=H.y-G.y+A,t>r&&(r=t+1-Math.pow(t-r+1,.8)),r>v&&(r=v-1+Math.pow(r-v+1,.8)),u>s&&(s=u+1-Math.pow(u-s+1,.8)),s>w&&(s=w-1+Math.pow(s-w+1,.8)),B||(B=H.x),E||(E=H.y),C||(C=a.now()),D=(H.x-B)/(a.now()-C)/2,F=(H.y-E)/(a.now()-C)/2,Math.abs(H.x-B)<2&&(D=0),Math.abs(H.y-E)<2&&(F=0),B=H.x,E=H.y,C=a.now(),d.scrollerTransform(r,s)}}},d.onTouchEnd=function(a){if(a.touches.length||(m=!1),!p||!q)return p=!1,void(q=!1);p=!1,q=!1;var b=300,c=300,e=D*b,f=r+e,g=F*c,h=s+g;0!==D&&(b=Math.abs((f-r)/D)),0!==F&&(c=Math.abs((h-s)/F));var i=Math.max(b,c);r=f,s=h;var k=x*j,l=y*j;t=Math.min(n/2-k/2,0),v=-t,u=Math.min(o/2-l/2,0),w=-u,r=Math.max(Math.min(r,v),t),s=Math.max(Math.min(s,w),u),d.scrollerTransition(i).scrollerTransform(r,s)},d.destory=function(){d.initEvents(!0),delete a.data[d.wrapper.getAttribute("data-zoomer")],d.wrapper.setAttribute("data-zoomer","")},d.init(),d},a.Zoom.defaults={speed:300,maxZoom:3,minZoom:1},a.fn.zoom=function(b){var c=[];return this.each(function(){var d=null,e=this,f=e.getAttribute("data-zoomer");f?d=a.data[f]:(f=++a.uuid,a.data[f]=d=new a.Zoom(e,b),e.setAttribute("data-zoomer",f)),c.push(d)}),1===c.length?c[0]:c}}(mui,window);